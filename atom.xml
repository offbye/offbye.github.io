<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>offbye</title>
  <subtitle>关注移动架构，Android，HTML5，iOS技术前沿</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://offbye.com/"/>
  <updated>2017-03-08T13:44:15.000Z</updated>
  <id>http://offbye.com/</id>
  
  <author>
    <name>offbye</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redex安卓Apk优化技术研究</title>
    <link href="http://offbye.com/2017/03/08/Redex%E5%AE%89%E5%8D%93Apk%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF%E7%A0%94%E7%A9%B6/"/>
    <id>http://offbye.com/2017/03/08/Redex安卓Apk优化技术研究/</id>
    <published>2017-03-08T13:43:28.000Z</published>
    <updated>2017-03-08T13:44:15.000Z</updated>
    
    <content type="html">&lt;p&gt;ReDex 是 Facebook 开源的工具，通过对字节码进行优化，以减小 Android Apk 大小，同时提高 App 启动速度。&lt;br&gt;GitHub：&lt;a href=&quot;https://github.com/facebook/redex&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ReDex github&lt;/a&gt;，官网主页：fbredex.com&lt;/p&gt;
&lt;p&gt;本次研究完成了Redex在Ubuntu linux上的安装和配置，进行了Redex优化测试， 实验了Redex优化的主要流程, 包括Inderdex。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Redex优化的基础知识&quot;&gt;&lt;a href=&quot;#Redex优化的基础知识&quot; class=&quot;headerlink&quot; title=&quot;Redex优化的基础知识&quot;&gt;&lt;/a&gt;Redex优化的基础知识&lt;/h2&gt;&lt;p&gt;可以先看看这几篇文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzAwMTYwNzE2Mg==&amp;amp;mid=2651036594&amp;amp;idx=1&amp;amp;sn=b276c0f76cea713e5d568ab51e3f7f13&amp;amp;scene=0#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;基于 Facebook Redex 实现 Android APK 的压缩和优化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.trinea.cn/android/facebook%E5%BC%80%E6%BA%90%E7%9A%84android%E4%BC%98%E5%8C%96%E5%B7%A5%E5%85%B7redex-%E5%87%8F%E5%B0%8F%E5%AE%89%E8%A3%85%E5%8C%85%E5%A4%A7%E5%B0%8F-%E5%90%8C%E6%97%B6%E6%8F%90%E9%AB%98%E8%BF%90/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Facebook App 优化工具 ReDex 优化的 6 点及未优化的一大方面&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://code.facebook.com/posts/1480969635539475/optimizing-android-bytecode-with-redex&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Optimizing Android bytecode with ReDex&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Ubuntu上安装Redex&quot;&gt;&lt;a href=&quot;#Ubuntu上安装Redex&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu上安装Redex&quot;&gt;&lt;/a&gt;Ubuntu上安装Redex&lt;/h2&gt;&lt;p&gt;Redex目前支持Ubuntu Linux和Mac系统， 安装时需要编译源码，Ubuntu下面需要有sudo权限才能安装。&lt;br&gt;安装过程参考官方文档。&lt;/p&gt;
&lt;h3 id=&quot;Ubuntu-14-04-LTS-64-bit&quot;&gt;&lt;a href=&quot;#Ubuntu-14-04-LTS-64-bit&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu 14.04 LTS (64-bit)&quot;&gt;&lt;/a&gt;Ubuntu 14.04 LTS (64-bit)&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    g++ \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    automake \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    autoconf \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    autoconf-archive \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    libtool \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    libboost-all-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    liblz4-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    liblzma-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    make \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    zlib1g-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    binutils-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    libjemalloc-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    libiberty-dev \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    libjsoncpp-dev&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Download-Build-and-Install&quot;&gt;&lt;a href=&quot;#Download-Build-and-Install&quot; class=&quot;headerlink&quot; title=&quot;Download, Build and Install&quot;&gt;&lt;/a&gt;Download, Build and Install&lt;/h3&gt;&lt;p&gt;Get ReDex from GitHub:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone https://github.com/facebook/redex.git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd redex&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Now, build ReDex using autoconf and make.&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;autoreconf -ivf &amp;amp;&amp;amp; ./configure &amp;amp;&amp;amp; make&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后就可以在命令行下运行Redex了&lt;/p&gt;
&lt;h2 id=&quot;Redex-Indexdex介绍&quot;&gt;&lt;a href=&quot;#Redex-Indexdex介绍&quot; class=&quot;headerlink&quot; title=&quot;Redex Indexdex介绍&quot;&gt;&lt;/a&gt;Redex Indexdex介绍&lt;/h2&gt;&lt;p&gt;Interdex优化比较复杂，默认配置是不开启的，具体看&lt;a href=&quot;https://github.com/facebook/redex/blob/master/docs/Interdex.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Interdex文档&lt;/a&gt;。&lt;br&gt;Interdex Pass 可以优化dex中class的顺序，以及class在不同的dex中的分布（如果是app使用了multidex）&lt;br&gt;按照class在实际运行中调用的顺序在dex中进行重新排序，可以带来几个好处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;更少的IO&lt;/li&gt;
&lt;li&gt;更少的内存占用&lt;/li&gt;
&lt;li&gt;更少page cache污染&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redex默认的配置文件是不包含Inderdex这一步的。增加Inderdex后的配置文件如下：&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;redex&amp;quot; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;passes&amp;quot; : [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;ReBindRefsPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;BridgePass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;SynthPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;FinalInlinePass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;DelSuperPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;SingleImplPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;SimpleInlinePass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;StaticReloPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;RemoveEmptyClassesPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;ShortenSrcStringsPass&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;quot;InterDexPass&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;quot;coldstart_classes&amp;quot;:&amp;quot;app_list_of_classes.txt&amp;quot; //class调用顺序列表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;生成输入数据&quot;&gt;&lt;a href=&quot;#生成输入数据&quot; class=&quot;headerlink&quot; title=&quot;生成输入数据&quot;&gt;&lt;/a&gt;生成输入数据&lt;/h2&gt;&lt;p&gt;如何得到实际运行中class的调用顺序？&lt;/p&gt;
&lt;h3 id=&quot;首先需要收集app的运行数据&quot;&gt;&lt;a href=&quot;#首先需要收集app的运行数据&quot; class=&quot;headerlink&quot; title=&quot;首先需要收集app的运行数据&quot;&gt;&lt;/a&gt;首先需要收集app的运行数据&lt;/h3&gt;&lt;p&gt;按照典型使用场景操作app，获取heap dump文件， 使用redex提供的脚本&lt;code&gt;redex/tools/hprof/dump_classes_from_hprof.py&lt;/code&gt;分析dump文件，得到class列表。&lt;br&gt;这里有个坑，首先是dump_classes_from_hprof.py在python2运行都有错误， Python2需要安装&lt;a href=&quot;https://pypi.python.org/packages/bf/3e/31d502c25302814a7c2f1d3959d2a3b3f78e509002ba91aea64993936876/enum34-1.1.6.tar.gz#md5=5f13a0841a61f7fc295c514490d120d0&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;enum34&lt;/a&gt;后才能正常运行， 不兼容python3&lt;br&gt;在ubuntu上安装enum34后，用python2.7运行，可以得到class列表&lt;/p&gt;
&lt;h3 id=&quot;具体操作过程如下&quot;&gt;&lt;a href=&quot;#具体操作过程如下&quot; class=&quot;headerlink&quot; title=&quot;具体操作过程如下&quot;&gt;&lt;/a&gt;具体操作过程如下&lt;/h3&gt;&lt;p&gt;// get the process if of your app&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;adb shell ps | grep YOUR_APP_NAME | awk &amp;apos;&amp;#123;print $2&amp;#125;&amp;apos; &amp;gt; YOUR_PID ( if you don&amp;apos;t have awk, the second value is the pid of your app)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; // dump the heap of your app. You WILL NEED ROOT for this step&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;adb root&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;adb shell am dumpheap YOUR_PID /data/local/tmp/SOMEDUMP.hprof&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; // copy the heap to your host computer&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;adb pull /data/local/tmp/SOMEDUMP.hprof YOUR_DIR_HERE/.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; // pass the heap dump to the python script for parsing and printing out the class list&lt;br&gt; // Note that the script needs python 2&lt;br&gt; &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;YOUR_PYTHON_2_PATH redex/tools/hprof/dump_classes_from_hprof.py --hprof YOUR_DIR_HERE/SOMEDUMP.hprof &amp;gt; list_of_classes.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;测量优化效果&quot;&gt;&lt;a href=&quot;#测量优化效果&quot; class=&quot;headerlink&quot; title=&quot;测量优化效果&quot;&gt;&lt;/a&gt;测量优化效果&lt;/h3&gt;&lt;p&gt;主要是看app内存占用和 .dex mmap&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;adb shell ps | grep com.test.app | awk &amp;apos;&amp;#123; print $2 &amp;#125;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[R:\AndroidM\packages\apps]$ adb shell dumpsys meminfo 9003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Applications Memory Usage (kB):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Uptime: 2329984 Realtime: 2329984&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;** MEMINFO in pid 9003 [com.test.app] **&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   Pss  Private  Private  Swapped     Heap     Heap     Heap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 Total    Dirty    Clean    Dirty     Size    Alloc     Free&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ------   ------   ------   ------   ------   ------   ------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Native Heap    10711    10044        0        0    44416    40455     3960&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Dalvik Heap     2201     2172        0        0    35719    33937     1782&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Dalvik Other     5424     4984        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Stack      516      516        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       Ashmem        4        0        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Other dev        5        0        4        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     .so mmap      967      152      148      360                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .apk mmap      271        0       56        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .ttf mmap        8        0        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .dex mmap     4531        8     4464        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .oat mmap     2274        0      776        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .art mmap     2761     1352     1020        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Other mmap       94        8        8        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    GL mtrack     4196     4196        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Unknown      190      188        0        0                           &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        TOTAL    34153    23620     6476      360    80135    74392     5742&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; App Summary&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Pss(KB)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        ------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           Java Heap:     4544&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         Native Heap:    10044&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Code:     5604&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               Stack:      516&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            Graphics:     4196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       Private Other:     5192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              System:     4057&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               TOTAL:    34153      TOTAL SWAP (KB):      360&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Objects&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               Views:       48         ViewRootImpl:        0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         AppContexts:        2           Activities:        1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              Assets:        3        AssetManagers:        2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       Local Binders:       12        Proxy Binders:       27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       Parcel memory:       13         Parcel count:       52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Death Recipients:        0      OpenSSL Sockets:        0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; SQL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         MEMORY_USED:      663&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PAGECACHE_OVERFLOW:       88          MALLOC_SIZE:       62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; DATABASES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      pgsz     dbsz   Lookaside(b)          cache  Dbname&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         4       68            512      225/36/22  /data/user/0/com.test.app/databases/MyTicket&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;App冷启动时间测试&quot;&gt;&lt;a href=&quot;#App冷启动时间测试&quot; class=&quot;headerlink&quot; title=&quot;App冷启动时间测试&quot;&gt;&lt;/a&gt;App冷启动时间测试&lt;/h2&gt;&lt;p&gt;我们常说的App冷启动,是指启动时你的应用程序的进程是没有创建的. 这也是大部分应用的使用场景.用户在桌面上点击你应用的 icon 之后,首先要创建进程,然后才启动 MainActivity.&lt;br&gt;这时候&lt;code&gt;adb shell am start -W packagename/MainActivity&lt;/code&gt; 返回的结果,就是标准的应用程序的启动时间（注意 Android 5.0 之前的手机是没有 WaitTime 这个值的）&lt;br&gt;具体可以参考&lt;a href=&quot;https://www.zhihu.com/question/35487841&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;怎么计算apk的启动时间？&lt;/a&gt;&lt;br&gt;如果只关心某个应用自身启动耗时，参考TotalTime；如果关心系统启动应用耗时，参考WaitTime；如果关心应用有界面Activity启动耗时，参考ThisTime。&lt;/p&gt;
&lt;p&gt;我编写了一个python脚本，可以自动进行多次冷启动，并画出启动时间统计图，计算平均启动时间。用这个脚本可以很方便的测量任意app的启动时间。&lt;br&gt;打开app，马上运行&lt;code&gt;adb shell dumpsys activity  top&lt;/code&gt;，可以看到app的包名和启动Activity， 测试脚本需要输入包名和启动activity的完整类名。&lt;/p&gt;
&lt;h3 id=&quot;Redex优化效果分析&quot;&gt;&lt;a href=&quot;#Redex优化效果分析&quot; class=&quot;headerlink&quot; title=&quot;Redex优化效果分析&quot;&gt;&lt;/a&gt;Redex优化效果分析&lt;/h3&gt;&lt;p&gt;使用以前开发的App做测试，体积20M，使用了multidex。由于app有启动页，本身启动速度已经很快，1s多一点，因此优化效果不够明显。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;优化前数据&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&amp;apos;465&amp;apos;, &amp;apos;1122&amp;apos;, &amp;apos;1163&amp;apos;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&amp;apos;444&amp;apos;, &amp;apos;1123&amp;apos;, &amp;apos;1149&amp;apos;], [&amp;apos;440&amp;apos;, &amp;apos;1150&amp;apos;, &amp;apos;1191&amp;apos;], [&amp;apos;410&amp;apos;, &amp;apos;1450&amp;apos;, &amp;apos;1520&amp;apos;], [&amp;apos;439&amp;apos;, &amp;apos;1081&amp;apos;, &amp;apos;1112&amp;apos;], [&amp;apos;419&amp;apos;, &amp;apos;1072&amp;apos;, &amp;apos;1117&amp;apos;], [&amp;apos;409&amp;apos;, &amp;apos;1055&amp;apos;, &amp;apos;1084&amp;apos;], [&amp;apos;423&amp;apos;, &amp;apos;1101&amp;apos;, &amp;apos;1135&amp;apos;], [&amp;apos;427&amp;apos;, &amp;apos;1079&amp;apos;, &amp;apos;1120&amp;apos;], [&amp;apos;465&amp;apos;, &amp;apos;1122&amp;apos;, &amp;apos;1163&amp;apos;]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apk launcher avarage times:[ThisTime, TotalTime, WaitTime]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[  430.66665649  1137.          1176.77783203]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;redex优化后的数据，优化后TotalTime减少70ms&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&amp;apos;453&amp;apos;, &amp;apos;1129&amp;apos;, &amp;apos;1159&amp;apos;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[[&amp;apos;403&amp;apos;, &amp;apos;1072&amp;apos;, &amp;apos;1099&amp;apos;], [&amp;apos;411&amp;apos;, &amp;apos;1077&amp;apos;, &amp;apos;1123&amp;apos;], [&amp;apos;414&amp;apos;, &amp;apos;1056&amp;apos;, &amp;apos;1085&amp;apos;], [&amp;apos;383&amp;apos;, &amp;apos;1031&amp;apos;, &amp;apos;1077&amp;apos;], [&amp;apos;386&amp;apos;, &amp;apos;1056&amp;apos;, &amp;apos;1102&amp;apos;], [&amp;apos;381&amp;apos;, &amp;apos;1030&amp;apos;, &amp;apos;1071&amp;apos;], [&amp;apos;449&amp;apos;, &amp;apos;1111&amp;apos;, &amp;apos;1148&amp;apos;], [&amp;apos;390&amp;apos;, &amp;apos;1095&amp;apos;, &amp;apos;1127&amp;apos;], [&amp;apos;453&amp;apos;, &amp;apos;1129&amp;apos;, &amp;apos;1159&amp;apos;]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;apk launcher avarage times:[ThisTime, TotalTime, WaitTime]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[  407.777771    1073.          1110.11108398]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#结论&quot; class=&quot;headerlink&quot; title=&quot;结论&quot;&gt;&lt;/a&gt;结论&lt;/h2&gt;&lt;p&gt;Redex可以在Proguard优化后再在dex层面进行优化，Redex需要配置Proguard配置文件来保护一些不应该被优化的类（如JNI调用、反射调用的类等）。&lt;br&gt;根据实际测试结果看Redex优化后可以提升冷启动速度10%左右，apk体积减少100k左右，低于Facebook给出的数据（25%）。原因可能是我测试的Apk比较简单，本身启动速度已经比较快，后面应该找启动速度慢的App进行优化测试。&lt;br&gt;普通App建议在做了Proguard优化后，再根据冷启动测试数据决定是否做Redex优化。&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/redex&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ReDex github&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://code.facebook.com/posts/1480969635539475/optimizing-android-bytecode-with-redex&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Optimizing Android bytecode with ReDex&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzAwMTYwNzE2Mg==&amp;amp;mid=2651036594&amp;amp;idx=1&amp;amp;sn=b276c0f76cea713e5d568ab51e3f7f13&amp;amp;scene=0#wechat_redirect&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;基于 Facebook Redex 实现 Android APK 的压缩和优化&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.trinea.cn/android/facebook%E5%BC%80%E6%BA%90%E7%9A%84android%E4%BC%98%E5%8C%96%E5%B7%A5%E5%85%B7redex-%E5%87%8F%E5%B0%8F%E5%AE%89%E8%A3%85%E5%8C%85%E5%A4%A7%E5%B0%8F-%E5%90%8C%E6%97%B6%E6%8F%90%E9%AB%98%E8%BF%90/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Facebook App 优化工具 ReDex 优化的 6 点及未优化的一大方面&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.jianshu.com/p/236f5ac79520&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;浅谈Android启动时间&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.zhihu.com/question/35487841&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;怎么计算apk的启动时间？&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ReDex 是 Facebook 开源的工具，通过对字节码进行优化，以减小 Android Apk 大小，同时提高 App 启动速度。&lt;br&gt;GitHub：&lt;a href=&quot;https://github.com/facebook/redex&quot;&gt;ReDex github&lt;/a&gt;，官网主页：fbredex.com&lt;/p&gt;
&lt;p&gt;本次研究完成了Redex在Ubuntu linux上的安装和配置，进行了Redex优化测试， 实验了Redex优化的主要流程, 包括Inderdex。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>安卓源码项目进行gradle编译改造常见问题解决</title>
    <link href="http://offbye.com/2017/03/08/%E5%AE%89%E5%8D%93%E6%BA%90%E7%A0%81%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8Cgradle%E7%BC%96%E8%AF%91%E6%94%B9%E9%80%A0%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <id>http://offbye.com/2017/03/08/安卓源码项目进行gradle编译改造常见问题解决/</id>
    <published>2017-03-08T13:42:12.000Z</published>
    <updated>2017-03-08T13:43:03.000Z</updated>
    
    <content type="html">&lt;p&gt;最近把依赖安卓源码编译环境的多个项目切换到gradle编译环境，需要把一些项目改成lib库依赖，基本思路是把通用的代码和第三方jar放在一个utils库项目中， 其他子项目改为lib库，子项目统一依赖utils，主项目依赖9个子项目，解除子项目对主项目的依赖，最后gradle编译成一个apk。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我整理了一些遇到的常见问题，希望对大家有帮助。&lt;br&gt;首先注意的gradle编译比mm方式编译对项目质量的要求更严格，特别是编译release版本，很多命名不规范的资源需要修改， strings缺少的翻译等需要对齐。&lt;/p&gt;
&lt;h2 id=&quot;问题一：&quot;&gt;&lt;a href=&quot;#问题一：&quot; class=&quot;headerlink&quot; title=&quot;问题一：&quot;&gt;&lt;/a&gt;问题一：&lt;/h2&gt;&lt;p&gt;Error:(26, 9) Attribute application@icon value=(@drawable/logo) from AndroidManifest.xml:26:9&lt;br&gt;Error:(28, 9) Attribute application@theme value=(@style/ThemeActionBar) from AndroidManifest.xml:28:9&lt;br&gt;is also present at XXXX-trunk:XXXXLib:unspecified:15:9 value=(@style/AppTheme)&lt;br&gt;Suggestion: add ‘tools:replace=”android:theme”‘ to &lt;application&gt; element at AndroidManifest.xml:24:5 to override&lt;br&gt;Error:Execution failed for task ‘:XXXX:processDebugManifest’.&lt;/application&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Manifest merger failed with multiple errors, see logs&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;原因：&lt;br&gt;AS的Gradle插件默认会启用Manifest Merger Tool，若Library项目中也定义了与主项目相同的属性（例如默认生成的Android:icon和android:theme），则此时会合并失败，并报上面的错误。&lt;/p&gt;
&lt;p&gt;解决方法有以下2种：&lt;br&gt;方法1：在Manifest.xml的application标签下添加tools:replace=”android:icon, android:theme”（多个属性用,隔开，并且记住在manifest根标签上加入xmlns:tools=”&lt;a href=&quot;http://schemas.android.com/tools&amp;quot;，否则会找不到namespace哦）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://schemas.android.com/tools&amp;quot;，否则会找不到namespace哦）&lt;/a&gt;&lt;br&gt;方法2：在build.gradle根标签上加上useOldManifestMerger true （懒人方法）&lt;/p&gt;
&lt;p&gt;参考官方介绍：&lt;br&gt;&lt;a href=&quot;http://tools.android.com/tech-docs/new-build-system/user-guide/manifest-merger&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://tools.android.com/tech-docs/new-build-system/user-guide/manifest-merger&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;问题二：&quot;&gt;&lt;a href=&quot;#问题二：&quot; class=&quot;headerlink&quot; title=&quot;问题二：&quot;&gt;&lt;/a&gt;问题二：&lt;/h2&gt;&lt;p&gt;Library Project里面的BuildConfig.DEBUG永远都是false。这是Android Studio的一个已知问题，某Google的攻城狮说，Library projects目前只会生成release的包。&lt;br&gt;Issue 52962: &lt;a href=&quot;https://code.google.com/p/android/issues/detail?id=52962&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://code.google.com/p/android/issues/detail?id=52962&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;解决方法：（某Google的攻城狮推荐的方法）&lt;br&gt;Workaround: instaed of BuildConfig.DEBUG create another boolean variable at lib-project’s e.g. BuildConfig.RELEASE and link it with application’s buildType.&lt;br&gt;&lt;a href=&quot;https://gist.github.com/almozavr/d59e770d2a6386061fcb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/almozavr/d59e770d2a6386061fcb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;参考stackoverflow上的这篇帖：&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/20176284/buildconfig-debug-always-false-when-building-library-projects-with-gradle&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/20176284/buildconfig-debug-always-false-when-building-library-projects-with-gradle&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;问题三：&quot;&gt;&lt;a href=&quot;#问题三：&quot; class=&quot;headerlink&quot; title=&quot;问题三：&quot;&gt;&lt;/a&gt;问题三：&lt;/h2&gt;&lt;p&gt;Duplicate zip entry error， 这个问题一般是引用了不同版本的com.android.support库，或者不同的jar里面有同名的class文件导致的，需要人工排查了。&lt;/p&gt;
&lt;p&gt;解决方法：&lt;br&gt;Settings-&amp;gt;IDE Settings-&amp;gt;Editor-&amp;gt;Other-&amp;gt;Strip trailing spaces on Save-&amp;gt;None&lt;/p&gt;
&lt;h2 id=&quot;问题四：&quot;&gt;&lt;a href=&quot;#问题四：&quot; class=&quot;headerlink&quot; title=&quot;问题四：&quot;&gt;&lt;/a&gt;问题四：&lt;/h2&gt;&lt;p&gt;编译的时候，报：Failure [INSTALL_FAILED_OLDER_SDK]。一般是系统自动帮你设置了compileSdkVersion&lt;/p&gt;
&lt;p&gt;解决方法：&lt;br&gt;修改build.gradle下的compileSdkVersion ‘android-L’为compileSdkVersion 24&lt;/p&gt;
&lt;h2 id=&quot;问题五：&quot;&gt;&lt;a href=&quot;#问题五：&quot; class=&quot;headerlink&quot; title=&quot;问题五：&quot;&gt;&lt;/a&gt;问题五：&lt;/h2&gt;&lt;p&gt;Error:Executionfailed for task ‘:greencar:processDebugManifest’.&amp;gt; Manifest merger failed withmultipleerrors, see logs。&lt;br&gt;原因：AS的Gradle插件默认会启用Manifest Merger Tool，若Library项目中也定义了与主项目相同的属性（例如默认生成的android:icon和android:theme），则此时会合并失败，并报上面的错误。&lt;br&gt;解决方案：&lt;br&gt;在manifest根标签上加入&lt;code&gt;xmlns:tools=&amp;quot;http://schemas.android.com/tools&amp;quot;&lt;/code&gt;，并在Manifest.xml的application标签下添加&lt;code&gt;tools:replace=&amp;quot;name，icon, label，theme&amp;quot;&lt;/code&gt;&lt;br&gt;以及在主项目的 manifest文件中，重复写了 call_phone的权限，网上也有人是某个activity下多写了一句intent-filter，里面没有内容，将这些重复的空的删掉就好，并将作为lib的minisdk与主项目同步（修改library飞build.gradle文件中最小sdk，或者降低主项目的sdk）&lt;/p&gt;
&lt;h2 id=&quot;问题六：&quot;&gt;&lt;a href=&quot;#问题六：&quot; class=&quot;headerlink&quot; title=&quot;问题六：&quot;&gt;&lt;/a&gt;问题六：&lt;/h2&gt;&lt;p&gt;在作为library的项目中报错：需要常量表达式&lt;br&gt;解决方案：&lt;br&gt;在一般的Android项目中，R类的常量都是用final定义的，但ADT 14之后，如果在library 项目中，它会没有final关键字，而我们在作为library的项目中使用了switch ，在switch语句的case中，如果使用 R.id.xxx 则会提示有问题，不允许非常量在case语句中。&lt;br&gt;Google提供的一个方法就是把它转化为if-else语句。目前我也是用了这个笨办法，还好Android studio 只要按Anter+Enter自动帮改，就是比较烦&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近把依赖安卓源码编译环境的多个项目切换到gradle编译环境，需要把一些项目改成lib库依赖，基本思路是把通用的代码和第三方jar放在一个utils库项目中， 其他子项目改为lib库，子项目统一依赖utils，主项目依赖9个子项目，解除子项目对主项目的依赖，最后gradle编译成一个apk。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>微信小程序开发者工具初体验及实现技术初探</title>
    <link href="http://offbye.com/2017/01/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7%E5%88%9D%E4%BD%93%E9%AA%8C%E5%8F%8A%E5%AE%9E%E7%8E%B0%E6%8A%80%E6%9C%AF%E5%88%9D%E6%8E%A2/"/>
    <id>http://offbye.com/2017/01/10/微信小程序开发者工具初体验及实现技术初探/</id>
    <published>2017-01-10T14:14:50.000Z</published>
    <updated>2017-01-10T15:07:16.000Z</updated>
    
    <content type="html">&lt;p&gt;微信小程序是当前的热点，市面上已经有很多微信小程序开发相关的文章，今天晚上抽了点时间折腾了微信小程序，并顺便看看了下微信小程序开发者工具的实现，是使用Node.js开发的，UI是基于NW.js框架开发的，支持Windows和Mac跨平台。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;微信小程序开发工具初体验&quot;&gt;&lt;a href=&quot;#微信小程序开发工具初体验&quot; class=&quot;headerlink&quot; title=&quot;微信小程序开发工具初体验&quot;&gt;&lt;/a&gt;微信小程序开发工具初体验&lt;/h2&gt;&lt;p&gt;首先当然是先下载个微信小程序开发工具，&lt;a href=&quot;https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html?t=201715&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;微信Web开发者工具下载地址&lt;/a&gt;, 然后顺便找了个感觉还可以的小程序源码&lt;a href=&quot;https://github.com/RebeccaHanjw/weapp-wechat-zhihu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;微信中的知乎–微信小程序 demo&lt;/a&gt;。目前支持Win32，Win64，Mac版本。&lt;br&gt;然后下载或git clone上面提到的Demo代码，打开安装好的微信开发者工具，用微信扫二维码登录，选择本地小程序项目 -&amp;gt; 添加项目，导入项目，AppID可以不填，功能会受限。本来我还以为一定有微信小程序开发者帐号才能用呢？微信小程序开发者帐号的开通门槛还是比较高的，必须是企业帐号，还需要用对公帐号转账验证通过。现在看来只是功能受限。如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1387855-73940b5de1586900.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;小程序调试页面&quot;&gt;&lt;/p&gt;
&lt;p&gt;￼￼￼￼可以看到微信Web开发者工具主要有账户，编辑，调试，项目，刷新，编译，后台，缓存等几个功能，功能还是比较有限的，调试功能主要是整合了Chrome Web开发者工具。&lt;/p&gt;
&lt;h2 id=&quot;微信Web开发者工具是如何实现的&quot;&gt;&lt;a href=&quot;#微信Web开发者工具是如何实现的&quot; class=&quot;headerlink&quot; title=&quot;微信Web开发者工具是如何实现的&quot;&gt;&lt;/a&gt;微信Web开发者工具是如何实现的&lt;/h2&gt;&lt;p&gt;使用node.js和NW.js框架开发的，UI是基于NW.js框架开发的，支持Windows和Mac跨平台。这是很现实的技术选择，小程序的整个技术栈是基于H5的，虽然在UI框架层面自己实现了一套，但基础的js，css语法大部分还是支持的，因此开发者工具用node.js实现也是很正常的，现在我只是奇怪为什么微信没有选择用Atom Shell呢？就像Facebook的nuclide IDE那样，基于Atom编辑做个IDE？&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.tuicool.com/articles/aAFZzmi&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;使用 NodeJS 框架 NW.js 编写桌面应用入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/RebeccaHanjw/weapp-wechat-zhihu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;微信中的知乎–微信小程序 demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;微信小程序是当前的热点，市面上已经有很多微信小程序开发相关的文章，今天晚上抽了点时间折腾了微信小程序，并顺便看看了下微信小程序开发者工具的实现，是使用Node.js开发的，UI是基于NW.js框架开发的，支持Windows和Mac跨平台。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>我眼中的全栈工程师</title>
    <link href="http://offbye.com/2016/11/19/%E6%88%91%E7%90%86%E8%A7%A3%E7%9A%84%E5%85%A8%E6%A0%88%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84/"/>
    <id>http://offbye.com/2016/11/19/我理解的全栈工程师是怎样的/</id>
    <published>2016-11-19T15:02:37.000Z</published>
    <updated>2016-11-27T07:30:58.000Z</updated>
    
    <content type="html">&lt;p&gt;现在越来越多的创业公司都想找全栈工程师，因此市场上就出现了很多伪全栈工程师，特别是学会了Node的前端工程师，前端工程师会Node就全栈了？这严重不符合我对全栈工程师的理解，这篇文章我主要是说下我对全栈工程师的个人看法。在我眼里，全栈工程师是下能玩硬件和驱动，上能写网页和js，中间能玩转服务器和数据库，没事还能自己做个安卓或iOS App， 对IT系统有着全面深刻的理解，熟悉所负责项目的整体技术栈。&lt;br&gt;我认为全栈工程师的特质应该有以下几个：强大的解决问题能力；广博的知识面，快速学习能力，不给自己设限，主动学习新技术；熟悉多种编程语言，熟悉整个系统从上到下的技术实现。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1387855-d439d0d02fe0e923.gif?imageMogr2/auto-orient/strip&quot; alt=&quot;无人机之父拉菲罗·安德烈&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;强大的解决问题能力&quot;&gt;&lt;a href=&quot;#强大的解决问题能力&quot; class=&quot;headerlink&quot; title=&quot;强大的解决问题能力&quot;&gt;&lt;/a&gt;强大的解决问题能力&lt;/h2&gt;&lt;p&gt;我觉得强大的解决问题能力是全栈工程师最重要的素质，也是全栈工程师的核心能力。&lt;br&gt;全栈工程师的解决问题能力，应该不局限于软件研发中碰到的技术问题，范围可以扩展到工程和科学相关的问题。这一点我们要向国外的极客大神们学习，国外很多极客具备硬件，软件，网络和人工智能等领域的全方位能力，例如无人机领域的大神&lt;a href=&quot;http://www.jiemian.com/article/848201.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;拉菲罗·安德烈&lt;/a&gt;。亚马逊运营中心里酷炫的、数以万计的Kiva机器人，就出自他手。公司被亚马逊收购后，这位“疯狂”的科技极客把注意力投向了无人机领域，三年时间研制出全球首个全向无人机。2015年获得“电子工程领域的诺贝尔奖”的IEEE机器人和自动化国际会议大奖，被人称为无人机之父。&lt;/p&gt;
&lt;p&gt;在软件开发过程中所遇到的问题，真正的技术问题只占一部分，很多问题可能是工程或管理方面的问题。全栈工程师善于用全领域的知识积累从更本质的层面上找到解决问题的办法，而不是局限于某一种技术上寻求解决方案。例如前段时间遇到的HTML5 Hybrid App在某些安卓手机上兼容问题，最终的解决方案就是修改js代码，而是直接把Cordova的webview内核换成了腾讯X5内核，这个如果没有全栈技术能力是不可能做到的。&lt;/p&gt;
&lt;h2 id=&quot;快速学习能力，不给自己设限，主动学习新技术&quot;&gt;&lt;a href=&quot;#快速学习能力，不给自己设限，主动学习新技术&quot; class=&quot;headerlink&quot; title=&quot;快速学习能力，不给自己设限，主动学习新技术&quot;&gt;&lt;/a&gt;快速学习能力，不给自己设限，主动学习新技术&lt;/h2&gt;&lt;p&gt;全栈工程师应该时刻保持开放的心态，主动学习新技术，能够快速进入新技术领域。广博的知识面有助于通过类比和知识迁移的方式，提高学习掌握新技术的速度。&lt;br&gt;例如做Java Web后端可以去熟悉前端开发的技术。做安卓开发的可以去学习iOS开发。做iOS的可以去学习下HTML5移动开发，研究下js。&lt;br&gt;我们现在计算机体系其实都是相通的，不同的编程语言体系，不同的操作系统平台，同样的任务或技术架构的处理方式可能是类似的，因此全栈工程师&lt;br&gt;现在我们已经进入了移动互联网的下半场，未来的大趋势是人工智能，全栈工程师对于人工智能，机器学习，深度学习等领域也要尽早准备学习了。&lt;/p&gt;
&lt;h2 id=&quot;熟悉多种编程语言，熟悉整个系统从上到下的技术实现&quot;&gt;&lt;a href=&quot;#熟悉多种编程语言，熟悉整个系统从上到下的技术实现&quot; class=&quot;headerlink&quot; title=&quot;熟悉多种编程语言，熟悉整个系统从上到下的技术实现&quot;&gt;&lt;/a&gt;熟悉多种编程语言，熟悉整个系统从上到下的技术实现&lt;/h2&gt;&lt;p&gt;我个人认为全栈工程师至少要熟悉5种编程语言，工作中不能只用一种特定编程语言。&lt;br&gt;现在TIOBE排行榜上主流的编程语言Java, C/C++, C#, Python, Javascript, PHP,Ruby,OC等都应该熟悉，Groovy,Scala,Go,Swift,Kotlin等相对比较新的编程语言也应该熟悉或了解几种。这样就可以根据具体情况（项目特质和团队情况）选择合适的技术栈，而不是整个系统只能用一种语言完成。当然了，大的项目具体的代码肯定应该由团队分工合作完成，但全栈工程师还是应该对项目整个技术栈具备一定的掌控力。&lt;br&gt;做Java Web应用的全栈工程师，应该熟悉Java,Javascipt,CSS,HTML,SQL,XML等常用语言，并且熟悉常用的前后端技术框架，例如Spring，JPA，Mybatis，Jquery，AngularJs，React等。用PHP，Python，Ruby，微软.net等技术栈做Web应用的应该也类似。&lt;br&gt;做移动互联网应用的全栈工程师，应该熟悉Android，iOS开发或微信开发，以及服务器端接口的开发，这样才能做到沟通无障碍。&lt;/p&gt;
&lt;h2 id=&quot;全栈工程师的钱景和前景&quot;&gt;&lt;a href=&quot;#全栈工程师的钱景和前景&quot; class=&quot;headerlink&quot; title=&quot;全栈工程师的钱景和前景&quot;&gt;&lt;/a&gt;全栈工程师的钱景和前景&lt;/h2&gt;&lt;p&gt;成为一名真正的全栈工程师需要经过长期的持续学习和不断折腾，其中的甘苦只有自己知道。但和数年坚持一个领域的专家型人才相比，在薪酬方面全栈工程师可能并没有优势，这是可以理解的，因为在就业市场上，特别是像BAT这些比较大的公司，倾向于给行业顶级水平的人才很高的报酬，这符合赢者通吃的社会法则。而全栈工程师，由于关注和学习的领域太多，有限的精力必然被分散，导致在某个特定领域会比不上领域专家，因此在职业生涯早期和中期并不容易拿到足够高的收入。&lt;/p&gt;
&lt;p&gt;从长期回报看，全栈工程师在架构师，CTO，技术合伙人等高端技术职务上会比领域技术专家更有优势，全面的技术背景有助于做出更加全面客观的技术架构和决策，从而对所在组织产生很大的正面影响。&lt;/p&gt;
&lt;p&gt;对于创业公司，全栈工程师发挥空间会更大，多面手的特长可以帮助团队快速完成早期技术产品，成为公司创始人或技术合伙人，发展前景会很大。每一个全栈工程师，都有过一个创业梦。能否创业成功，在于是否有足够的勇气，综合能力和机遇。&lt;/p&gt;
&lt;p&gt;真正的全栈工程师，对新技术有着强烈的好奇心，敢于不断地走出自己的舒适区，勇敢进入新的技术领域！&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;现在越来越多的创业公司都想找全栈工程师，因此市场上就出现了很多伪全栈工程师，特别是学会了Node的前端工程师，前端工程师会Node就全栈了？这严重不符合我对全栈工程师的理解，这篇文章我主要是说下我对全栈工程师的个人看法。在我眼里，全栈工程师是下能玩硬件和驱动，上能写网页和js，中间能玩转服务器和数据库，没事还能自己做个安卓或iOS App， 对IT系统有着全面深刻的理解，熟悉所负责项目的整体技术栈。&lt;br&gt;我认为全栈工程师的特质应该有以下几个：强大的解决问题能力；广博的知识面，快速学习能力，不给自己设限，主动学习新技术；熟悉多种编程语言，熟悉整个系统从上到下的技术实现。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何使用repo下载部分Android源码</title>
    <link href="http://offbye.com/2016/11/01/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8repo%E4%B8%8B%E8%BD%BD%E9%83%A8%E5%88%86Android%E6%BA%90%E7%A0%81/"/>
    <id>http://offbye.com/2016/11/01/如何使用repo下载部分Android源码/</id>
    <published>2016-11-01T14:19:34.000Z</published>
    <updated>2016-11-01T14:52:19.000Z</updated>
    
    <content type="html">&lt;p&gt;最近打算重新折腾下Android源码，由于网速慢和Mac的SSD磁盘空间不太够的原因，打算只下载部分想研究的Android源码看看，但又想保留android源码本身的结构，因此不能直接clone github上的android源码项目。目前android 7.0源码完整下载估计在40G左右，如果翻墙下载网速比较慢，可能几天都下不好，也就不要折腾了。&lt;/p&gt;
&lt;p&gt;在分析了.repo目录下面的文件之后，我找到一个简单的方法，可以只下载部分源码的git项目，现在安卓源码一共由500多个git项目组成，一个人想了解全部源码基本上是不可能的，只能研究下重要的或者是工作涉及的部分。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;由于是Mac上，需要按照官方的说明做些准备工作，具体参考&lt;a href=&quot;http://source.android.com/source/initializing.html#setting-up-a-mac-os-x-build-environment&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://source.android.com/source/initializing.html#setting-up-a-mac-os-x-build-environment&lt;/a&gt;&lt;br&gt;，具体做法如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 创建一个大小写敏感的磁盘镜像文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdiutil create -type SPARSE -fs &amp;apos;Case-sensitive Journaled HFS+&amp;apos; -size 40g ~/android.dmg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改~/.bash_profile，加入2个函数&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# mount the android file image&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;function mountAndroid &amp;#123; hdiutil attach ~/android.dmg -mountpoint /Volumes/android; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# unmount the android file image&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;function umountAndroid() &amp;#123; hdiutil detach /Volumes/android; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;运行&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;source ~/.bash_profile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; mountAndroid   #挂载磁盘镜像到/Volumes/android&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd  /Volumes/android&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;因为本文不涉及到编译源码，所以编译环境相关但步骤就不介绍了，官方文档挺详细的。&lt;br&gt;下面介绍下repo吧&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;repo是什么？&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;repo是一种代码版本管理工具，它是由一系列的Python脚本组成，封装了一系列的Git命令，用来统一管理多个Git仓库。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;为什么要用repo？&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;因为Android源码引用了很多开源项目，每一个子项目都是一个Git仓库，每个Git仓库都有很多分支版本，为了方便统一管理各个子项目的Git仓库，需要一个上层工具批量进行处理，因此repo诞生。&lt;/p&gt;
&lt;p&gt;最后重点到了，看下.repo/manifests/default.xml文件，内容大概如下&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;manifest&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;remote  name=&amp;quot;aosp&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           fetch=&amp;quot;..&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;default revision=&amp;quot;refs/tags/android-7.0.0_r14&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           remote=&amp;quot;aosp&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           sync-j=&amp;quot;4&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;project path=&amp;quot;build&amp;quot; name=&amp;quot;platform/build&amp;quot; groups=&amp;quot;pdk,tradefed&amp;quot; &amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;copyfile src=&amp;quot;core/root.mk&amp;quot; dest=&amp;quot;Makefile&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/project&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;project path=&amp;quot;build/blueprint&amp;quot; name=&amp;quot;platform/build/blueprint&amp;quot; groups=&amp;quot;pdk,tradefed&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;project path=&amp;quot;build/kati&amp;quot; name=&amp;quot;platform/build/kati&amp;quot; groups=&amp;quot;pdk,tradefed&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;!-- &amp;lt;project path=&amp;quot;build/soong&amp;quot; name=&amp;quot;platform/build/soong&amp;quot; groups=&amp;quot;pdk,tradefed&amp;quot; &amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;linkfile src=&amp;quot;root.bp&amp;quot; dest=&amp;quot;Android.bp&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;linkfile src=&amp;quot;bootstrap.bash&amp;quot; dest=&amp;quot;bootstrap.bash&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/project&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;project path=&amp;quot;abi/cpp&amp;quot; name=&amp;quot;platform/abi/cpp&amp;quot; groups=&amp;quot;pdk&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;project path=&amp;quot;art&amp;quot; name=&amp;quot;platform/art&amp;quot; groups=&amp;quot;pdk&amp;quot; /&amp;gt; --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ......&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/manifest&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;看到了吧，只要把不需要下载的源码project注释掉，然后运行repo sync就可以只下载没有被注释掉的项目了。当然这种办法只能用了研究源码，如果要编译源码，只下载一部分肯定是不行的。&lt;br&gt;repo sync后的项目结构如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tree -L 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── CleanSpec.mk&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── blueprint&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── buildspec.mk.default&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── core&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── envsetup.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── kati&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── libs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── target&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── tools&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd kati&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;repo info .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Manifest branch: refs/tags/android-7.0.0_r14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Manifest merge branch: refs/heads/android-7.0.0_r14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Manifest groups: all,-notdefault&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Project: platform/build/kati&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Mount path: /Volumes/android/N/build/kati&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Current revision: refs/tags/android-7.0.0_r14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Local Branches: 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样我们就实现了用repo sync只下载想要的安卓源码项目的目的。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近打算重新折腾下Android源码，由于网速慢和Mac的SSD磁盘空间不太够的原因，打算只下载部分想研究的Android源码看看，但又想保留android源码本身的结构，因此不能直接clone github上的android源码项目。目前android 7.0源码完整下载估计在40G左右，如果翻墙下载网速比较慢，可能几天都下不好，也就不要折腾了。&lt;/p&gt;
&lt;p&gt;在分析了.repo目录下面的文件之后，我找到一个简单的方法，可以只下载部分源码的git项目，现在安卓源码一共由500多个git项目组成，一个人想了解全部源码基本上是不可能的，只能研究下重要的或者是工作涉及的部分。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android N" scheme="http://offbye.com/tags/Android-N/"/>
    
      <category term="源码" scheme="http://offbye.com/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>用Zepto代替Jquery提升移动Web用户体验</title>
    <link href="http://offbye.com/2016/10/18/%E7%94%A8Zepto%E4%BB%A3%E6%9B%BFJquery%E6%8F%90%E5%8D%87%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C/"/>
    <id>http://offbye.com/2016/10/18/用Zepto代替Jquery提升移动端用户体验/</id>
    <published>2016-10-18T07:48:58.000Z</published>
    <updated>2016-10-19T01:50:33.000Z</updated>
    
    <content type="html">&lt;p&gt;jQuery现在已经是Web开发者比较依赖的一个库.甚至在很多公司内部也把jQuery当成了一个基本库来使用.&lt;/p&gt;
&lt;p&gt;但随着移动端的流行使用庞大的jQuery去支撑移动端的开发显得有些重量级了,于是就出现了一个轻量级兼容库Zepto.js.&lt;/p&gt;
&lt;p&gt;Zepto是作为为了支持移动端的浏览器而开发的一个和jQuery API极度相似的一个库, 如果你会用jquery，那么你也会用zepto,这样就大大降低团队协作的成本,不用改变开发习惯也能迅速的进行移动端开发.&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Zepto设计的目的是提供jquery的类似的APIs，但并不是100%覆盖jquery为目的。zepto设计的目的是有一个5-10k的通用库、下载并执行快、有一个熟悉通用的API，所以你能把你主要的精力放到应用开发上。&lt;/p&gt;
&lt;p&gt;具体到我们的项目，由于各种原因，开始时并没有使用Zepto而是使用了Jquery。这轮性能优化打算换成Zepto，毕竟size查了10倍啊。但是简单的把js引入替换成zeptp显然是不行的。由于用了lazyload等插件，依赖了jQuery的$.Defered, 还用了css3的一些selector，因此还有需要引入Zepto的一些扩展模块，Zepto默认提供的压缩文件只包含几个默认模块，可以通过命令自定义打包其它模块，也可以通过&lt;a href=&quot;http://github.e-sites.nl/zeptobuilder/进行在线自定义打包和压缩。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://github.e-sites.nl/zeptobuilder/进行在线自定义打包和压缩。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;兼容Zepto的lazyload插件可以用这个&lt;a href=&quot;https://github.com/jieyou/lazyload&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jieyou/lazyload&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Zepto-modules&quot;&gt;&lt;a href=&quot;#Zepto-modules&quot; class=&quot;headerlink&quot; title=&quot;Zepto modules&quot;&gt;&lt;/a&gt;Zepto modules&lt;/h2&gt;&lt;p&gt;Zepto modules are individual files in the “src/“ directory.&lt;/p&gt;
&lt;table&gt;&lt;br&gt;&lt;thead&gt;&lt;tr&gt;&lt;br&gt;  &lt;th&gt;module&lt;/th&gt; &lt;th&gt;default&lt;/th&gt; &lt;th&gt;description&lt;/th&gt;&lt;br&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;br&gt;&lt;tbody&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/zepto.js#files&quot;&gt;zepto&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;✔&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Core module; contains most methods&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/event.js#files&quot;&gt;event&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;✔&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Event handling via &lt;code&gt;on()&lt;/code&gt; &amp;amp; &lt;code&gt;off()&lt;/code&gt;&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/ajax.js#files&quot;&gt;ajax&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;✔&lt;/td&gt;&lt;br&gt;    &lt;td&gt;XMLHttpRequest and JSONP functionality&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/form.js#files&quot;&gt;form&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;✔&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Serialize &amp;amp; submit web forms&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/ie.js#files&quot;&gt;ie&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;✔&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Support for Internet Explorer 10+ on the desktop and Windows Phone 8&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/detect.js#files&quot;&gt;detect&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Provides &lt;code&gt;$.os&lt;/code&gt; and &lt;code&gt;$.browser&lt;/code&gt; information&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/fx.js#files&quot;&gt;fx&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;The &lt;code&gt;animate()&lt;/code&gt; method&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/fx_methods.js#files&quot;&gt;fx_methods&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Animated &lt;code&gt;show&lt;/code&gt;, &lt;code&gt;hide&lt;/code&gt;, &lt;code&gt;toggle&lt;/code&gt;,&lt;br&gt;      and &lt;code&gt;fade*()&lt;/code&gt; methods.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/assets.js#files&quot;&gt;assets&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Experimental support for cleaning up iOS memory after removing&lt;br&gt;      image elements from the DOM.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/data.js#files&quot;&gt;data&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      A full-blown &lt;code&gt;data()&lt;/code&gt; method, capable of storing arbitrary&lt;br&gt;      objects in memory.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/deferred.js#files&quot;&gt;deferred&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Provides &lt;code&gt;$.Deferred&lt;/code&gt; promises API.&lt;br&gt;      Depends on the “callbacks” module.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/callbacks.js#files&quot;&gt;callbacks&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Provides &lt;code&gt;$.Callbacks&lt;/code&gt; for use in “deferred” module.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/selector.js#files&quot;&gt;selector&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Experimental &lt;a href=&quot;http://api.jquery.com/category/selectors/jquery-selector-extensions/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;jQuery&lt;br&gt;      CSS extensions&lt;/a&gt; support for functionality such as &lt;code&gt;$(‘div:first’)&lt;/code&gt; and&lt;br&gt;      &lt;code&gt;el.is(‘:visible’)&lt;/code&gt;.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/touch.js#files&quot;&gt;touch&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      Fires tap– and swipe–related events on touch devices. This works with both&lt;br&gt;      &lt;code&gt;touch&lt;/code&gt; (iOS, Android) and &lt;code&gt;pointer&lt;/code&gt; events (Windows Phone).&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/gesture.js#files&quot;&gt;gesture&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Fires pinch gesture events on touch devices&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/stack.js#files&quot;&gt;stack&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;Provides &lt;code&gt;andSelf&lt;/code&gt; &amp;amp; &lt;code&gt;end()&lt;/code&gt; chaining methods&lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;  &lt;tr&gt;&lt;br&gt;    &lt;th&gt;&lt;a href=&quot;src/ios3.js#files&quot;&gt;ios3&lt;/a&gt;&lt;/th&gt;&lt;br&gt;    &lt;td&gt;&lt;/td&gt;&lt;br&gt;    &lt;td&gt;&lt;br&gt;      String.prototype.trim and Array.prototype.reduce methods&lt;br&gt;      (if they are missing) for compatibility with iOS 3.x.&lt;br&gt;    &lt;/td&gt;&lt;br&gt;  &lt;/tr&gt;&lt;br&gt;&lt;/tbody&gt;&lt;br&gt;&lt;/table&gt;


&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;jQuery现在已经是Web开发者比较依赖的一个库.甚至在很多公司内部也把jQuery当成了一个基本库来使用.&lt;/p&gt;
&lt;p&gt;但随着移动端的流行使用庞大的jQuery去支撑移动端的开发显得有些重量级了,于是就出现了一个轻量级兼容库Zepto.js.&lt;/p&gt;
&lt;p&gt;Zepto是作为为了支持移动端的浏览器而开发的一个和jQuery API极度相似的一个库, 如果你会用jquery，那么你也会用zepto,这样就大大降低团队协作的成本,不用改变开发习惯也能迅速的进行移动端开发.&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>PyCon2016上海站参会感想</title>
    <link href="http://offbye.com/2016/09/21/PyCon2016%E4%B8%8A%E6%B5%B7%E5%8F%82%E4%BC%9A%E6%84%9F%E6%83%B3/"/>
    <id>http://offbye.com/2016/09/21/PyCon2016上海参会感想/</id>
    <published>2016-09-21T01:04:23.000Z</published>
    <updated>2016-10-12T10:48:57.000Z</updated>
    
    <content type="html">&lt;p&gt;2016年9月10日早上5点多做高铁去上海参加&lt;a href=&quot;http://cn.pycon.org/2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PyCon2016大会&lt;/a&gt;，这是我第二次参加PyCon大会，上一次是2014年，我觉得这是一个比其它的技术大会有意思的大会。在拖了整整一个月后，今天终于抽时间把参会感想整理出来了。PyCon大会是Python语言社群全球性的盛会，PyConChina是由CPyUG(华蠎用户组)获得授权举办的中国PyCon年会。&lt;/p&gt;
&lt;p&gt;本次大会的主题是Pythonic, C’est la vie!  法语：Pythonic，这就是生活！&lt;br&gt;这次大会很好的体现了这个主题，演讲的嘉宾来自不同的行业，而不仅仅是传统的软件和互联网行业。印象比较深刻的2场演讲是vn.py的作者介绍Python和vn.py在Quant量化投资领域中的运用，《基于Python的谷歌TensorFlow深度学习框架的介绍》，《用高魔的姿势调Python程序》。具体的日程和PPT&lt;a href=&quot;http://cn.pycon.org/2016/shanghai.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;在这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;根据大会一场演讲中互动环境的Python用户情况现场调查，现场只要不到30%的人专职做Python开发的，其它的参会者都是在工作部分用到或业余用到Python。这个应该和Python的适用场景有关， Python作为一个有20多年历史，有着特殊的缩进语法风格，历史上积累的大量第三方库，跨平台，开始时是作为脚本语言推广，现在已经发展成了通用编程语言，有着广泛的使用场景。我自己主要是在工作中的小项目上用Python，例如几个月前用Python做了Android和iOS App的持续集成系统，通过jenkins自动调用Python脚本生成App，H5下载网页和二维码，方便测试。另外，以前折腾树莓派也是Python，使用RPi.GPIO库控制硬件，写代码效率比用C语言高很多，适合折腾。后面有兴趣研究下TensorFlow深度学习框架。&lt;/p&gt;
&lt;p&gt;还有一个演讲是介绍基于Python的ERP系统Odoo, 但我感觉ERP这种产品是企业的神经啊，需要贴合国情，而Odoo是主要是在欧洲使用的，不一定适合国内情况，虽然可以做扩展。基于Python对系统的维护也会带有一些问题，国内熟悉Python的人相对较少，并且也不一定愿意去做ERP，搞机器学习多高端啊。&lt;/p&gt;
&lt;p&gt;总之，今年的PyCon2016大会上海站还是诚意满满的，分享的东西都比较有意思。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;2016年9月10日早上5点多做高铁去上海参加&lt;a href=&quot;http://cn.pycon.org/2016/&quot;&gt;PyCon2016大会&lt;/a&gt;，这是我第二次参加PyCon大会，上一次是2014年，我觉得这是一个比其它的技术大会有意思的大会。在拖了整整一个月后，今天终于抽时间把参会感想整理出来了。PyCon大会是Python语言社群全球性的盛会，PyConChina是由CPyUG(华蠎用户组)获得授权举办的中国PyCon年会。&lt;/p&gt;
&lt;p&gt;本次大会的主题是Pythonic, C’est la vie!  法语：Pythonic，这就是生活！&lt;br&gt;这次大会很好的体现了这个主题，演讲的嘉宾来自不同的行业，而不仅仅是传统的软件和互联网行业。印象比较深刻的2场演讲是vn.py的作者介绍Python和vn.py在Quant量化投资领域中的运用，《基于Python的谷歌TensorFlow深度学习框架的介绍》，《用高魔的姿势调Python程序》。具体的日程和PPT&lt;a href=&quot;http://cn.pycon.org/2016/shanghai.html&quot;&gt;在这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;根据大会一场演讲中互动环境的Python用户情况现场调查，现场只要不到30%的人专职做Python开发的，其它的参会者都是在工作部分用到或业余用到Python。这个应该和Python的适用场景有关， Python作为一个有20多年历史，有着特殊的缩进语法风格，历史上积累的大量第三方库，跨平台，开始时是作为脚本语言推广，现在已经发展成了通用编程语言，有着广泛的使用场景。我自己主要是在工作中的小项目上用Python，例如几个月前用Python做了Android和iOS App的持续集成系统，通过jenkins自动调用Python脚本生成App，H5下载网页和二维码，方便测试。另外，以前折腾树莓派也是Python，使用RPi.GPIO库控制硬件，写代码效率比用C语言高很多，适合折腾。后面有兴趣研究下TensorFlow深度学习框架。&lt;/p&gt;
&lt;p&gt;还有一个演讲是介绍基于Python的ERP系统Odoo, 但我感觉ERP这种产品是企业的神经啊，需要贴合国情，而Odoo是主要是在欧洲使用的，不一定适合国内情况，虽然可以做扩展。基于Python对系统的维护也会带有一些问题，国内熟悉Python的人相对较少，并且也不一定愿意去做ERP，搞机器学习多高端啊。&lt;/p&gt;
&lt;p&gt;总之，今年的PyCon2016大会上海站还是诚意满满的，分享的东西都比较有意思。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Cordova整合使用腾讯浏览服务X5内核</title>
    <link href="http://offbye.com/2016/09/14/Cordova%E6%95%B4%E5%90%88%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1X5%E5%86%85%E6%A0%B8/"/>
    <id>http://offbye.com/2016/09/14/Cordova整合使用腾讯浏览服务X5内核/</id>
    <published>2016-09-14T07:54:20.000Z</published>
    <updated>2016-09-16T13:59:13.000Z</updated>
    
    <content type="html">&lt;p&gt;在对基于Cordova的Android混合App的性能优化过程中，遇到了很多在不同安卓版本手机上的Bug，很多都是安卓不同版本的系统webview的差异导致的，有可能是安卓系统的问题，也有可能是手机厂商修改webkit带来的问题，这些问题从前端技术层面是很难解决的，修改和测试成本都非常高。因此我想通过使用统一webkit内核的大招来解决，目前有2个方案可选，使用Crosswalk内核或腾讯浏览服务X5内核。本文主要研究Cordova整合使用腾讯浏览服务X5内核。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;问题背景&quot;&gt;&lt;a href=&quot;#问题背景&quot; class=&quot;headerlink&quot; title=&quot;问题背景&quot;&gt;&lt;/a&gt;问题背景&lt;/h2&gt;&lt;p&gt;熟悉Cordova生态圈的朋友可能听说过Crosswalk，&lt;a href=&quot;https://crosswalk-project.org/documentation/cordova.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Crosswalk&lt;/a&gt;是Intel维护的Webkit开源项目，可以通过插件安装命令&lt;code&gt;cordova plugin add cordova-plugin-crosswalk-webview&lt;/code&gt; 安装，它的缺点就是太大了，集成后apk会增加20M，安装后会占用50M空间，因此一般不推荐普通App使用Crosswalk。&lt;/p&gt;
&lt;p&gt;然后我就找到了&lt;a href=&quot;http://x5.tencent.com/index&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;腾讯浏览服务X5&lt;/a&gt;,它是直接使用微信/手机QQ/空间的X5浏览器内核的，SDK只有250k，因此可以放心使用。鉴于这几个产品国内广泛的装机量，用户覆盖方面不用担心，如果微信/手机QQ/空间都没有安装，会自动降级到系统浏览器内核，或提示用户安装X5内核。&lt;/p&gt;
&lt;h2 id=&quot;腾讯X5内核介绍&quot;&gt;&lt;a href=&quot;#腾讯X5内核介绍&quot; class=&quot;headerlink&quot; title=&quot;腾讯X5内核介绍&quot;&gt;&lt;/a&gt;腾讯X5内核介绍&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;X5SDK是通过调用微信/手机QQ/空间的X5内核，解决系统webview兼容性差、加载速度慢、功能缺陷等问题，开发接入便捷，大小只有253K，仅需几行代码，即可解决一切令开发者们头疼的问题，为用户提供最优秀的浏览体验。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;同时，QQ浏览器团队还将持续更新和优化X5内核，持续优化功能，并保证兼容各种web新特性。&lt;/p&gt;
&lt;p&gt;其相对于系统webview，具有下述明显优势：&lt;/p&gt;
&lt;p&gt;1) 速度快：相比系统webView的网页加载速度有近30%的提升。&lt;br&gt;2) 省流量：云端优化技术使流量节省20%&lt;br&gt;3) 更安全：24小时安全问题解决机制&lt;br&gt;4) 更稳定：经过亿级用户的使用考验，CRASH率0.15%&lt;br&gt;5) 集成强大的视频播放器，支持各种视频格式直接打开&lt;br&gt;6) 适屏排版、字体设置等浏览增强功能的提供&lt;br&gt;7) Html5更完整支持。&lt;br&gt;8) 无系统内核的碎片化问题，更少的兼容性问题&lt;/p&gt;
&lt;h2 id=&quot;Cordova整合腾讯X5内核&quot;&gt;&lt;a href=&quot;#Cordova整合腾讯X5内核&quot; class=&quot;headerlink&quot; title=&quot;Cordova整合腾讯X5内核&quot;&gt;&lt;/a&gt;Cordova整合腾讯X5内核&lt;/h2&gt;&lt;p&gt;腾讯浏览服务官方只提供了如何把系统Webview替换成X5的接入文档，并没有提供Cordova集成的方法，论坛里有人问这个问题也没有官方回复。现在项目里面用了很多Cordoca插件提供拍照，扫二维码，App支付宝支付等功能，因此就需要把cordova和x5结合起来。&lt;/p&gt;
&lt;p&gt;Cordova框架现在已经很完善，Cordova的Web Engine也是基于接口开发的，因此我参考系统engine的实现，写了一个x5engine插件，解决了Cordova调用X5内核的问题。&lt;/p&gt;
&lt;p&gt;后面我会把这部分功能做成了一个Cordova插件，方便大家使用,github地址&lt;a href=&quot;https://github.com/offbye/cordova-plugin-x5engine-webview。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/offbye/cordova-plugin-x5engine-webview。&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;遇到的问题&quot;&gt;&lt;a href=&quot;#遇到的问题&quot; class=&quot;headerlink&quot; title=&quot;遇到的问题&quot;&gt;&lt;/a&gt;遇到的问题&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;64位手机上加载包含x5 so文件的插件报错&lt;br&gt;`TBS:initX5Core – loadSucc: false; exception: java.lang.reflect.InvocationTargetException; cause: java.lang.UnsatisfiedLinkError: dlopen failed: “/data/data/com.tencent.mm/app_tbs/core_share/libmttwebview.so” is 32-bit instead of 64-bit&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;`
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解决办法是在armeabi增加一个32位的jni so， 随便弄个小一点的so加上就可以，如果已经用了其它的JNI so应该不会有这个错误。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;X5内核不支持file://本地域url，但支持本地相对路径。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在对基于Cordova的Android混合App的性能优化过程中，遇到了很多在不同安卓版本手机上的Bug，很多都是安卓不同版本的系统webview的差异导致的，有可能是安卓系统的问题，也有可能是手机厂商修改webkit带来的问题，这些问题从前端技术层面是很难解决的，修改和测试成本都非常高。因此我想通过使用统一webkit内核的大招来解决，目前有2个方案可选，使用Crosswalk内核或腾讯浏览服务X5内核。本文主要研究Cordova整合使用腾讯浏览服务X5内核。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Swift和Javascript ES6/ES7比较研究</title>
    <link href="http://offbye.com/2016/09/13/Swift%E5%92%8CJavascript-ES6-ES7%E6%AF%94%E8%BE%83%E7%A0%94%E7%A9%B6/"/>
    <id>http://offbye.com/2016/09/13/Swift和Javascript-ES6-ES7比较研究/</id>
    <published>2016-09-13T03:47:36.000Z</published>
    <updated>2016-09-13T04:08:02.000Z</updated>
    
    <content type="html">&lt;p&gt;古罗马著名学者塔西陀曾说：“要想认识自己，就要把自己同别人进行比较“。比较是认识事物的基础，是人类认识、区别和确定事物异同关系的最常用的思维方法。比较研究法现已被广泛运用于科学研究的各个领域。在语言学，教育学，文学等社会科学研究中，比较研究是一种重要的研究方法。&lt;br&gt;本文将比较研究下Swift和Javascript ES6/ES7这2种当前最新的编程语言，看看两者在函数式编程，面向对象，面向协议等编程范式，以及部分语法细节方面的差异。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;1-变量定义比较&quot;&gt;&lt;a href=&quot;#1-变量定义比较&quot; class=&quot;headerlink&quot; title=&quot;1. 变量定义比较&quot;&gt;&lt;/a&gt;1. 变量定义比较&lt;/h2&gt;&lt;p&gt;Swift用var定义变量，let定义常量，一般情况我会先把所有变量都用let定义，需要时再改成var。&lt;br&gt;Javascript ES6以前版本没有let，只有var， var不支持块级作用域，如果一个变量没有用var定义，则默认是全局变量。&lt;br&gt;Javascript ES6引入了let和const， let用来定义&lt;strong&gt;变量&lt;/strong&gt;，const用来定义常量；let定义的变量支持块级作用域，var定义的不支持块级作用域，因此推荐用let定义变量。&lt;br&gt;由此可见，Swift的变量定义更友好合理，毕竟是新语言，没有历史包袱。&lt;/p&gt;
&lt;h2 id=&quot;2-类和继承&quot;&gt;&lt;a href=&quot;#2-类和继承&quot; class=&quot;headerlink&quot; title=&quot;2. 类和继承&quot;&gt;&lt;/a&gt;2. 类和继承&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;古罗马著名学者塔西陀曾说：“要想认识自己，就要把自己同别人进行比较“。比较是认识事物的基础，是人类认识、区别和确定事物异同关系的最常用的思维方法。比较研究法现已被广泛运用于科学研究的各个领域。在语言学，教育学，文学等社会科学研究中，比较研究是一种重要的研究方法。&lt;br&gt;本文将比较研究下Swift和Javascript ES6/ES7这2种当前最新的编程语言，看看两者在函数式编程，面向对象，面向协议等编程范式，以及部分语法细节方面的差异。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Node.js中使用redis数据库的正确姿势</title>
    <link href="http://offbye.com/2016/09/06/%E5%9C%A8koa-js%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%BC%82%E6%AD%A5%E6%96%B9%E5%BC%8F%E6%93%8D%E4%BD%9Credis%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>http://offbye.com/2016/09/06/在koa-js中使用异步方式操作redis数据库/</id>
    <published>2016-09-06T11:28:58.000Z</published>
    <updated>2016-09-06T10:06:40.000Z</updated>
    
    <content type="html">&lt;p&gt;Redis是一个常用的Nosql数据库，一般用来代替Memcached做缓存服务，同时它也支持数据的持久化，有着比较广泛的应用场景。在Java中使用redis我们已经比较熟悉了，那么在node.js和koa.js框架中使用Redis的正确姿势是怎样的呢？&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。&lt;br&gt;Redis 与其他 key - value 缓存产品有以下三个特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。&lt;/li&gt;
&lt;li&gt;Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。&lt;/li&gt;
&lt;li&gt;Redis支持数据的备份，即master-slave模式的数据备份。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis常用命令可以参考&lt;a href=&quot;http://www.runoob.com/redis/redis-keys.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.runoob.com/redis/redis-keys.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Node.js已经有很多redis相关的库，我在npm.org上搜了下大概有十几个吧，其中经常使用的redis,co-redis。 由于我用koa做web框架，因此就直接用了koa-redis。这篇文章涉及koa.js，yield生成器和Promise相关的知识，需要先对这些概念有一定的认识。&lt;/p&gt;
&lt;p&gt;下面介绍下redis和koa.js相关的操作吧，我是在Mac下操作的。&lt;/p&gt;
&lt;h2 id=&quot;1-安装redis，并启动客户端和服务器端&quot;&gt;&lt;a href=&quot;#1-安装redis，并启动客户端和服务器端&quot; class=&quot;headerlink&quot; title=&quot;1. 安装redis，并启动客户端和服务器端&quot;&gt;&lt;/a&gt;1. 安装redis，并启动客户端和服务器端&lt;/h2&gt;&lt;p&gt;  &lt;code&gt;brew install redis&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;启动服务器端   &lt;code&gt;redis-server&lt;/code&gt;   &lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;29322:C 06 Sep 17:39:25.109 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29322:M 06 Sep 17:39:25.111 * Increased maximum number of open files to 10032 (it was originally set to 1024).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                _._&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           _.-``__ &amp;apos;&amp;apos;-._&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      _.-``    `.  `_.  &amp;apos;&amp;apos;-._           Redis 3.0.6 (00000000/0) 64 bit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  .-`` .-```.  ```\/    _.,_ &amp;apos;&amp;apos;-._&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; (    &amp;apos;      ,       .-`  | `,    )     Running in standalone mode&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |`-._`-...-` __...-.``-._|&amp;apos;` _.-&amp;apos;|     Port: 6379&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |    `-._   `._    /     _.-&amp;apos;    |     PID: 29322&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `-._    `-._  `-./  _.-&amp;apos;    _.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |`-._`-._    `-.__.-&amp;apos;    _.-&amp;apos;_.-&amp;apos;|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |    `-._`-._        _.-&amp;apos;_.-&amp;apos;    |           http://redis.io&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `-._    `-._`-.__.-&amp;apos;_.-&amp;apos;    _.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |`-._`-._    `-.__.-&amp;apos;    _.-&amp;apos;_.-&amp;apos;|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; |    `-._`-._        _.-&amp;apos;_.-&amp;apos;    |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `-._    `-._`-.__.-&amp;apos;_.-&amp;apos;    _.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      `-._    `-.__.-&amp;apos;    _.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          `-._        _.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              `-.__.-&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29322:M 06 Sep 17:39:25.116 # Server started, Redis version 3.0.6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29322:M 06 Sep 17:39:25.116 * The server is now ready to accept connections on port 6379&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;启动客户端 &lt;code&gt;redis-cli&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;127.0.0.1:6379[1]&amp;gt; select 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OK&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127.0.0.1:6379&amp;gt; keys *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(empty list or set)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127.0.0.1:6379&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;2-安装node-js和koa-js，node的安装这里就不讲了，通过brew-install就可以。&quot;&gt;&lt;a href=&quot;#2-安装node-js和koa-js，node的安装这里就不讲了，通过brew-install就可以。&quot; class=&quot;headerlink&quot; title=&quot;2. 安装node.js和koa.js，node的安装这里就不讲了，通过brew install就可以。&quot;&gt;&lt;/a&gt;2. 安装node.js和koa.js，node的安装这里就不讲了，通过brew install就可以。&lt;/h2&gt;&lt;p&gt;  &lt;code&gt;npm install koa redis koa-redis&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;  可以看到koa-redis已经依赖了co-redis, es6-promisify等库&lt;br&gt;  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;`-- koa-redis@2.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  +-- co-redis@2.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  | `-- es6-promisify@4.1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  |   `-- es6-promise@3.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  `-- hiredis@0.5.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    +-- bindings@1.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    `-- nan@2.4.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-koa-js操作redis数据&quot;&gt;&lt;a href=&quot;#3-koa-js操作redis数据&quot; class=&quot;headerlink&quot; title=&quot;3. koa.js操作redis数据&quot;&gt;&lt;/a&gt;3. koa.js操作redis数据&lt;/h2&gt;&lt;p&gt;  这块是本文重点，由于官方的文档和例子不太详细，不熟悉node的同学折腾起来会比较累，所以本文提供了一个比较完整的例子。具体代码里面注释已经写的比较清楚了。&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; session = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;koa-generic-session&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; redisStore = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;koa-redis&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; koa = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;koa&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; redis = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;redis&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 注意: client默认是异步callback方式调用;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// store.client是经过了co-redis包装,返回Promise, 在koa里面用yield异步编程比较方便&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; client = redis.createClient(&lt;span class=&quot;number&quot;&gt;6379&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;172.19.65.240&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; app = koa();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.keys = [&lt;span class=&quot;string&quot;&gt;&#39;keys&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;keykeys&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// var option=&amp;#123;host: &quot;172.19.65.240&quot;, db:1&amp;#125;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; options = &amp;#123;client: client, db: &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; store = redisStore(options);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.use(session(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  store: store&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.use(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; *(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.path) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/get&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      get.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/testKV&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// 保存key value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.query.adminId) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.set(&lt;span class=&quot;string&quot;&gt;&quot;test1&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.query.adminId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//同步读取key value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.get(&lt;span class=&quot;string&quot;&gt;&quot;test1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/testHM&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//操作hashmap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; result = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.hmset(&lt;span class=&quot;string&quot;&gt;&quot;hosts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;mjr&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;123&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;another&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;23&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;home&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;1234&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; obj = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.hgetall(&lt;span class=&quot;string&quot;&gt;&quot;hosts&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.dir(obj);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//获取hashmap key的值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.hget(&lt;span class=&quot;string&quot;&gt;&quot;hosts&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;home&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//保存hashmap,使用默认的callback方式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// client.hset(&quot;hash key&quot;, &quot;hashtest 1&quot;, &quot;some value&quot;, redis.print);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// client.hset([&quot;hash key&quot;, &quot;hashtest 2&quot;, &quot;some other value&quot;], redis.print);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// client.hmset(&quot;hosts&quot;, &quot;mjr&quot;, &quot;1&quot;, &quot;another&quot;, &quot;23&quot;, &quot;home&quot;, &quot;1234&quot;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// client.hmset([&quot;key&quot;, &quot;test keys 1&quot;, &quot;test val 1&quot;, &quot;test keys 2&quot;, &quot;test val 2&quot;], function (err, res) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//   console.log(res);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// &amp;#125;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/testSet&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//保存set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; key = &lt;span class=&quot;string&quot;&gt;&quot;key1&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.sadd(&lt;span class=&quot;string&quot;&gt;&quot;key1&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;v1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.sadd(&lt;span class=&quot;string&quot;&gt;&quot;key1&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;v2&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.sadd(&lt;span class=&quot;string&quot;&gt;&quot;key1&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;v3&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//读取set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.multi()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .sismember(key, &lt;span class=&quot;string&quot;&gt;&#39;v1&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .smembers(key)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .exec(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;err, replies&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;MULTI got &quot;&lt;/span&gt; + replies.length + &lt;span class=&quot;string&quot;&gt;&quot; replies&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          replies.forEach(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;reply, index&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&quot;Reply &quot;&lt;/span&gt; + index + &lt;span class=&quot;string&quot;&gt;&quot;: &quot;&lt;/span&gt; + reply.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//读取set&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.smembers(&lt;span class=&quot;string&quot;&gt;&quot;key1&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/testList&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//保存list&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.rpush(&lt;span class=&quot;string&quot;&gt;&quot;mylist&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;bbb&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.rpush(&lt;span class=&quot;string&quot;&gt;&quot;mylist&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;ccc&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      store.client.lpush(&lt;span class=&quot;string&quot;&gt;&quot;mylist&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;aaa&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; store.client.rpop(&lt;span class=&quot;string&quot;&gt;&quot;mylist&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/remove&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      remove.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;/regenerate&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; regenerate.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;get&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; session = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.session;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  session.count = session.count || &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  session.count++;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; test = store.client.get(&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(test);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = session.count;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;remove&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.session = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.body = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; *&lt;span class=&quot;title&quot;&gt;regenerate&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  get.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.regenerateSession();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  get.call(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.listen(&lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;关于在koa框架中使用redis就写这么多吧，其实还有发布-订阅等的用法，这里就不说了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Redis是一个常用的Nosql数据库，一般用来代替Memcached做缓存服务，同时它也支持数据的持久化，有着比较广泛的应用场景。在Java中使用redis我们已经比较熟悉了，那么在node.js和koa.js框架中使用Redis的正确姿势是怎样的呢？&lt;br&gt;
    
    </summary>
    
    
      <category term="koa" scheme="http://offbye.com/tags/koa/"/>
    
      <category term="node" scheme="http://offbye.com/tags/node/"/>
    
      <category term="redis" scheme="http://offbye.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Cordova支付宝插件的那些坑</title>
    <link href="http://offbye.com/2016/08/26/Cordova%E6%94%AF%E4%BB%98%E5%AE%9D%E6%8F%92%E4%BB%B6%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91/"/>
    <id>http://offbye.com/2016/08/26/Cordova支付宝插件的那些坑/</id>
    <published>2016-08-26T07:53:14.000Z</published>
    <updated>2016-08-29T04:35:13.000Z</updated>
    
    <content type="html">&lt;p&gt;最近帮忙折腾Cordova App，因为是商城类App，需要接APP微信支付和支付宝支付，于是先到github上找相关的插件解决，微信支付很顺利的用插件解决了，支付宝插件就不那么顺利了，网上的几个插件要么过时了，要么实现不合理或不完整，最后还是自己改了个支付宝插件。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先我找了star最多的插件，&lt;a href=&quot;https://github.com/charleyw/cordova-plugin-alipay，&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/charleyw/cordova-plugin-alipay，&lt;/a&gt; 结果发现这个插件已经过时了，API和最新的&lt;a href=&quot;https://doc.open.alipay.com/doc2/detail.htm?treeId=54&amp;amp;articleId=104509&amp;amp;docType=1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;支付宝SDK&lt;/a&gt;对不上， 然后签名竟然是在客户端计算，导致安全问题和iOS需要增加很大的静态库，于是放弃这个了，充分说明了star多的项目不一定就能用。&lt;/p&gt;
&lt;p&gt;然后我找到了一个更新时间比较近的项目，&lt;a href=&quot;https://github.com/chenyuanchn/cordova-plugin-alipay，这个项目比较简单合理，服务器端负责生成payInfo字符串，客户端支付调用支付宝。问题是iOS上编译有错误，原因是有几个库没有加入到插件config.xml中，不熟悉iOS的人就郁闷了，我参考了[iOS接入支付宝](http://caoyudong.com/2016/01/03/iOS%E6%8E%A5%E5%85%A5%E6%94%AF%E4%BB%98%E5%AE%9D/)解决问题。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/chenyuanchn/cordova-plugin-alipay，这个项目比较简单合理，服务器端负责生成payInfo字符串，客户端支付调用支付宝。问题是iOS上编译有错误，原因是有几个库没有加入到插件config.xml中，不熟悉iOS的人就郁闷了，我参考了[iOS接入支付宝](http://caoyudong.com/2016/01/03/iOS%E6%8E%A5%E5%85%A5%E6%94%AF%E4%BB%98%E5%AE%9D/)解决问题。&lt;/a&gt;&lt;br&gt;这个库还有个问题是没有实现callback回调。&lt;/p&gt;
&lt;p&gt;然后我fork了这个插件，并完善了上面提到的几个问题，放在git上了。需要的可以拿去用。地址如下&lt;br&gt;&lt;a href=&quot;https://github.com/offbye/cordova-plugin-alipay&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/offbye/cordova-plugin-alipay&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最后强烈建议支付宝维护个官方的Cordova插件吧，毕竟这是涉及到支付安全的产品啊。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近帮忙折腾Cordova App，因为是商城类App，需要接APP微信支付和支付宝支付，于是先到github上找相关的插件解决，微信支付很顺利的用插件解决了，支付宝插件就不那么顺利了，网上的几个插件要么过时了，要么实现不合理或不完整，最后还是自己改了个支付宝插件。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Mac Terminal终端光标的快捷键操作</title>
    <link href="http://offbye.com/2016/08/18/Mac-Terminal%E7%BB%88%E7%AB%AF%E5%85%89%E6%A0%87%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%93%8D%E4%BD%9C/"/>
    <id>http://offbye.com/2016/08/18/Mac-Terminal终端光标的快捷键操作/</id>
    <published>2016-08-18T07:45:11.000Z</published>
    <updated>2016-08-18T08:01:28.000Z</updated>
    
    <content type="html">&lt;p&gt;Mac Terminal终端和linux上终端光标的快捷键操作是一样的，都是来自Emacs这个神级的编辑器，由于我以前vim用的多，没怎么用过Emacs，所以就不习惯了。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;常用的快捷键：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + d        删除一个字符，相当于通常的Delete键（命令行若无所有字符，则相当于exit；处理多行标准输入时也表示eof）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + h        退格删除一个字符，相当于通常的Backspace键&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + u        删除光标之前到行首的字符&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + k        删除光标之前到行尾的字符&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + c        取消当前行输入的命令，相当于Ctrl + Break&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + a        光标移动到行首（Ahead of line），相当于通常的Home键&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + e        光标移动到行尾（End of line）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + f        光标向前(Forward)移动一个字符位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + b        光标往回(Backward)移动一个字符位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + l        清屏，相当于执行clear命令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + p        调出命令历史中的前一条（Previous）命令，相当于通常的上箭头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + n        调出命令历史中的下一条（Next）命令，相当于通常的上箭头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + r        显示：号提示，根据用户输入查找相关历史命令（reverse-i-search）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;次常用快捷键：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Alt + f         光标向前（Forward）移动到下一个单词&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Alt + b         光标往回（Backward）移动到前一个单词&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + w        删除从光标位置前到当前所处单词（Word）的开头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Alt + d         删除从光标位置到当前所处单词的末尾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Ctrl + y        粘贴最后一次被删除的单词&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上就是快捷键了，在这里我只想揭露一些事情，这些快捷键都是emacs的快捷键！熟悉终端的同学应该知道，终端里可以设置快捷键的类型是vim还是emacs。当然了大多数的终端都用的emacs，因为啥自己想去吧。我估计原因是这些东西都是早期的C/C++大神写的，一脉相承下来的！&lt;br&gt;mac os x虽然是图形界面，但是chrome，xcode啥的也支持这些快捷键！&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Mac Terminal终端和linux上终端光标的快捷键操作是一样的，都是来自Emacs这个神级的编辑器，由于我以前vim用的多，没怎么用过Emacs，所以就不习惯了。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Tower中国用户适配版本--cTower手机地面站</title>
    <link href="http://offbye.com/2016/08/04/Tower%E4%B8%AD%E5%9B%BD%E7%94%A8%E6%88%B7%E9%80%82%E9%85%8D%E7%89%88%E6%9C%AC-cTower%E6%89%8B%E6%9C%BA%E5%9C%B0%E9%9D%A2%E7%AB%99/"/>
    <id>http://offbye.com/2016/08/04/Tower中国用户适配版本-cTower手机地面站/</id>
    <published>2016-08-04T01:22:32.000Z</published>
    <updated>2016-08-04T01:23:25.000Z</updated>
    
    <content type="html">&lt;p&gt;最近折腾无人机，发现官方的Tower手机地面站在很多国产手机上不可用，没有谷歌gms服务啊，于是花了几天自己改了一个版本，欢迎广大模友试用。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Tower is a Ground Control Station (GCS) Android app built atop &lt;a href=&quot;https://github.com/dronekit/dronekit-android&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;3DR Services&lt;/a&gt;, for UAVs&lt;br&gt;running Ardupilot software.&lt;/p&gt;
&lt;h1 id=&quot;Tower中国用户适配版本–cTower手机地面站-by-offbye&quot;&gt;&lt;a href=&quot;#Tower中国用户适配版本–cTower手机地面站-by-offbye&quot; class=&quot;headerlink&quot; title=&quot;Tower中国用户适配版本–cTower手机地面站 by offbye&quot;&gt;&lt;/a&gt;Tower中国用户适配版本–cTower手机地面站 by offbye&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;3DR官方Tower手机地面站在国内不适用，国内多数手机没有谷歌服务和谷歌市场，因此没法安装3DR services服务，谷歌地图在国内由于众所周知的原因，也不好用。&lt;/p&gt;
&lt;p&gt;因此我为了自己玩的开心，Fork了Tower项目并逐步改的让国内主流安卓手机能正常使用，希望能够造福魔友，也欢迎有能力的朋友一起开发完善，不欢迎商业闭源使用。&lt;/p&gt;
&lt;p&gt;cTower在尽量保留Tower原版最新功能不变的基础上，针对国内手机用户进行适配和增强，版本号和Tower保持同步。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;3-2-2-更新说明&quot;&gt;&lt;a href=&quot;#3-2-2-更新说明&quot; class=&quot;headerlink&quot; title=&quot;3.2.2 更新说明&quot;&gt;&lt;/a&gt;3.2.2 更新说明&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;cTower地面站，实现支持去掉谷歌gms服务的国产手机&lt;/li&gt;
&lt;li&gt;去掉3DR服务检查 by [i]offbye[/i]&lt;/li&gt;
&lt;li&gt;增加高德地图支持，并设为默认地图，可以设置切换谷歌地图&lt;/li&gt;
&lt;li&gt;修改了应用ID，避免和原版Tower冲突&lt;/li&gt;
&lt;li&gt;修改gradle配置，适配高德地图，解决GFW导致一些repo下载慢无法编译的问题&lt;/li&gt;
&lt;li&gt;&lt;p&gt;增强简体中文翻译&lt;/p&gt;
&lt;h3 id=&quot;下载cTower3-2-2版本&quot;&gt;&lt;a href=&quot;#下载cTower3-2-2版本&quot; class=&quot;headerlink&quot; title=&quot;下载cTower3.2.2版本&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://o79096vir.bkt.clouddn.com/ctower/cTower-v3.2.2-release.apk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下载cTower3.2.2版本&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/ctower/S60803-20125595.jpg&quot; alt=&quot;ctower&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;下载Tower官方版本 &lt;a href=&quot;https://play.google.com/store/apps/details?id=org.droidplanner.android&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;img src=&quot;https://developer.android.com/images/brand/en_app_rgb_wo_45.png&quot; alt=&quot;Google Play Store&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Usage-Guide&quot;&gt;&lt;a href=&quot;#Usage-Guide&quot; class=&quot;headerlink&quot; title=&quot;Usage Guide&quot;&gt;&lt;/a&gt;Usage Guide&lt;/h3&gt;&lt;p&gt;The &lt;a href=&quot;https://github.com/DroidPlanner/droidplanner/wiki&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;wiki&lt;/a&gt; has some basic documentation (Help us by making it better!)&lt;/p&gt;
&lt;p&gt;For help, visit the &lt;a href=&quot;http://discuss.ardupilot.org/c/ground-control-software/tower&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tower Discuss forum&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近折腾无人机，发现官方的Tower手机地面站在很多国产手机上不可用，没有谷歌gms服务啊，于是花了几天自己改了一个版本，欢迎广大模友试用。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>安卓旧项目使用Small框架插件化改造踩坑记</title>
    <link href="http://offbye.com/2016/07/22/%E5%AE%89%E5%8D%93%E6%97%A7%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8Small%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E6%8F%92%E4%BB%B6%E5%8C%96%E6%94%B9%E9%80%A0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>http://offbye.com/2016/07/22/安卓旧项目使用Small框架进行插件化改造的问题汇总/</id>
    <published>2016-07-22T13:28:18.000Z</published>
    <updated>2016-08-03T04:08:05.000Z</updated>
    
    <content type="html">&lt;p&gt;我们团队把一个10万行安卓代码的旧项目（电商系统管理台App），使用Small框架做了插件化改造。把项目分成了10多个插件模块，解除了业务模块之间的代码耦合，为业务功能的快速迭代和多团队并行开发做好基础架构。迁移期间遇到了一些坑，但最后在大家的努力下基本得到了解决，也感谢Small的作者光亮对我们提出的issue的快速响应。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Small的应用场景&quot;&gt;&lt;a href=&quot;#Small的应用场景&quot; class=&quot;headerlink&quot; title=&quot;Small的应用场景&quot;&gt;&lt;/a&gt;Small的应用场景&lt;/h2&gt;&lt;p&gt;开发时：让你完全透明的像开发普通工程一样完成插件开发&lt;br&gt;编译时：自动化的帮助你分离各个公共库、业务模块插件（插件仅保留自身的代码跟资源，达到最小化）&lt;br&gt;运行时：运用最少量的Hook无缝的将各个插件并入宿主，让代码跟资源完全融合，自由调用&lt;br&gt;所以撇开开发者不用关注的(2)来说，Small的目的就是要做到保证开发者「畅快开发」的体验，以及App使用者「顺畅使用」的体验。&lt;/p&gt;
&lt;p&gt;插件化方案有很多，很难有统一的形态，各有各的适用场景。如果你需要分发你的插件给别人使用，Small无法满足；如果你想利用插件化拆分、重组自己的应用，我认为Small在这方面已经走在了前面，并且将不断完善，做到极致。&lt;/p&gt;
&lt;h2 id=&quot;插件化的工程（开发）结构&quot;&gt;&lt;a href=&quot;#插件化的工程（开发）结构&quot; class=&quot;headerlink&quot; title=&quot;插件化的工程（开发）结构&quot;&gt;&lt;/a&gt;插件化的工程（开发）结构&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues/118&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;关于工程（开发）结构的讨论&lt;/a&gt;&lt;br&gt;1.依赖管理：Small使用同一个ClassLoader加载不同的插件，因此不同插件中的依赖在运行时对其他插件和宿主都是可见的，所以依赖的管理一定要收敛，统一管理，避免各自引入。&lt;br&gt;2.插件之间的通信：插件的开发一般都是多team并行的，插件之间应避免直接调用来减少耦合&lt;br&gt;3.资源的使用：由于small的特性，runtime各插件的资源也是可以相互访问的，但在开发上需要组织和统一管理好，包括命名和安全的使用资源。&lt;/p&gt;
&lt;h2 id=&quot;老项目集成Small插件的官方建议&quot;&gt;&lt;a href=&quot;#老项目集成Small插件的官方建议&quot; class=&quot;headerlink&quot; title=&quot;老项目集成Small插件的官方建议&quot;&gt;&lt;/a&gt;老项目集成Small插件的官方建议&lt;/h2&gt;&lt;h3 id=&quot;基本原则&quot;&gt;&lt;a href=&quot;#基本原则&quot; class=&quot;headerlink&quot; title=&quot;基本原则&quot;&gt;&lt;/a&gt;基本原则&lt;/h3&gt;&lt;p&gt;宿主中不要放业务逻辑。只做加载插件以及调起主插件的操作。&lt;/p&gt;
&lt;h3 id=&quot;重构步骤&quot;&gt;&lt;a href=&quot;#重构步骤&quot; class=&quot;headerlink&quot; title=&quot;重构步骤&quot;&gt;&lt;/a&gt;重构步骤&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;拆lib.&lt;em&gt; - 公共模块插件&lt;br&gt;把各个第三方库拆出来做成一个个`lib.&lt;/em&gt;`插件模块，包括统计、地图、网络、图片等库。&lt;br&gt;把老项目积累的业务公共代码(utils)分离出来封装成一个lib.utils插件&lt;br&gt;把基础的样式、主题分离出来封装成一个lib.style插件&lt;/li&gt;
&lt;li&gt;拆app.&lt;em&gt; - 业务模块插件&lt;br&gt;把业务模块拆成`app.&lt;/em&gt;&lt;code&gt;模块，他们可以依赖&lt;/code&gt;lib.&lt;em&gt;&lt;code&gt;模块，显示调用&lt;/code&gt;lib.&lt;/em&gt;`中的各个API&lt;br&gt;相对独立的业务模块先拆，比如“详情页”、“关于我们”，如果剩下的业务不好拆，先放一个插件里&lt;br&gt;如果都不好拆，先把全部业务做成一个app.main主插件&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;插件之间的通信&quot;&gt;&lt;a href=&quot;#插件之间的通信&quot; class=&quot;headerlink&quot; title=&quot;插件之间的通信&quot;&gt;&lt;/a&gt;插件之间的通信&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues/120&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;插件之间的通信/互调&lt;/a&gt;&lt;br&gt;目前的插件之间的通信仅限于Small.openUri()，用来调起其它插件的页面。&lt;/p&gt;
&lt;p&gt;但有些时候，我们还是需要操作一下其它插件。 比如说在跳转到另一个插件的页面之前，需要查询一下对方插件的一个状态。&lt;br&gt;我觉得应该借助v4包的LocalBroadcastManager来实现&lt;/p&gt;
&lt;h2 id=&quot;老项目集成Small插件化遇到的坑&quot;&gt;&lt;a href=&quot;#老项目集成Small插件化遇到的坑&quot; class=&quot;headerlink&quot; title=&quot;老项目集成Small插件化遇到的坑&quot;&gt;&lt;/a&gt;老项目集成Small插件化遇到的坑&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;插件中通过startActivityForResult获取不到数据问题。如果启动的Activity是SingleTask启动模式，有这个问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;插件lib2依赖插件lib1，导致同时依赖lib1和lib2的插件app1编译时出现找不到类的情况。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;一个lib依赖另一个lib，buildLib时出现Duplicate package错误&lt;br&gt;一个lib依赖另一个lib，buildLib时出现下面的错误，目前还没有找到解决吧，clean工程和cleanLib都做了，但还不行，只好把依赖去掉了才行。原因未知&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果插件用到了百度地图等，需要把相关的功能放在一个插件下面，注意那些很大的.so是放在插件里面的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Small插件中是支持aar引用的，实际使用过了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Small的插件限制了包名，因此已有代码复制过来会有改变。特别要注意layout文件中自定义控件包名的改动，能够通过编译但运行时会找不到类。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;通过assembleRelease单独编译一个插件出现下面的错误，但有的电脑能正常单独编译插件，原因未知，已经提issue。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;下午2:30:54: Executing external task &amp;apos;assembleRelease&amp;apos;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Configuration on demand is an incubating feature.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Incremental java compilation is an incubating feature.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* What went wrong:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;A problem occurred configuring project &amp;apos;:app.me&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; Could not find property &amp;apos;android&amp;apos; on project &amp;apos;:app&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* Try:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BUILD FAILED&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第三方SDK的meta，Service等需要在宿主App的manifest中声明，例如百度地图SDK的定位Service。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;lib.utils删除资源后出现编译错误，解决办法是删除public.txt，重新编译lib和bundle&lt;/li&gt;
&lt;li&gt;老代码一些业务上耦合比较紧的页面不容易拆开，可以作为一个模块存在，我们最后拆成了6个大模块。&lt;/li&gt;
&lt;li&gt;&lt;p&gt;目前1.0版本不支持gradle并行编译，在gradle.properties中打开&lt;code&gt;org.gradle.parallel=true&lt;/code&gt; 编译会报错&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;  gradle  buildLib -q&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Small] [Small] building library 1 of 2 - app (0x7f)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Small] [Small] building library 1 of 2 - app (0x7f)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;building library 2 of 2 - lib.utils (0x73)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* What went wrong:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Execution failed for task &amp;apos;:lib.utils:preBuild&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ./build-small/intermediates/small-pre-link/aar/app-D.txt (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考&lt;a href=&quot;http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gradle文档&lt;/a&gt;&lt;br&gt;这个不是Bug，有依赖的工程肯定是不能并行编译的&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;后面遇到问题会持续更新&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/wequick/Small/issues&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我们团队把一个10万行安卓代码的旧项目（电商系统管理台App），使用Small框架做了插件化改造。把项目分成了10多个插件模块，解除了业务模块之间的代码耦合，为业务功能的快速迭代和多团队并行开发做好基础架构。迁移期间遇到了一些坑，但最后在大家的努力下基本得到了解决，也感谢Small的作者光亮对我们提出的issue的快速响应。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://offbye.com/tags/Android/"/>
    
      <category term="Small框架" scheme="http://offbye.com/tags/Small%E6%A1%86%E6%9E%B6/"/>
    
      <category term="插件化" scheme="http://offbye.com/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>买无人机之前你需要知道的几件事</title>
    <link href="http://offbye.com/2016/07/13/%E5%85%A5%E6%89%8B%E6%97%A0%E4%BA%BA%E6%9C%BA%E4%B9%8B%E5%89%8D%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E5%87%A0%E4%BB%B6%E4%BA%8B/"/>
    <id>http://offbye.com/2016/07/13/入手无人机之前你需要知道的几件事/</id>
    <published>2016-07-13T04:17:28.000Z</published>
    <updated>2016-08-26T11:27:48.000Z</updated>
    
    <content type="html">&lt;p&gt;随着近几年航拍机行业的火热，大疆等知名无人机厂商开始变得家喻户晓。近期小米无人机的上市，让越来越多的人想拥有自己的无人机。&lt;br&gt;航拍高大上，炸机很危险。在具备必要的知识和能力前，请不要把无人机作为炫耀的玩具。这几年小白玩大疆精灵在闹市区飞，在机场附近飞，炸机导致事故或影响公共安全的事情还少吗？&lt;br&gt;本文就谈下新手入手航拍机前需要知道的一些事情。作为一个在5iMX玩了很多年的资深模友，我首先以5iMX的56字航模箴言开头吧&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;航模爱好趣无穷，正确操纵是关键。莫把器材当玩具，忽视安全悔一生。&lt;br&gt;    新手好问勤练习，远离人群勿炫耀。天下模友一家人，共建美好新生活。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;首先说下无人机这个概念吧，无人机应该是指拥有自主飞行能力的飞行器，即可以不需要人干预的情况下自动飞行，大疆和零度无人机多数型号是可以设置航点自主飞行的。现在消费市场上所说的无人机很多都只能算是航拍机，本文的讨论对象也主要是航拍机。&lt;/p&gt;
&lt;p&gt;玩无人机安全问题需要时刻放在第一位，不在闹市区和人群密集的地方，不在机场附近等禁飞区飞，不在高大建筑物附近飞，不在发生重大事件或灾害的现场飞，除非得到了相关部门的明确授权，否则可能会触发相关法律。个人精神状态不好的时候不能飞，无人机有故障隐患没排除时不能飞。&lt;/p&gt;
&lt;p&gt;在了解了这些后你还想入手无人机的话请继续往下看。&lt;/p&gt;
&lt;h2 id=&quot;你为什么想买无人机？&quot;&gt;&lt;a href=&quot;#你为什么想买无人机？&quot; class=&quot;headerlink&quot; title=&quot;你为什么想买无人机？&quot;&gt;&lt;/a&gt;你为什么想买无人机？&lt;/h2&gt;&lt;p&gt;每个人在入手无人机前都有自己的需求和动机，有人是为了在朋友圈发图和炫耀，有人是为了新奇，有人是为了学习和了解相关的技术。这些都是常见也是正常的需求，还有人是为了用无人机送给戒指什么的，这种需求还是交给专业团队做吧，就不要自己买无人机了，太危险。&lt;br&gt;需要知道的是，自己组装无人机并不比买商业无人机便宜，一般用户就不要为了省钱自己组装无人机了。但组装无人机是一件很有乐趣和挑战的事情，需要投入大量的时间和金钱。&lt;/p&gt;
&lt;h2 id=&quot;无人机相关的法规&quot;&gt;&lt;a href=&quot;#无人机相关的法规&quot; class=&quot;headerlink&quot; title=&quot;无人机相关的法规&quot;&gt;&lt;/a&gt;无人机相关的法规&lt;/h2&gt;&lt;p&gt;目前无人机方面的规定是怎样的情况呢？原则上，超过一定重量，在视距外飞行的无人机每次飞行前都需要申报飞行计划。尽管不少人有驾驶执照，申请计划的不便还是让多数无人机处于“黑飞”之中。中国航空器拥有者及驾驶员协会（以下简称AOPA）牵头，多家企业联合开发的针对轻小无人机的监管系统Ucloud已经上线。中国民用航空局飞行标准司已经正式批准轻小型无人机监管系统“优云（U-Cloud）”实施运行。批准文件有效期两年：自颁发日期2016年3月4日起至2018年3月3日。&lt;br&gt;但这个规定现在很多地方并没有认真执行过，倒是AOPA在通过发无人机执照赚钱，航模圈里业余玩的航模爱好者很少有人会去办这个执照，但商业无人机领域好像挺认这个证书的，会花1-2万考个证书。具体参考下知乎&lt;a href=&quot;https://www.zhihu.com/question/33263185&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;如何评价AOPA及ASFC颁发的相关无人机证件？&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;玩无人机需要的技术技能&quot;&gt;&lt;a href=&quot;#玩无人机需要的技术技能&quot; class=&quot;headerlink&quot; title=&quot;玩无人机需要的技术技能&quot;&gt;&lt;/a&gt;玩无人机需要的技术技能&lt;/h2&gt;&lt;p&gt;玩商业无人机对于技能的要求比较低，只需要熟悉遥控器的操作和功能，较好的心理素质，了解无人机飞行的基本原理，熟悉手机和电脑操作。无人机经常会升级更新固件的，当然你也可以选择不升级。&lt;br&gt;如果是你打算自己组装无人机，需要知道的东西就很多了。需要有机械，电子，空气动力学，计算机等方面的知识，还需要有很强的动手能力和各种工具，熟悉飞控，电机，电调，动力锂电池，接收机，遥控器，图传，各种传感器等部件，还要熟悉APM，Pixhawk，CC3D等飞控和相关地面站软件，就不展开说了，总之门槛还是比较高的。&lt;/p&gt;
&lt;h2 id=&quot;飞行场地问题&quot;&gt;&lt;a href=&quot;#飞行场地问题&quot; class=&quot;headerlink&quot; title=&quot;飞行场地问题&quot;&gt;&lt;/a&gt;飞行场地问题&lt;/h2&gt;&lt;p&gt;无人机特别是固定翼飞机对于飞行场地要求还是比较高的，需要较大面积的空旷场地，并且不能在机场等设施附近，我一般是在湖边的大草坪飞，并且不在周末人比较多的时候飞，一般早上人很少时晚会比较方便。大疆等无人机都有禁飞区的设定，GPS定位到在禁飞区内是无法起飞的，北京四环以内好像都是禁飞区。&lt;br&gt;如果你生活在城市中心，附近没有合适的场地，入手无人机就需要考虑了，使用的频率会非常低。&lt;/p&gt;
&lt;p&gt;最后祝大家飞的开心！&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;随着近几年航拍机行业的火热，大疆等知名无人机厂商开始变得家喻户晓。近期小米无人机的上市，让越来越多的人想拥有自己的无人机。&lt;br&gt;航拍高大上，炸机很危险。在具备必要的知识和能力前，请不要把无人机作为炫耀的玩具。这几年小白玩大疆精灵在闹市区飞，在机场附近飞，炸机导致事故或影响公共安全的事情还少吗？&lt;br&gt;本文就谈下新手入手航拍机前需要知道的一些事情。作为一个在5iMX玩了很多年的资深模友，我首先以5iMX的56字航模箴言开头吧&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;航模爱好趣无穷，正确操纵是关键。莫把器材当玩具，忽视安全悔一生。&lt;br&gt;    新手好问勤练习，远离人群勿炫耀。天下模友一家人，共建美好新生活。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Android OkHttp3使用http2问题记录</title>
    <link href="http://offbye.com/2016/07/09/Android-OkHttp3%E4%BD%BF%E7%94%A8http2%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>http://offbye.com/2016/07/09/Android-OkHttp3使用http2问题记录/</id>
    <published>2016-07-09T01:52:52.000Z</published>
    <updated>2016-07-18T02:01:24.000Z</updated>
    
    <content type="html">&lt;p&gt;Android Okhttp3使用http2.0协议的接口时，发现一个问题，打印错误Log &lt;code&gt;E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx&lt;/code&gt;,Google上没有查到相关的信息，毕竟现在http2用的还很少。经查看Android源码，排查发现这只是个LOG，不是错误，可以放心的用http2了。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;测试http2发现android打印了下面的LOG&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.182 13670-13697/com.qianmi.shine I/System.out: [CDS]connect[shineapi2.qianmi.com/120.55.247.77:443] tm:20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.187 13670-13697/com.qianmi.shine E/Posix: [Posix_connect Debug]Process com.qianmi.shine :443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.251 13670-13697/com.qianmi.shine D/libc-netbsd: [getaddrinfo]: hostname=shineapi2.qianmi.com; servname=(null); cache_mode=(null), netid=0; mark=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.252 13670-13697/com.qianmi.shine D/libc-netbsd: [getaddrinfo]: ai_addrlen=0; ai_canonname=(null); ai_flags=4; ai_family=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.300 13670-13697/com.qianmi.shine E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx=0xdec78080 arg=0x0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.301 13670-13697/com.qianmi.shine E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback calling verifyCertificateChain authMethod=ECDHE_RSA&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.431 13670-13697/com.qianmi.shine I/System.out: gba_cipher_suite:TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到github上找下相关的Android源码，&lt;br&gt;&lt;a href=&quot;https://github.com/ACSOP/android_libcore/blob/88e2ca00cc0c161d9aa3e512b8ae58b3091dbf87/luni/src/main/native/org_apache_harmony_xnet_provider_jsse_NativeCrypto.cpp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/ACSOP/android_libcore/blob/88e2ca00cc0c161d9aa3e512b8ae58b3091dbf87/luni/src/main/native/org_apache_harmony_xnet_provider_jsse_NativeCrypto.cpp&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Verify the X509 certificate via SSL_CTX_set_cert_verify_callback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static int cert_verify_callback(X509_STORE_CTX* x509_store_ctx, void* arg __attribute__ ((unused)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /* Get the correct index to the SSLobject stored into X509_STORE_CTX. */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SSL* ssl = reinterpret_cast&amp;lt;SSL*&amp;gt;(X509_STORE_CTX_get_ex_data(x509_store_ctx,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            SSL_get_ex_data_X509_STORE_CTX_idx()));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback x509_store_ctx=%p arg=%p&quot;, ssl, x509_store_ctx, arg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AppData* appData = toAppData(ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNIEnv* env = appData-&amp;gt;env;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (env == NULL) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        LOGE(&quot;AppData-&amp;gt;env missing in cert_verify_callback&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        JNI_TRACE(&quot;ssl=%p cert_verify_callback =&amp;gt; 0&quot;, ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jobject sslHandshakeCallbacks = appData-&amp;gt;sslHandshakeCallbacks;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jclass cls = env-&amp;gt;GetObjectClass(sslHandshakeCallbacks);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jmethodID methodID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        = env-&amp;gt;GetMethodID(cls, &quot;verifyCertificateChain&quot;, &quot;([[BLjava/lang/String;)V&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jobjectArray objectArray = getCertificateBytes(env, x509_store_ctx-&amp;gt;untrusted);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    const char* authMethod = SSL_authentication_method(ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback calling verifyCertificateChain authMethod=%s&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              ssl, authMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jstring authMethodString = env-&amp;gt;NewStringUTF(authMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    env-&amp;gt;CallVoidMethod(sslHandshakeCallbacks, methodID, objectArray, authMethodString);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int result = (env-&amp;gt;ExceptionCheck()) ? 0 : 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback =&amp;gt; %d&quot;, ssl, result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;JNI_TRACE其实就是个封装了LOG的宏，定义如下：&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; WITH_JNI_TRACE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; JNI_TRACE(...) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)LOG(LOG_INFO, LOG_TAG &lt;span class=&quot;string&quot;&gt;&quot;-jni&quot;&lt;/span&gt;, __VA_ARGS__));     \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(&quot;I/&quot; LOG_TAG &quot;-jni:&quot;));         \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(__VA_ARGS__));          \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(&quot;\n&quot;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; JNI_TRACE(...) ((void)0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是最后还是有一点疑惑，源码打印的LOG是info级别的，但手机上logcat打印出的error log，这也是我为什么会注意到的原因，目前只能认为是手机和源码的代码不同了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Android Okhttp3使用http2.0协议的接口时，发现一个问题，打印错误Log &lt;code&gt;E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx&lt;/code&gt;,Google上没有查到相关的信息，毕竟现在http2用的还很少。经查看Android源码，排查发现这只是个LOG，不是错误，可以放心的用http2了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="http2" scheme="http://offbye.com/tags/http2/"/>
    
      <category term="Android" scheme="http://offbye.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android Volley整合升级OkHttp3.3问题</title>
    <link href="http://offbye.com/2016/07/07/Android-Volley%E6%95%B4%E5%90%88%E5%8D%87%E7%BA%A7OkHttp3-3%E9%97%AE%E9%A2%98/"/>
    <id>http://offbye.com/2016/07/07/Android-Volley整合升级OkHttp3-3问题/</id>
    <published>2016-07-07T04:38:57.000Z</published>
    <updated>2016-07-08T11:15:55.000Z</updated>
    
    <content type="html">&lt;p&gt;我们以前的Android项目网络框架是基于Volley和OKHttp2。现在由于Aliyun SDK升级和整合React Native模块的原因，它们现在都是用了OkHttp3，因此需要统一升级到最新稳定版本OkHttp3.3。&lt;br&gt;参考了网上的一些资料，主要是有下面几个问题:首先是’org.apache.http’在Android6.0版本已经去掉了，因此需要用’org.apache.http.legacy’代替下。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;OkHttp3Stack是参考了下面的Gist代码实现的，评论里面说不支持https。但是我实际测试过是支持https和http2的。&lt;br&gt;&lt;a href=&quot;https://gist.github.com/alashow/c96c09320899e4caa06b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/alashow/c96c09320899e4caa06b&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在app/gradle.settings的android块增加下面代码&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;useLibrary &amp;apos;org.apache.http.legacy&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;另外一种方法是不再使用org.apache.http相关的类，参考&lt;a href=&quot;http://blog.csdn.net/qq_28656671/article/details/50608239&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/qq_28656671/article/details/50608239&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最后提醒一下，Volley框架现在已经不再升级了，后面的新项目不建议使用了，推荐使用基于Retrofit和OkHttp3的请求框架，老项目升级成本有点高，就不折腾了。&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/b022eed6b427&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/b022eed6b427&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/qq_28656671/article/details/50608239&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/qq_28656671/article/details/50608239&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/android_ls/article/details/50493581&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/android_ls/article/details/50493581&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/square/okhttp/blob/master/CHANGELOG.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/square/okhttp/blob/master/CHANGELOG.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/alashow/c96c09320899e4caa06b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/alashow/c96c09320899e4caa06b&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/richiewang/p/5140040.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/richiewang/p/5140040.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mcxiaoke/android-volley&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/mcxiaoke/android-volley&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我们以前的Android项目网络框架是基于Volley和OKHttp2。现在由于Aliyun SDK升级和整合React Native模块的原因，它们现在都是用了OkHttp3，因此需要统一升级到最新稳定版本OkHttp3.3。&lt;br&gt;参考了网上的一些资料，主要是有下面几个问题:首先是’org.apache.http’在Android6.0版本已经去掉了，因此需要用’org.apache.http.legacy’代替下。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>JWT安全验证常见疑问解答</title>
    <link href="http://offbye.com/2016/07/04/JWT%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81%E5%B8%B8%E8%A7%81%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94/"/>
    <id>http://offbye.com/2016/07/04/JWT安全验证常见疑问解答/</id>
    <published>2016-07-04T05:49:14.000Z</published>
    <updated>2016-07-05T04:21:37.000Z</updated>
    
    <content type="html">&lt;p&gt;最近做基于&lt;a href=&quot;http://samnewman.io/patterns/architectural/bff/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BFF架构&lt;/a&gt;的分布式移动端API接口的系统设计。工作过程中发现有些工程师对JWT安全验证的认识存在一些偏差，重复讲解实在太麻烦了，在这里把关于JWT常见的一些疑问统一回答下吧。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;什么是JWT？&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://tools.ietf.org/html/rfc7519&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JSON Web Token (JWT)&lt;/a&gt;是一种基于 token 的认证方案。&lt;br&gt;JSON Web Tokens are an open, industry standard &lt;a href=&quot;https://tools.ietf.org/html/rfc7519&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RFC 7519&lt;/a&gt; method for representing claims securely between two parties.&lt;br&gt;简单的说，JWT就是一种Token的编码算法，服务器端负责根据一个密码和算法生成Token，然后发给客户端，客户端只负责后面每次请求都在HTTP header里面带上这个Token，服务器负责验证这个Token是不是合法的，有没有过期等，并可以解析出subject和claim里面的数据。&lt;/p&gt;
&lt;p&gt;注意JWT里面的数据是BASE64编码的，没有加密，因此不要放如敏感数据。&lt;/p&gt;
&lt;p&gt;可以通过&lt;a href=&quot;https://jwt.io/这个网站对JWT&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://jwt.io/这个网站对JWT&lt;/a&gt; Token进行解析。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一个JWT token 看起来是这样的:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjEzODY4OTkxMzEsImlzcyI6ImppcmE6MTU0ODk1OTUiLCJxc2giOiI4MDYzZmY0Y2ExZTQxZGY3YmM5MGM4YWI2ZDBmNjIwN2Q0OTFjZjZkYWQ3YzY2ZWE3OTdiNDYxNGI3MTkyMmU5IiwiaWF0IjoxMzg2ODk4OTUxfQ.uKqU9dTB6gKwG6jQCuXYAiMNdfNRw98Hw_IWuA5MaMo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以简化为下面这样的结构:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;base64url_encode(Header) + &amp;apos;.&amp;apos; + base64url_encode(Claims) + &amp;apos;.&amp;apos; + base64url_encode(Signature)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为什么用JWT？&lt;/p&gt;
&lt;p&gt;JWT只通过算法实现对Token合法性的验证，不依赖数据库，Memcached的等存储系统，因此可以做到跨服务器验证，只要密钥和算法相同，不同服务器程序生成的Token可以互相验证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;JWT Token需要持久化在Memcached中吗？&lt;br&gt;不应该这样做，这样就背离了JWT通过算法验证的初心。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在退出登录时怎样实现JWT Token失效呢？&lt;br&gt;退出登录， 只要客户端端把Token丢弃就可以了，服务器端不需要废弃Token。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;怎样保持客户端长时间保持登录状态？&lt;/p&gt;
&lt;p&gt;服务器端提供刷新Token的接口， 客户端负责按一定的逻辑刷新服务器Token。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;服务器端是否应该从JWT中取出userid用于业务查询？&lt;/p&gt;
&lt;p&gt;REST API是无状态的，意味着服务器端每次请求都是独立的，即不依赖以前请求的结果，因此也不应该依赖JWT token做业务查询， 应该在请求报文中单独加个userid 字段。&lt;br&gt;为了做用户水平越权的检查，可以在业务层判断传入的userid和从JWT token中解析出的userid是否一致， 有些业务可能会允许查不同用户的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;JWT 在Java项目中如何实现？&lt;/p&gt;
&lt;p&gt;生成Token&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;String token = Jwts.builder().setSubject(userId)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .setExpiration(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Date(System.currentTimeMillis() + Constant.TOKEN_EXP_TIME))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .claim(&lt;span class=&quot;string&quot;&gt;&quot;roles&quot;&lt;/span&gt;, Constant.USER_TYPE_EMP).setIssuedAt(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Date())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .signWith(SignatureAlgorithm.HS256, Constant.JWT_SECRET).compact();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;loginResponse.setToken(token);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;验证JWT Token&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String authHeader = request.getHeader(&lt;span class=&quot;string&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (authHeader == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || !authHeader.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;Bearer &quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   log.debug(&lt;span class=&quot;string&quot;&gt;&quot;no Authorization &quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String token = authHeader.substring(&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// The part after &quot;Bearer &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(&lt;span class=&quot;string&quot;&gt;&quot;token &quot;&lt;/span&gt; + token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Claims claims = Jwts.parser().setSigningKey(Constant.JWT_SECRET)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .parseClaimsJws(token).getBody();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(claims.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//包含超时，签名错误等异常&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(&lt;span class=&quot;string&quot;&gt;&quot;JWT Exception&quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意客户端发送的Authorization HTTP HEADER格式是 “Bearer YOUR_JWT_TOKEN”,这是OAuth的规范规定的。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近做基于&lt;a href=&quot;http://samnewman.io/patterns/architectural/bff/&quot;&gt;BFF架构&lt;/a&gt;的分布式移动端API接口的系统设计。工作过程中发现有些工程师对JWT安全验证的认识存在一些偏差，重复讲解实在太麻烦了，在这里把关于JWT常见的一些疑问统一回答下吧。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;什么是JWT？&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://tools.ietf.org/html/rfc7519&quot;&gt;JSON Web Token (JWT)&lt;/a&gt;是一种基于 token 的认证方案。&lt;br&gt;JSON Web Tokens are an open, industry standard &lt;a href=&quot;https://tools.ietf.org/html/rfc7519&quot;&gt;RFC 7519&lt;/a&gt; method for representing claims securely between two parties.&lt;br&gt;简单的说，JWT就是一种Token的编码算法，服务器端负责根据一个密码和算法生成Token，然后发给客户端，客户端只负责后面每次请求都在HTTP header里面带上这个Token，服务器负责验证这个Token是不是合法的，有没有过期等，并可以解析出subject和claim里面的数据。&lt;/p&gt;
&lt;p&gt;注意JWT里面的数据是BASE64编码的，没有加密，因此不要放如敏感数据。&lt;/p&gt;
&lt;p&gt;可以通过&lt;a href=&quot;https://jwt.io/这个网站对JWT&quot;&gt;https://jwt.io/这个网站对JWT&lt;/a&gt; Token进行解析。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何做一场像TED一样精彩的技术演讲</title>
    <link href="http://offbye.com/2016/06/29/%E5%A6%82%E4%BD%95%E5%81%9A%E4%B8%80%E5%9C%BA%E5%83%8FTed%E4%B8%80%E6%A0%B7%E7%B2%BE%E5%BD%A9%E7%9A%84%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/"/>
    <id>http://offbye.com/2016/06/29/如何做一场像Ted一样精彩的技术演讲/</id>
    <published>2016-06-29T01:33:55.000Z</published>
    <updated>2016-07-04T05:44:01.000Z</updated>
    
    <content type="html">&lt;p&gt;最近几个月由于准备演讲的原因，反复看了几遍《像TED一样演讲》这本书，并看了大量的TED演讲，感触颇深，学到了很多演讲的技巧和误区。最近我在南京软件开发者大会和全球移动技术大会做了2场还算精彩的技术演讲，大量应用了书中的一些思想，演讲现场听众的反馈情况还不错。参加技术大会演讲是成为技术大牛的重要道路之一，那么我们怎样才能做一场精彩而不枯燥的技术演讲呢？&lt;/p&gt;
&lt;p&gt;我们先分析下技术演讲和典型的TED演讲的差别。首先是演讲内容和面对的观众不同。技术演讲的内容一般都有一定的技术门槛，很多时候外行是不容易有较深入的理解的，听众有着明显的局限性，一般都是某个领域的技术和业务人员，同时听众的专业能力差别还有比较大的，专家、一般水平和新手的听众人数一般是金字塔分布，因此需要照顾不同水平的人对内容的接受度和想法。TED演讲的观众则比较广泛，演讲需要简洁生动，具备传播属性。然后是演讲时间长度不一样，典型的TED演讲的时间一般是6-18分钟，技术演讲的时间一般是40分钟，因此TED演讲是更困难的，因为你需要在更短的时间内抓住听众的注意力，让听众接受你的观点。技术演讲由于时间相对较长，可以进行一些比较深入的探讨，但是也需要考虑到听众的注意力，需要在演讲过程中想办法活跃气氛。&lt;/p&gt;
&lt;p&gt;接下来我从演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，详细探讨下如何一场精彩的技术演讲。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;首先要有一个好的技术演讲主题，什么是好的主题呢？ 好的主题首先意味着你对这个主题要有热情，要有特别的见解。例如你比多数人更早的关注一门新技术，有热情把它介绍给更多的人；你在某个技术领域有着丰富的实践经验，想和别人分享；你对某个技术领域研究比较深入，做了个开源项目，想让更多的人知道和使用等。一定要挖掘出自己和演讲主题之间独特而有意义的连接点，这样才可以激发自己对演讲主题的热情，然后你才能用热情感染观众。&lt;/p&gt;
&lt;p&gt;演讲主题需要主题明确，范围清晰，逻辑严密。要对演讲的内容保持节制，主题无关的内容不要轻易加入到PPT中。主题不宜太大太宽泛，范围需要清楚明确，最好能做到让人看到题目就能知道大概是讲哪方面的内容。演讲主题太大是新手最容易犯的错误之一，总想做自己演讲中塞入太多的东西，导致主题不明确，没有重点，让人听完后感觉不记得都讲了些什么。&lt;/p&gt;
&lt;p&gt;另外需要注意的是，特别干货的技术内容并不太适合拿来做一场精彩的演讲，更适合作为文章发表。例如现场介绍和推导某个算法，大量复杂代码的讲解等。除非你有高超的演讲技巧，并且台下的观众都很专业，否则很难把这类主题讲精彩。现在的一些技术大会由于观众水平参差不齐，技术背景和经验都不一样，因此太干货的内容并不容易受到多数人的欢迎，反而有催眠效果。&lt;/p&gt;
&lt;p&gt;你对自己的演讲主题必须有深刻地认识，包括涉及的每个技术细节都需要很清楚，这样才能有足够的信心做好演讲，深入浅出地讲出来，也才能比较优雅地面对观众的提问。我参加的每场演讲都会把涉及的每个技术细节都弄清楚，演讲PPT不允许出现任何细节错误，并对观众可能提出的问题进行事先准备。&lt;/p&gt;
&lt;p&gt;定好主题后，需要从观众的角度看待这个主题，也就是换位思考，如果你是观众你会不会想听这个主题？你想从这场演讲了解到些什么？怎样才能引起观众的兴趣，激发观众的共鸣？&lt;/p&gt;
&lt;p&gt;然后可以针对主题做个信息视图了，信息视图就是你演讲内容的层次结构图，一般可以是层次结构图或流程图，相对传统的目录结构，用信息视图可以更好帮你理清演讲的内容逻辑。可以用Powerpoint的SmartArt功能，流程图软件或思维导图软件制作信息视图。在演讲中需要尽早的把信息视图讲给观众，以便让大家对你的演讲有整体的认识，也可以在最后演讲总结时把信息视图总结给大家，我一般是在介绍完演讲主题后就讲解本次演讲的信息视图或目录结构。因为观众基本上都是技术人员，思维逻辑性一般都比较强，因此演讲内容之间需要用强逻辑关联起来，并在演讲过程中注意强调当前演讲的层次，这样能够让人感觉演讲内容很连贯，很有逻辑，也有助于观众保持清晰的思路跟上你的演讲节奏。&lt;/p&gt;
&lt;p&gt;如何做一个好的技术演讲开场，这个需要根据你的主题来定。首先你可以根据演讲主题介绍下自己的背景，要讲和演讲相关的内容，说明你为什么要做这场演讲，为什么由你来给大家讲这个主题。然后可以讲个简单的故事，需要能引起观众的共鸣，拉近和观众的距离。也可以做几个现场互动提问，了解观众的组成情况，活跃现场的气氛，缓解自己的紧张状态。还可以做些适当的安排，留一些后面会解答的悬念。&lt;/p&gt;
&lt;p&gt;下面进入演讲的内容部分了，从TED演讲学来的一个有用的技巧是用好3这个数字，3点内容是最容易让人记住的，例如把观点总结成3个重点，比提出5个以上重点要更容易让人记住，也更有利于传播。PPT上不要放很多文字，TED的建议是一页PPT最多不要超过40个词，对于技术演讲来说，这个限制有时并不适合，例如你需要讲解代码时。但是，我们需要保持PPT的简洁，PPT上放太多内容会让观众更关注读PPT上的文字而不是听你演讲，所以时刻要抵挡把太多文字内容放在PPT上的诱惑，你可以把它们放到演讲者备注里面，然后在PPT上放一张精彩的图片代替，图片可以用关键词在谷歌图片上找，然后演讲时把文字内容讲出来，并和图片建立链接，视觉化的内容更有利于观众记忆。&lt;/p&gt;
&lt;p&gt;关于数据，很多技术演讲都需要用数据证明你的观点。TED演讲介绍的一种专业做法是每张幻灯片只放一个数据，这样更容易让人印象深刻，增强说服力。一页PPT不要放很多数据，可以用各种图表代替数据表。还可以通过对坐标轴做处理强化你的数据对比效果，我记得淘宝的一些技术演讲用过这个方法，但这种小把戏最好不要玩，因为做技术的人一般对数据都挺敏感的。&lt;br&gt;&lt;!-- http://www.offbye.com --&gt;&lt;/p&gt;
&lt;p&gt;接下来讲下时间控制问题。一般TED演讲是6-18分钟，而现在一般技术演讲是45分钟，其中演讲时间是40分钟，最后留五分钟提问时间，因此技术演讲可以讲的更多更深一点。技术演讲同样需要严格控制好时间，一般PPT准备25页左右就差不多了，如果包含动画和快速带过的页面可以适当增加，一般不要超过50页，新手容易犯放太多内容在PPT里面这个错误。参加过那么多次技术大会，我还没有见过提前很多时间讲完PPT的，很多人都是在最后讲不完PPT，在最后五分钟提示时匆匆忙忙地翻后面一半的PPT，然后这场技术演讲基本上就失败了。即使你提前5分钟讲完了，多安排点提问交流时间也就可以了。为了做好时间控制，正式演讲前可以先进行几次小范围的试讲，自己对着镜子讲也可以，还可以用Powerpoint的排练计时功能记录每页演讲的时间，并进行分析。保存排练记时后，Powerpoint在下次演示时可以根据时间自动翻页，但一般不要这样做，这样演讲感觉会不够自然，不好即兴发挥。&lt;/p&gt;
&lt;p&gt;连续讲40分钟技术对观众的注意力是个很大的挑战，除非你讲的特别风趣幽默，但多数技术人员做不到这一点，因此演讲中间安排几次互动环节是很有必要的，例如提问和简单演示，可以帮助观众恢复注意力。注意现场演示是个坑，很容易出状况，需要做好各种预防措施，特别是涉及网络和服务器的要特别注意提前现场测试确认好，演示电脑一定要用自己的，可以有效避免各种演示问题。&lt;/p&gt;
&lt;p&gt;最后总结一下，本文结合《像TED一样演讲》书中介绍的思想和方法，探讨了如何做一场精彩的技术演讲。在演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，提出了一些思路和实践。&lt;/p&gt;
&lt;p&gt;希望各位做技术的同学在未来都能做一场精彩的技术演讲！&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近几个月由于准备演讲的原因，反复看了几遍《像TED一样演讲》这本书，并看了大量的TED演讲，感触颇深，学到了很多演讲的技巧和误区。最近我在南京软件开发者大会和全球移动技术大会做了2场还算精彩的技术演讲，大量应用了书中的一些思想，演讲现场听众的反馈情况还不错。参加技术大会演讲是成为技术大牛的重要道路之一，那么我们怎样才能做一场精彩而不枯燥的技术演讲呢？&lt;/p&gt;
&lt;p&gt;我们先分析下技术演讲和典型的TED演讲的差别。首先是演讲内容和面对的观众不同。技术演讲的内容一般都有一定的技术门槛，很多时候外行是不容易有较深入的理解的，听众有着明显的局限性，一般都是某个领域的技术和业务人员，同时听众的专业能力差别还有比较大的，专家、一般水平和新手的听众人数一般是金字塔分布，因此需要照顾不同水平的人对内容的接受度和想法。TED演讲的观众则比较广泛，演讲需要简洁生动，具备传播属性。然后是演讲时间长度不一样，典型的TED演讲的时间一般是6-18分钟，技术演讲的时间一般是40分钟，因此TED演讲是更困难的，因为你需要在更短的时间内抓住听众的注意力，让听众接受你的观点。技术演讲由于时间相对较长，可以进行一些比较深入的探讨，但是也需要考虑到听众的注意力，需要在演讲过程中想办法活跃气氛。&lt;/p&gt;
&lt;p&gt;接下来我从演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，详细探讨下如何一场精彩的技术演讲。&lt;br&gt;
    
    </summary>
    
    
      <category term="技术演讲" scheme="http://offbye.com/tags/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/"/>
    
      <category term="TED" scheme="http://offbye.com/tags/TED/"/>
    
      <category term="演讲技巧" scheme="http://offbye.com/tags/%E6%BC%94%E8%AE%B2%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>GMTC2016移动技术大会参会感想</title>
    <link href="http://offbye.com/2016/06/28/GMTC2016%E7%A7%BB%E5%8A%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A%E5%8F%82%E4%BC%9A%E6%84%9F%E6%83%B3/"/>
    <id>http://offbye.com/2016/06/28/GMTC2016移动技术大会参会感想/</id>
    <published>2016-06-28T10:19:43.000Z</published>
    <updated>2016-06-28T10:29:09.000Z</updated>
    
    <content type="html">&lt;p&gt;6月24日参加InfoQ举办的GMTC移动技术大会，并做了一场演讲，还参加了晚上的Swift3.0闭门交流会议，受益很多。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;6月24日上午是全体大会，首先是手机淘宝的长恭，微信的赵原，京东的王永杰做了移动未来开发展望的开场演讲。然后是Facebook早期员工覃超做了Facebook App演进过程的演讲，主要介绍了Facebook App各个版本的技术实现和经验总结，印象比较深的有下面几点：要选择对用户优化的技术而不是对开发团队优化的技术；现在FacebookApp已经是通过appurl scheme跳转的组件化项目，主要是iOS原生技术实现，Facebook已经有1000多iOS工程师，整个项目只有一个codebase，使用Mercurial做版本管理，git已经太卡了,使用Buck编译项目;新技术的接受曲线，到达高潮后会有一个低谷，然后走向正常的发展阶段。&lt;/p&gt;
&lt;p&gt;然后是Square的邵震的演讲Mobile Growth的方法和实践，是近几年流行的增长黑客相关的实践，介绍了Growth实践中的一些心得，最重要的是留存，工程师驱动，通过高层战略推动底层执行。然后介绍了一些A/B Testing系统的实践。Deep Link的趋势和使用，就是通过一些网页链接进入App。&lt;/p&gt;
&lt;p&gt;下午的演讲分三个分会场，我主要参加了Swift分会场和插件化分会场。Swift分会场第一场是傅若愚的Swift函数式编程，函数式编程是个不太容易讲的话题，主要是涉及的概念比较多，这个演讲有比较易懂的方式介绍了函数式编程。&lt;/p&gt;
&lt;p&gt;Swift分会场第二场是我的演讲From Java/Android To Swift iOS，主要是分享Android开发者如何快速上手Swift开发，以及一些Swift项目经验和开源框架，还介绍了Swift3.0的一些新特性，感兴趣的可以下载ppt看看。&lt;/p&gt;
&lt;p&gt;然后去了插件化专场，听林光亮介绍了Small插件化插件，他主要先分析了Android插件化的各种技术和插件化框架，然后介绍了small插件化框架的实现思路和技术实现。﻿这个插件化方案我感觉是目前比较合理的，技术上也比较先进，希望后面项目能用上。&lt;/p&gt;
&lt;p&gt;最后是聚划算的朴诚介绍聚划算的Luaview动态化开发实践，LuaviewSDK提供了一种动态化能力，适合原生App的某些页面嵌入动态内容，性能很好，和React Native，weex等插件化方案比较，是一种更轻量的插件化方案。&lt;/p&gt;
&lt;p&gt;25日上午参加的是架构演进专场，第一场是手机天猫解耦之路，介绍了天猫iOS App演进过程和组件化开发技术，通过BeeHive框架实现解耦依赖，统跳协议解耦界面，印象深刻的是活用了Web服务器的UrlRewrite技术，通过正则表达式Rewrite URL。&lt;/p&gt;
&lt;p&gt;第二场是滴滴李贤辉滴滴iOS组件化优化与实践。介绍了滴滴iOS App组件化的背景，70个开发人员，7条业务线，70万代码。代码冲突多，发布困难。介绍了一些组件化的专项技术，业务线接入，页面结构，导航管理组件，共享地图组件，灰度系统apollo等，干货很多，值得回去仔细研究学习。&lt;/p&gt;
&lt;p&gt;上午第三场是iOS遗留代码重构，从CoreData迁移到Realm说起。﻿介绍了抽象分支的概念，通过抽象层替换旧代码模块。特性开关，4种实现方式，如后台服务，ab test框架。通过适配器模式透明支持CoreData和RealmDB持久化服务。最后介绍了Realm的坑，不支持集联删除，不支持多态，难以理解的反向关联。遗留代码的重构确实是个麻烦的事情，这个演讲对iOS项目的重构有一定参考价值。&lt;/p&gt;
&lt;p&gt;下午参加了性能优化专场，第一场是微信叶润桂的演讲《微信客户端怎样应对弱网络》﻿。前面主要介绍介绍了针对TCP/IP协议的移动网络优化，介绍了各种算法。﻿然后讲解了微信发图片协议合并优化，上传图片后，由图片服务器直接通过内网和业务服务器通信。﻿低成本重传，降低重传的包大小，或使用流式协议。渐进式图片，有损上传和下载。最后安利了后面打算开源的Mars跨平台开源网络组件。&lt;/p&gt;
&lt;p&gt;第二场是杨刚的360手机卫士性能优化之路，首先介绍了性能优化的各种问题，lint和Findbugs，自有代码检测工具，基于jenkins平台的检测系统。AspectJ重写器，实现网络静态埋点的例子。然后介绍了性能监控，进程的冷热启动等。由于360手机卫士总是优化手机杀其他App的进程，这兄弟提问环节被问的比较郁闷。&lt;/p&gt;
&lt;p&gt;最后听的演讲是支付宝App的性能稳定性和运维实践，介绍了支付宝App3个阶段的架构演进，性能优化实践和超级App的运维体系介绍。&lt;/p&gt;
&lt;p&gt;整个大会大概有30多场演讲，很多都是各大公司的实践经验分享，干货很多，对我来说帮助比较大的是安卓的插件化和iOS的组件化开发，由于业务发展需要，这些技术后面需要逐步引入了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;6月24日参加InfoQ举办的GMTC移动技术大会，并做了一场演讲，还参加了晚上的Swift3.0闭门交流会议，受益很多。&lt;/p&gt;
    
    </summary>
    
    
      <category term="GMTC2016" scheme="http://offbye.com/tags/GMTC2016/"/>
    
      <category term="移动技术大会" scheme="http://offbye.com/tags/%E7%A7%BB%E5%8A%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A/"/>
    
  </entry>
  
</feed>

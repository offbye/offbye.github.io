<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>offbye</title>
  <subtitle>关注移动架构，Android，HTML5，iOS技术前沿</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://offbye.com/"/>
  <updated>2016-07-23T02:21:32.000Z</updated>
  <id>http://offbye.com/</id>
  
  <author>
    <name>offbye</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>安卓旧项目使用Small框架插件化改造踩坑记</title>
    <link href="http://offbye.com/2016/07/22/%E5%AE%89%E5%8D%93%E6%97%A7%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8Small%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E6%8F%92%E4%BB%B6%E5%8C%96%E6%94%B9%E9%80%A0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>http://offbye.com/2016/07/22/安卓旧项目使用Small框架进行插件化改造的问题汇总/</id>
    <published>2016-07-22T13:28:18.000Z</published>
    <updated>2016-07-23T02:21:32.000Z</updated>
    
    <content type="html">&lt;p&gt;我们团队把一个10万行安卓代码的旧项目（电商系统管理台App），使用Small框架做了插件化改造。把项目分成了10多个插件模块，解除了业务模块之间的代码耦合，为业务功能的快速迭代和多团队并行开发做好基础架构。迁移期间遇到了一些坑，但最后在大家的努力下基本得到了解决，也感谢Small的作者光亮对我们提出的issue的快速响应。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Small的应用场景&quot;&gt;&lt;a href=&quot;#Small的应用场景&quot; class=&quot;headerlink&quot; title=&quot;Small的应用场景&quot;&gt;&lt;/a&gt;Small的应用场景&lt;/h2&gt;&lt;p&gt;开发时：让你完全透明的像开发普通工程一样完成插件开发&lt;br&gt;编译时：自动化的帮助你分离各个公共库、业务模块插件（插件仅保留自身的代码跟资源，达到最小化）&lt;br&gt;运行时：运用最少量的Hook无缝的将各个插件并入宿主，让代码跟资源完全融合，自由调用&lt;br&gt;所以撇开开发者不用关注的(2)来说，Small的目的就是要做到保证开发者「畅快开发」的体验，以及App使用者「顺畅使用」的体验。&lt;/p&gt;
&lt;p&gt;插件化方案有很多，很难有统一的形态，各有各的适用场景。如果你需要分发你的插件给别人使用，Small无法满足；如果你想利用插件化拆分、重组自己的应用，我认为Small在这方面已经走在了前面，并且将不断完善，做到极致。&lt;/p&gt;
&lt;h2 id=&quot;插件化的工程（开发）结构&quot;&gt;&lt;a href=&quot;#插件化的工程（开发）结构&quot; class=&quot;headerlink&quot; title=&quot;插件化的工程（开发）结构&quot;&gt;&lt;/a&gt;插件化的工程（开发）结构&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues/118&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;关于工程（开发）结构的讨论&lt;/a&gt;&lt;br&gt;1.依赖管理：Small使用同一个ClassLoader加载不同的插件，因此不同插件中的依赖在运行时对其他插件和宿主都是可见的，所以依赖的管理一定要收敛，统一管理，避免各自引入。&lt;br&gt;2.插件之间的通信：插件的开发一般都是多team并行的，插件之间应避免直接调用来减少耦合&lt;br&gt;3.资源的使用：由于small的特性，runtime各插件的资源也是可以相互访问的，但在开发上需要组织和统一管理好，包括命名和安全的使用资源。&lt;/p&gt;
&lt;h2 id=&quot;老项目集成Small插件的官方建议&quot;&gt;&lt;a href=&quot;#老项目集成Small插件的官方建议&quot; class=&quot;headerlink&quot; title=&quot;老项目集成Small插件的官方建议&quot;&gt;&lt;/a&gt;老项目集成Small插件的官方建议&lt;/h2&gt;&lt;h3 id=&quot;基本原则&quot;&gt;&lt;a href=&quot;#基本原则&quot; class=&quot;headerlink&quot; title=&quot;基本原则&quot;&gt;&lt;/a&gt;基本原则&lt;/h3&gt;&lt;p&gt;宿主中不要放业务逻辑。只做加载插件以及调起主插件的操作。&lt;/p&gt;
&lt;h3 id=&quot;重构步骤&quot;&gt;&lt;a href=&quot;#重构步骤&quot; class=&quot;headerlink&quot; title=&quot;重构步骤&quot;&gt;&lt;/a&gt;重构步骤&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;拆lib.&lt;em&gt; - 公共模块插件&lt;br&gt;把各个第三方库拆出来做成一个个`lib.&lt;/em&gt;`插件模块，包括统计、地图、网络、图片等库。&lt;br&gt;把老项目积累的业务公共代码(utils)分离出来封装成一个lib.utils插件&lt;br&gt;把基础的样式、主题分离出来封装成一个lib.style插件&lt;/li&gt;
&lt;li&gt;拆app.&lt;em&gt; - 业务模块插件&lt;br&gt;把业务模块拆成`app.&lt;/em&gt;&lt;code&gt;模块，他们可以依赖&lt;/code&gt;lib.&lt;em&gt;&lt;code&gt;模块，显示调用&lt;/code&gt;lib.&lt;/em&gt;`中的各个API&lt;br&gt;相对独立的业务模块先拆，比如“详情页”、“关于我们”，如果剩下的业务不好拆，先放一个插件里&lt;br&gt;如果都不好拆，先把全部业务做成一个app.main主插件&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;插件之间的通信&quot;&gt;&lt;a href=&quot;#插件之间的通信&quot; class=&quot;headerlink&quot; title=&quot;插件之间的通信&quot;&gt;&lt;/a&gt;插件之间的通信&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues/120&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;插件之间的通信/互调&lt;/a&gt;&lt;br&gt;目前的插件之间的通信仅限于Small.openUri()，用来调起其它插件的页面。&lt;/p&gt;
&lt;p&gt;但有些时候，我们还是需要操作一下其它插件。 比如说在跳转到另一个插件的页面之前，需要查询一下对方插件的一个状态。&lt;br&gt;我觉得应该借助v4包的LocalBroadcastManager来实现&lt;/p&gt;
&lt;h2 id=&quot;老项目集成Small插件化遇到的坑&quot;&gt;&lt;a href=&quot;#老项目集成Small插件化遇到的坑&quot; class=&quot;headerlink&quot; title=&quot;老项目集成Small插件化遇到的坑&quot;&gt;&lt;/a&gt;老项目集成Small插件化遇到的坑&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;插件中通过startActivityForResult获取不到数据问题。如果启动的Activity是SingleTask启动模式，有这个问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;插件lib2依赖插件lib1，导致同时依赖lib1和lib2的插件app1编译时出现找不到类的情况。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;一个lib依赖另一个lib，buildLib时出现Duplicate package错误&lt;br&gt;一个lib依赖另一个lib，buildLib时出现下面的错误，目前还没有找到解决吧，clean工程和cleanLib都做了，但还不行，只好把依赖去掉了才行。原因未知&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果插件用到了百度地图等，需要把相关的功能放在一个插件下面，注意那些很大的.so是放在插件里面的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Small插件中是支持aar引用的，实际使用过了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Small的插件限制了包名，因此已有代码复制过来会有改变。特别要注意layout文件中自定义控件包名的改动，能够通过编译但运行时会找不到类。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;通过assembleRelease单独编译一个插件出现下面的错误，但有的电脑能正常单独编译插件，原因未知，已经提issue。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;下午2:30:54: Executing external task &amp;apos;assembleRelease&amp;apos;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Configuration on demand is an incubating feature.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Incremental java compilation is an incubating feature.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* What went wrong:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;A problem occurred configuring project &amp;apos;:app.me&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; Could not find property &amp;apos;android&amp;apos; on project &amp;apos;:app&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* Try:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BUILD FAILED&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第三方SDK的meta，Service等需要在宿主App的manifest中声明，例如百度地图SDK的定位Service。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;lib.utils删除资源后出现编译错误，解决办法是删除public.txt，重新编译lib和bundle&lt;/li&gt;
&lt;li&gt;老代码一些业务上耦合比较紧的页面不容易拆开，可以作为一个模块存在，我们最后拆成了6个大模块。&lt;/li&gt;
&lt;li&gt;&lt;p&gt;目前1.0版本不支持gradle并行编译，在gradle.properties中打开&lt;code&gt;org.gradle.parallel=true&lt;/code&gt; 编译会报错&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;  gradle  buildLib -q&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Small] [Small] building library 1 of 2 - app (0x7f)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[Small] [Small] building library 1 of 2 - app (0x7f)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;building library 2 of 2 - lib.utils (0x73)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* What went wrong:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Execution failed for task &amp;apos;:lib.utils:preBuild&amp;apos;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ./build-small/intermediates/small-pre-link/aar/app-D.txt (No such file or directory)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考&lt;a href=&quot;http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gradle文档&lt;/a&gt;&lt;br&gt;这个不是Bug，有依赖的工程肯定是不能并行编译的&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;后面遇到问题会持续更新&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/wequick/Small/issues&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/wequick/Small/issues&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我们团队把一个10万行安卓代码的旧项目（电商系统管理台App），使用Small框架做了插件化改造。把项目分成了10多个插件模块，解除了业务模块之间的代码耦合，为业务功能的快速迭代和多团队并行开发做好基础架构。迁移期间遇到了一些坑，但最后在大家的努力下基本得到了解决，也感谢Small的作者光亮对我们提出的issue的快速响应。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://offbye.com/tags/Android/"/>
    
      <category term="Small框架" scheme="http://offbye.com/tags/Small%E6%A1%86%E6%9E%B6/"/>
    
      <category term="插件化" scheme="http://offbye.com/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Android OkHttp3使用http2问题记录</title>
    <link href="http://offbye.com/2016/07/09/Android-OkHttp3%E4%BD%BF%E7%94%A8http2%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>http://offbye.com/2016/07/09/Android-OkHttp3使用http2问题记录/</id>
    <published>2016-07-09T01:52:52.000Z</published>
    <updated>2016-07-18T02:01:24.000Z</updated>
    
    <content type="html">&lt;p&gt;Android Okhttp3使用http2.0协议的接口时，发现一个问题，打印错误Log &lt;code&gt;E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx&lt;/code&gt;,Google上没有查到相关的信息，毕竟现在http2用的还很少。经查看Android源码，排查发现这只是个LOG，不是错误，可以放心的用http2了。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;测试http2发现android打印了下面的LOG&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.182 13670-13697/com.qianmi.shine I/System.out: [CDS]connect[shineapi2.qianmi.com/120.55.247.77:443] tm:20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.187 13670-13697/com.qianmi.shine E/Posix: [Posix_connect Debug]Process com.qianmi.shine :443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.251 13670-13697/com.qianmi.shine D/libc-netbsd: [getaddrinfo]: hostname=shineapi2.qianmi.com; servname=(null); cache_mode=(null), netid=0; mark=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.252 13670-13697/com.qianmi.shine D/libc-netbsd: [getaddrinfo]: ai_addrlen=0; ai_canonname=(null); ai_flags=4; ai_family=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.300 13670-13697/com.qianmi.shine E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx=0xdec78080 arg=0x0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.301 13670-13697/com.qianmi.shine E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback calling verifyCertificateChain authMethod=ECDHE_RSA&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;07-08 14:33:57.431 13670-13697/com.qianmi.shine I/System.out: gba_cipher_suite:TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到github上找下相关的Android源码，&lt;br&gt;&lt;a href=&quot;https://github.com/ACSOP/android_libcore/blob/88e2ca00cc0c161d9aa3e512b8ae58b3091dbf87/luni/src/main/native/org_apache_harmony_xnet_provider_jsse_NativeCrypto.cpp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/ACSOP/android_libcore/blob/88e2ca00cc0c161d9aa3e512b8ae58b3091dbf87/luni/src/main/native/org_apache_harmony_xnet_provider_jsse_NativeCrypto.cpp&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Verify the X509 certificate via SSL_CTX_set_cert_verify_callback&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;static int cert_verify_callback(X509_STORE_CTX* x509_store_ctx, void* arg __attribute__ ((unused)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /* Get the correct index to the SSLobject stored into X509_STORE_CTX. */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    SSL* ssl = reinterpret_cast&amp;lt;SSL*&amp;gt;(X509_STORE_CTX_get_ex_data(x509_store_ctx,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            SSL_get_ex_data_X509_STORE_CTX_idx()));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback x509_store_ctx=%p arg=%p&quot;, ssl, x509_store_ctx, arg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    AppData* appData = toAppData(ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNIEnv* env = appData-&amp;gt;env;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (env == NULL) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        LOGE(&quot;AppData-&amp;gt;env missing in cert_verify_callback&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        JNI_TRACE(&quot;ssl=%p cert_verify_callback =&amp;gt; 0&quot;, ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jobject sslHandshakeCallbacks = appData-&amp;gt;sslHandshakeCallbacks;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jclass cls = env-&amp;gt;GetObjectClass(sslHandshakeCallbacks);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jmethodID methodID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        = env-&amp;gt;GetMethodID(cls, &quot;verifyCertificateChain&quot;, &quot;([[BLjava/lang/String;)V&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jobjectArray objectArray = getCertificateBytes(env, x509_store_ctx-&amp;gt;untrusted);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    const char* authMethod = SSL_authentication_method(ssl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback calling verifyCertificateChain authMethod=%s&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              ssl, authMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    jstring authMethodString = env-&amp;gt;NewStringUTF(authMethod);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    env-&amp;gt;CallVoidMethod(sslHandshakeCallbacks, methodID, objectArray, authMethodString);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int result = (env-&amp;gt;ExceptionCheck()) ? 0 : 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    JNI_TRACE(&quot;ssl=%p cert_verify_callback =&amp;gt; %d&quot;, ssl, result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;JNI_TRACE其实就是个封装了LOG的宏，定义如下：&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;ifdef&lt;/span&gt; WITH_JNI_TRACE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; JNI_TRACE(...) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)LOG(LOG_INFO, LOG_TAG &lt;span class=&quot;string&quot;&gt;&quot;-jni&quot;&lt;/span&gt;, __VA_ARGS__));     \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(&quot;I/&quot; LOG_TAG &quot;-jni:&quot;));         \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(__VA_ARGS__));          \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ((void)printf(&quot;\n&quot;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; JNI_TRACE(...) ((void)0)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是最后还是有一点疑惑，源码打印的LOG是info级别的，但手机上logcat打印出的error log，这也是我为什么会注意到的原因，目前只能认为是手机和源码的代码不同了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Android Okhttp3使用http2.0协议的接口时，发现一个问题，打印错误Log &lt;code&gt;E/NativeCrypto: ssl=0xd25d4000 cert_verify_callback x509_store_ctx&lt;/code&gt;,Google上没有查到相关的信息，毕竟现在http2用的还很少。经查看Android源码，排查发现这只是个LOG，不是错误，可以放心的用http2了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="http2" scheme="http://offbye.com/tags/http2/"/>
    
      <category term="Android" scheme="http://offbye.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android Volley整合升级OkHttp3.3问题</title>
    <link href="http://offbye.com/2016/07/07/Android-Volley%E6%95%B4%E5%90%88%E5%8D%87%E7%BA%A7OkHttp3-3%E9%97%AE%E9%A2%98/"/>
    <id>http://offbye.com/2016/07/07/Android-Volley整合升级OkHttp3-3问题/</id>
    <published>2016-07-07T04:38:57.000Z</published>
    <updated>2016-07-08T11:15:55.000Z</updated>
    
    <content type="html">&lt;p&gt;我们以前的Android项目网络框架是基于Volley和OKHttp2。现在由于Aliyun SDK升级和整合React Native模块的原因，它们现在都是用了OkHttp3，因此需要统一升级到最新稳定版本OkHttp3.3。&lt;br&gt;参考了网上的一些资料，主要是有下面几个问题:首先是’org.apache.http’在Android6.0版本已经去掉了，因此需要用’org.apache.http.legacy’代替下。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;OkHttp3Stack是参考了下面的Gist代码实现的，评论里面说不支持https。但是我实际测试过是支持https和http2的。&lt;br&gt;&lt;a href=&quot;https://gist.github.com/alashow/c96c09320899e4caa06b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/alashow/c96c09320899e4caa06b&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在app/gradle.settings的android块增加下面代码&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;useLibrary &amp;apos;org.apache.http.legacy&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;另外一种方法是不再使用org.apache.http相关的类，参考&lt;a href=&quot;http://blog.csdn.net/qq_28656671/article/details/50608239&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/qq_28656671/article/details/50608239&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最后提醒一下，Volley框架现在已经不再升级了，后面的新项目不建议使用了，推荐使用基于Retrofit和OkHttp3的请求框架，老项目升级成本有点高，就不折腾了。&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/b022eed6b427&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/b022eed6b427&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/qq_28656671/article/details/50608239&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/qq_28656671/article/details/50608239&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/android_ls/article/details/50493581&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/android_ls/article/details/50493581&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/square/okhttp/blob/master/CHANGELOG.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/square/okhttp/blob/master/CHANGELOG.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/alashow/c96c09320899e4caa06b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/alashow/c96c09320899e4caa06b&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/richiewang/p/5140040.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/richiewang/p/5140040.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mcxiaoke/android-volley&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/mcxiaoke/android-volley&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我们以前的Android项目网络框架是基于Volley和OKHttp2。现在由于Aliyun SDK升级和整合React Native模块的原因，它们现在都是用了OkHttp3，因此需要统一升级到最新稳定版本OkHttp3.3。&lt;br&gt;参考了网上的一些资料，主要是有下面几个问题:首先是’org.apache.http’在Android6.0版本已经去掉了，因此需要用’org.apache.http.legacy’代替下。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>JWT安全验证常见疑问解答</title>
    <link href="http://offbye.com/2016/07/04/JWT%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81%E5%B8%B8%E8%A7%81%E7%96%91%E9%97%AE%E8%A7%A3%E7%AD%94/"/>
    <id>http://offbye.com/2016/07/04/JWT安全验证常见疑问解答/</id>
    <published>2016-07-04T05:49:14.000Z</published>
    <updated>2016-07-05T04:21:37.000Z</updated>
    
    <content type="html">&lt;p&gt;最近做基于&lt;a href=&quot;http://samnewman.io/patterns/architectural/bff/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BFF架构&lt;/a&gt;的分布式移动端API接口的系统设计。工作过程中发现有些工程师对JWT安全验证的认识存在一些偏差，重复讲解实在太麻烦了，在这里把关于JWT常见的一些疑问统一回答下吧。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;什么是JWT？&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://tools.ietf.org/html/rfc7519&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JSON Web Token (JWT)&lt;/a&gt;是一种基于 token 的认证方案。&lt;br&gt;JSON Web Tokens are an open, industry standard &lt;a href=&quot;https://tools.ietf.org/html/rfc7519&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RFC 7519&lt;/a&gt; method for representing claims securely between two parties.&lt;br&gt;简单的说，JWT就是一种Token的编码算法，服务器端负责根据一个密码和算法生成Token，然后发给客户端，客户端只负责后面每次请求都在HTTP header里面带上这个Token，服务器负责验证这个Token是不是合法的，有没有过期等，并可以解析出subject和claim里面的数据。&lt;/p&gt;
&lt;p&gt;注意JWT里面的数据是BASE64编码的，没有加密，因此不要放如敏感数据。&lt;/p&gt;
&lt;p&gt;可以通过&lt;a href=&quot;https://jwt.io/这个网站对JWT&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://jwt.io/这个网站对JWT&lt;/a&gt; Token进行解析。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;一个JWT token 看起来是这样的:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjEzODY4OTkxMzEsImlzcyI6ImppcmE6MTU0ODk1OTUiLCJxc2giOiI4MDYzZmY0Y2ExZTQxZGY3YmM5MGM4YWI2ZDBmNjIwN2Q0OTFjZjZkYWQ3YzY2ZWE3OTdiNDYxNGI3MTkyMmU5IiwiaWF0IjoxMzg2ODk4OTUxfQ.uKqU9dTB6gKwG6jQCuXYAiMNdfNRw98Hw_IWuA5MaMo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以简化为下面这样的结构:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;base64url_encode(Header) + &amp;apos;.&amp;apos; + base64url_encode(Claims) + &amp;apos;.&amp;apos; + base64url_encode(Signature)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为什么用JWT？&lt;/p&gt;
&lt;p&gt;JWT只通过算法实现对Token合法性的验证，不依赖数据库，Memcached的等存储系统，因此可以做到跨服务器验证，只要密钥和算法相同，不同服务器程序生成的Token可以互相验证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;JWT Token需要持久化在Memcached中吗？&lt;br&gt;不应该这样做，这样就背离了JWT通过算法验证的初心。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在退出登录时怎样实现JWT Token失效呢？&lt;br&gt;退出登录， 只要客户端端把Token丢弃就可以了，服务器端不需要废弃Token。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;怎样保持客户端长时间保持登录状态？&lt;/p&gt;
&lt;p&gt;服务器端提供刷新Token的接口， 客户端负责按一定的逻辑刷新服务器Token。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;服务器端是否应该从JWT中取出userid用于业务查询？&lt;/p&gt;
&lt;p&gt;REST API是无状态的，意味着服务器端每次请求都是独立的，即不依赖以前请求的结果，因此也不应该依赖JWT token做业务查询， 应该在请求报文中单独加个userid 字段。&lt;br&gt;为了做用户水平越权的检查，可以在业务层判断传入的userid和从JWT token中解析出的userid是否一致， 有些业务可能会允许查不同用户的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;JWT 在Java项目中如何实现？&lt;/p&gt;
&lt;p&gt;生成Token&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;String token = Jwts.builder().setSubject(userId)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .setExpiration(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Date(System.currentTimeMillis() + Constant.TOKEN_EXP_TIME))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .claim(&lt;span class=&quot;string&quot;&gt;&quot;roles&quot;&lt;/span&gt;, Constant.USER_TYPE_EMP).setIssuedAt(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Date())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .signWith(SignatureAlgorithm.HS256, Constant.JWT_SECRET).compact();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;loginResponse.setToken(token);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;验证JWT Token&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String authHeader = request.getHeader(&lt;span class=&quot;string&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (authHeader == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || !authHeader.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;Bearer &quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   log.debug(&lt;span class=&quot;string&quot;&gt;&quot;no Authorization &quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String token = authHeader.substring(&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// The part after &quot;Bearer &quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(&lt;span class=&quot;string&quot;&gt;&quot;token &quot;&lt;/span&gt; + token);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Claims claims = Jwts.parser().setSigningKey(Constant.JWT_SECRET)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .parseClaimsJws(token).getBody();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(claims.toString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123; &lt;span class=&quot;comment&quot;&gt;//包含超时，签名错误等异常&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        log.debug(&lt;span class=&quot;string&quot;&gt;&quot;JWT Exception&quot;&lt;/span&gt;, e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意客户端发送的Authorization HTTP HEADER格式是 “Bearer YOUR_JWT_TOKEN”,这是OAuth的规范规定的。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近做基于&lt;a href=&quot;http://samnewman.io/patterns/architectural/bff/&quot;&gt;BFF架构&lt;/a&gt;的分布式移动端API接口的系统设计。工作过程中发现有些工程师对JWT安全验证的认识存在一些偏差，重复讲解实在太麻烦了，在这里把关于JWT常见的一些疑问统一回答下吧。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;什么是JWT？&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://tools.ietf.org/html/rfc7519&quot;&gt;JSON Web Token (JWT)&lt;/a&gt;是一种基于 token 的认证方案。&lt;br&gt;JSON Web Tokens are an open, industry standard &lt;a href=&quot;https://tools.ietf.org/html/rfc7519&quot;&gt;RFC 7519&lt;/a&gt; method for representing claims securely between two parties.&lt;br&gt;简单的说，JWT就是一种Token的编码算法，服务器端负责根据一个密码和算法生成Token，然后发给客户端，客户端只负责后面每次请求都在HTTP header里面带上这个Token，服务器负责验证这个Token是不是合法的，有没有过期等，并可以解析出subject和claim里面的数据。&lt;/p&gt;
&lt;p&gt;注意JWT里面的数据是BASE64编码的，没有加密，因此不要放如敏感数据。&lt;/p&gt;
&lt;p&gt;可以通过&lt;a href=&quot;https://jwt.io/这个网站对JWT&quot;&gt;https://jwt.io/这个网站对JWT&lt;/a&gt; Token进行解析。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何做一场像TED一样精彩的技术演讲</title>
    <link href="http://offbye.com/2016/06/29/%E5%A6%82%E4%BD%95%E5%81%9A%E4%B8%80%E5%9C%BA%E5%83%8FTed%E4%B8%80%E6%A0%B7%E7%B2%BE%E5%BD%A9%E7%9A%84%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/"/>
    <id>http://offbye.com/2016/06/29/如何做一场像Ted一样精彩的技术演讲/</id>
    <published>2016-06-29T01:33:55.000Z</published>
    <updated>2016-07-04T05:44:01.000Z</updated>
    
    <content type="html">&lt;p&gt;最近几个月由于准备演讲的原因，反复看了几遍《像TED一样演讲》这本书，并看了大量的TED演讲，感触颇深，学到了很多演讲的技巧和误区。最近我在南京软件开发者大会和全球移动技术大会做了2场还算精彩的技术演讲，大量应用了书中的一些思想，演讲现场听众的反馈情况还不错。参加技术大会演讲是成为技术大牛的重要道路之一，那么我们怎样才能做一场精彩而不枯燥的技术演讲呢？&lt;/p&gt;
&lt;p&gt;我们先分析下技术演讲和典型的TED演讲的差别。首先是演讲内容和面对的观众不同。技术演讲的内容一般都有一定的技术门槛，很多时候外行是不容易有较深入的理解的，听众有着明显的局限性，一般都是某个领域的技术和业务人员，同时听众的专业能力差别还有比较大的，专家、一般水平和新手的听众人数一般是金字塔分布，因此需要照顾不同水平的人对内容的接受度和想法。TED演讲的观众则比较广泛，演讲需要简洁生动，具备传播属性。然后是演讲时间长度不一样，典型的TED演讲的时间一般是6-18分钟，技术演讲的时间一般是40分钟，因此TED演讲是更困难的，因为你需要在更短的时间内抓住听众的注意力，让听众接受你的观点。技术演讲由于时间相对较长，可以进行一些比较深入的探讨，但是也需要考虑到听众的注意力，需要在演讲过程中想办法活跃气氛。&lt;/p&gt;
&lt;p&gt;接下来我从演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，详细探讨下如何一场精彩的技术演讲。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;首先要有一个好的技术演讲主题，什么是好的主题呢？ 好的主题首先意味着你对这个主题要有热情，要有特别的见解。例如你比多数人更早的关注一门新技术，有热情把它介绍给更多的人；你在某个技术领域有着丰富的实践经验，想和别人分享；你对某个技术领域研究比较深入，做了个开源项目，想让更多的人知道和使用等。一定要挖掘出自己和演讲主题之间独特而有意义的连接点，这样才可以激发自己对演讲主题的热情，然后你才能用热情感染观众。&lt;/p&gt;
&lt;p&gt;演讲主题需要主题明确，范围清晰，逻辑严密。要对演讲的内容保持节制，主题无关的内容不要轻易加入到PPT中。主题不宜太大太宽泛，范围需要清楚明确，最好能做到让人看到题目就能知道大概是讲哪方面的内容。演讲主题太大是新手最容易犯的错误之一，总想做自己演讲中塞入太多的东西，导致主题不明确，没有重点，让人听完后感觉不记得都讲了些什么。&lt;/p&gt;
&lt;p&gt;另外需要注意的是，特别干货的技术内容并不太适合拿来做一场精彩的演讲，更适合作为文章发表。例如现场介绍和推导某个算法，大量复杂代码的讲解等。除非你有高超的演讲技巧，并且台下的观众都很专业，否则很难把这类主题讲精彩。现在的一些技术大会由于观众水平参差不齐，技术背景和经验都不一样，因此太干货的内容并不容易受到多数人的欢迎，反而有催眠效果。&lt;/p&gt;
&lt;p&gt;你对自己的演讲主题必须有深刻地认识，包括涉及的每个技术细节都需要很清楚，这样才能有足够的信心做好演讲，深入浅出地讲出来，也才能比较优雅地面对观众的提问。我参加的每场演讲都会把涉及的每个技术细节都弄清楚，演讲PPT不允许出现任何细节错误，并对观众可能提出的问题进行事先准备。&lt;/p&gt;
&lt;p&gt;定好主题后，需要从观众的角度看待这个主题，也就是换位思考，如果你是观众你会不会想听这个主题？你想从这场演讲了解到些什么？怎样才能引起观众的兴趣，激发观众的共鸣？&lt;/p&gt;
&lt;p&gt;然后可以针对主题做个信息视图了，信息视图就是你演讲内容的层次结构图，一般可以是层次结构图或流程图，相对传统的目录结构，用信息视图可以更好帮你理清演讲的内容逻辑。可以用Powerpoint的SmartArt功能，流程图软件或思维导图软件制作信息视图。在演讲中需要尽早的把信息视图讲给观众，以便让大家对你的演讲有整体的认识，也可以在最后演讲总结时把信息视图总结给大家，我一般是在介绍完演讲主题后就讲解本次演讲的信息视图或目录结构。因为观众基本上都是技术人员，思维逻辑性一般都比较强，因此演讲内容之间需要用强逻辑关联起来，并在演讲过程中注意强调当前演讲的层次，这样能够让人感觉演讲内容很连贯，很有逻辑，也有助于观众保持清晰的思路跟上你的演讲节奏。&lt;/p&gt;
&lt;p&gt;如何做一个好的技术演讲开场，这个需要根据你的主题来定。首先你可以根据演讲主题介绍下自己的背景，要讲和演讲相关的内容，说明你为什么要做这场演讲，为什么由你来给大家讲这个主题。然后可以讲个简单的故事，需要能引起观众的共鸣，拉近和观众的距离。也可以做几个现场互动提问，了解观众的组成情况，活跃现场的气氛，缓解自己的紧张状态。还可以做些适当的安排，留一些后面会解答的悬念。&lt;/p&gt;
&lt;p&gt;下面进入演讲的内容部分了，从TED演讲学来的一个有用的技巧是用好3这个数字，3点内容是最容易让人记住的，例如把观点总结成3个重点，比提出5个以上重点要更容易让人记住，也更有利于传播。PPT上不要放很多文字，TED的建议是一页PPT最多不要超过40个词，对于技术演讲来说，这个限制有时并不适合，例如你需要讲解代码时。但是，我们需要保持PPT的简洁，PPT上放太多内容会让观众更关注读PPT上的文字而不是听你演讲，所以时刻要抵挡把太多文字内容放在PPT上的诱惑，你可以把它们放到演讲者备注里面，然后在PPT上放一张精彩的图片代替，图片可以用关键词在谷歌图片上找，然后演讲时把文字内容讲出来，并和图片建立链接，视觉化的内容更有利于观众记忆。&lt;/p&gt;
&lt;p&gt;关于数据，很多技术演讲都需要用数据证明你的观点。TED演讲介绍的一种专业做法是每张幻灯片只放一个数据，这样更容易让人印象深刻，增强说服力。一页PPT不要放很多数据，可以用各种图表代替数据表。还可以通过对坐标轴做处理强化你的数据对比效果，我记得淘宝的一些技术演讲用过这个方法，但这种小把戏最好不要玩，因为做技术的人一般对数据都挺敏感的。&lt;br&gt;&lt;!-- http://www.offbye.com --&gt;&lt;/p&gt;
&lt;p&gt;接下来讲下时间控制问题。一般TED演讲是6-18分钟，而现在一般技术演讲是45分钟，其中演讲时间是40分钟，最后留五分钟提问时间，因此技术演讲可以讲的更多更深一点。技术演讲同样需要严格控制好时间，一般PPT准备25页左右就差不多了，如果包含动画和快速带过的页面可以适当增加，一般不要超过50页，新手容易犯放太多内容在PPT里面这个错误。参加过那么多次技术大会，我还没有见过提前很多时间讲完PPT的，很多人都是在最后讲不完PPT，在最后五分钟提示时匆匆忙忙地翻后面一半的PPT，然后这场技术演讲基本上就失败了。即使你提前5分钟讲完了，多安排点提问交流时间也就可以了。为了做好时间控制，正式演讲前可以先进行几次小范围的试讲，自己对着镜子讲也可以，还可以用Powerpoint的排练计时功能记录每页演讲的时间，并进行分析。保存排练记时后，Powerpoint在下次演示时可以根据时间自动翻页，但一般不要这样做，这样演讲感觉会不够自然，不好即兴发挥。&lt;/p&gt;
&lt;p&gt;连续讲40分钟技术对观众的注意力是个很大的挑战，除非你讲的特别风趣幽默，但多数技术人员做不到这一点，因此演讲中间安排几次互动环节是很有必要的，例如提问和简单演示，可以帮助观众恢复注意力。注意现场演示是个坑，很容易出状况，需要做好各种预防措施，特别是涉及网络和服务器的要特别注意提前现场测试确认好，演示电脑一定要用自己的，可以有效避免各种演示问题。&lt;/p&gt;
&lt;p&gt;最后总结一下，本文结合《像TED一样演讲》书中介绍的思想和方法，探讨了如何做一场精彩的技术演讲。在演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，提出了一些思路和实践。&lt;/p&gt;
&lt;p&gt;希望各位做技术的同学在未来都能做一场精彩的技术演讲！&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近几个月由于准备演讲的原因，反复看了几遍《像TED一样演讲》这本书，并看了大量的TED演讲，感触颇深，学到了很多演讲的技巧和误区。最近我在南京软件开发者大会和全球移动技术大会做了2场还算精彩的技术演讲，大量应用了书中的一些思想，演讲现场听众的反馈情况还不错。参加技术大会演讲是成为技术大牛的重要道路之一，那么我们怎样才能做一场精彩而不枯燥的技术演讲呢？&lt;/p&gt;
&lt;p&gt;我们先分析下技术演讲和典型的TED演讲的差别。首先是演讲内容和面对的观众不同。技术演讲的内容一般都有一定的技术门槛，很多时候外行是不容易有较深入的理解的，听众有着明显的局限性，一般都是某个领域的技术和业务人员，同时听众的专业能力差别还有比较大的，专家、一般水平和新手的听众人数一般是金字塔分布，因此需要照顾不同水平的人对内容的接受度和想法。TED演讲的观众则比较广泛，演讲需要简洁生动，具备传播属性。然后是演讲时间长度不一样，典型的TED演讲的时间一般是6-18分钟，技术演讲的时间一般是40分钟，因此TED演讲是更困难的，因为你需要在更短的时间内抓住听众的注意力，让听众接受你的观点。技术演讲由于时间相对较长，可以进行一些比较深入的探讨，但是也需要考虑到听众的注意力，需要在演讲过程中想办法活跃气氛。&lt;/p&gt;
&lt;p&gt;接下来我从演讲主题选择，演讲内容设计和PPT制作，如何做个好的开场，如何做好演讲时间控制等方面，详细探讨下如何一场精彩的技术演讲。&lt;br&gt;
    
    </summary>
    
    
      <category term="技术演讲" scheme="http://offbye.com/tags/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/"/>
    
      <category term="TED" scheme="http://offbye.com/tags/TED/"/>
    
      <category term="演讲技巧" scheme="http://offbye.com/tags/%E6%BC%94%E8%AE%B2%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>GMTC2016移动技术大会参会感想</title>
    <link href="http://offbye.com/2016/06/28/GMTC2016%E7%A7%BB%E5%8A%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A%E5%8F%82%E4%BC%9A%E6%84%9F%E6%83%B3/"/>
    <id>http://offbye.com/2016/06/28/GMTC2016移动技术大会参会感想/</id>
    <published>2016-06-28T10:19:43.000Z</published>
    <updated>2016-06-28T10:29:09.000Z</updated>
    
    <content type="html">&lt;p&gt;6月24日参加InfoQ举办的GMTC移动技术大会，并做了一场演讲，还参加了晚上的Swift3.0闭门交流会议，受益很多。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;6月24日上午是全体大会，首先是手机淘宝的长恭，微信的赵原，京东的王永杰做了移动未来开发展望的开场演讲。然后是Facebook早期员工覃超做了Facebook App演进过程的演讲，主要介绍了Facebook App各个版本的技术实现和经验总结，印象比较深的有下面几点：要选择对用户优化的技术而不是对开发团队优化的技术；现在FacebookApp已经是通过appurl scheme跳转的组件化项目，主要是iOS原生技术实现，Facebook已经有1000多iOS工程师，整个项目只有一个codebase，使用Mercurial做版本管理，git已经太卡了,使用Buck编译项目;新技术的接受曲线，到达高潮后会有一个低谷，然后走向正常的发展阶段。&lt;/p&gt;
&lt;p&gt;然后是Square的邵震的演讲Mobile Growth的方法和实践，是近几年流行的增长黑客相关的实践，介绍了Growth实践中的一些心得，最重要的是留存，工程师驱动，通过高层战略推动底层执行。然后介绍了一些A/B Testing系统的实践。Deep Link的趋势和使用，就是通过一些网页链接进入App。&lt;/p&gt;
&lt;p&gt;下午的演讲分三个分会场，我主要参加了Swift分会场和插件化分会场。Swift分会场第一场是傅若愚的Swift函数式编程，函数式编程是个不太容易讲的话题，主要是涉及的概念比较多，这个演讲有比较易懂的方式介绍了函数式编程。&lt;/p&gt;
&lt;p&gt;Swift分会场第二场是我的演讲From Java/Android To Swift iOS，主要是分享Android开发者如何快速上手Swift开发，以及一些Swift项目经验和开源框架，还介绍了Swift3.0的一些新特性，感兴趣的可以下载ppt看看。&lt;/p&gt;
&lt;p&gt;然后去了插件化专场，听林光亮介绍了Small插件化插件，他主要先分析了Android插件化的各种技术和插件化框架，然后介绍了small插件化框架的实现思路和技术实现。﻿这个插件化方案我感觉是目前比较合理的，技术上也比较先进，希望后面项目能用上。&lt;/p&gt;
&lt;p&gt;最后是聚划算的朴诚介绍聚划算的Luaview动态化开发实践，LuaviewSDK提供了一种动态化能力，适合原生App的某些页面嵌入动态内容，性能很好，和React Native，weex等插件化方案比较，是一种更轻量的插件化方案。&lt;/p&gt;
&lt;p&gt;25日上午参加的是架构演进专场，第一场是手机天猫解耦之路，介绍了天猫iOS App演进过程和组件化开发技术，通过BeeHive框架实现解耦依赖，统跳协议解耦界面，印象深刻的是活用了Web服务器的UrlRewrite技术，通过正则表达式Rewrite URL。&lt;/p&gt;
&lt;p&gt;第二场是滴滴李贤辉滴滴iOS组件化优化与实践。介绍了滴滴iOS App组件化的背景，70个开发人员，7条业务线，70万代码。代码冲突多，发布困难。介绍了一些组件化的专项技术，业务线接入，页面结构，导航管理组件，共享地图组件，灰度系统apollo等，干货很多，值得回去仔细研究学习。&lt;/p&gt;
&lt;p&gt;上午第三场是iOS遗留代码重构，从CoreData迁移到Realm说起。﻿介绍了抽象分支的概念，通过抽象层替换旧代码模块。特性开关，4种实现方式，如后台服务，ab test框架。通过适配器模式透明支持CoreData和RealmDB持久化服务。最后介绍了Realm的坑，不支持集联删除，不支持多态，难以理解的反向关联。遗留代码的重构确实是个麻烦的事情，这个演讲对iOS项目的重构有一定参考价值。&lt;/p&gt;
&lt;p&gt;下午参加了性能优化专场，第一场是微信叶润桂的演讲《微信客户端怎样应对弱网络》﻿。前面主要介绍介绍了针对TCP/IP协议的移动网络优化，介绍了各种算法。﻿然后讲解了微信发图片协议合并优化，上传图片后，由图片服务器直接通过内网和业务服务器通信。﻿低成本重传，降低重传的包大小，或使用流式协议。渐进式图片，有损上传和下载。最后安利了后面打算开源的Mars跨平台开源网络组件。&lt;/p&gt;
&lt;p&gt;第二场是杨刚的360手机卫士性能优化之路，首先介绍了性能优化的各种问题，lint和Findbugs，自有代码检测工具，基于jenkins平台的检测系统。AspectJ重写器，实现网络静态埋点的例子。然后介绍了性能监控，进程的冷热启动等。由于360手机卫士总是优化手机杀其他App的进程，这兄弟提问环节被问的比较郁闷。&lt;/p&gt;
&lt;p&gt;最后听的演讲是支付宝App的性能稳定性和运维实践，介绍了支付宝App3个阶段的架构演进，性能优化实践和超级App的运维体系介绍。&lt;/p&gt;
&lt;p&gt;整个大会大概有30多场演讲，很多都是各大公司的实践经验分享，干货很多，对我来说帮助比较大的是安卓的插件化和iOS的组件化开发，由于业务发展需要，这些技术后面需要逐步引入了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;6月24日参加InfoQ举办的GMTC移动技术大会，并做了一场演讲，还参加了晚上的Swift3.0闭门交流会议，受益很多。&lt;/p&gt;
    
    </summary>
    
    
      <category term="GMTC2016" scheme="http://offbye.com/tags/GMTC2016/"/>
    
      <category term="移动技术大会" scheme="http://offbye.com/tags/%E7%A7%BB%E5%8A%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>Mac下配置Docker Kitematic使用Proxy加速镜像下载Swift Kitura镜像</title>
    <link href="http://offbye.com/2016/06/21/Mac%E4%B8%8B%E9%85%8D%E7%BD%AEDocker-Kitematic%E4%BD%BF%E7%94%A8Proxy%E5%8A%A0%E9%80%9F%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6/"/>
    <id>http://offbye.com/2016/06/21/Mac下配置Docker-Kitematic使用Proxy加速镜像下载速度/</id>
    <published>2016-06-21T14:12:51.000Z</published>
    <updated>2016-06-22T07:57:33.000Z</updated>
    
    <content type="html">&lt;p&gt;这几天打算折腾下&lt;a href=&quot;https://github.com/IBM-Swift/Kitura&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;IBM的Swift Kitura&lt;/a&gt;服务器端框架，按照官方的说明下载kitura-ubuntu docker镜像，结果发现实在是太慢了，于是请教了运维龚总，通过设置公司的docker proxy进行加速，速度果然快，几分钟就下载完了，太给力了。当然也可以用Daocloud的代理啊。下面记录下设置过程。&lt;br&gt;kitematic是docker推出的GUI工具，使操作docker的方式变得更简单直观&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;进入到docker-machine&quot;&gt;&lt;a href=&quot;#进入到docker-machine&quot; class=&quot;headerlink&quot; title=&quot;进入到docker machine&quot;&gt;&lt;/a&gt;进入到docker machine&lt;/h2&gt;&lt;p&gt;我们首先进入到docker machine&lt;/p&gt;
&lt;p&gt;确保docker machine已经运行，如果你已经打开了kitematic，docker machine已经是运行状态&lt;br&gt;//若未运行，可以通过kitematic或输入以下命令运行docker-machine&lt;br&gt;&lt;code&gt;docker-machine start default&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;//通过终端进入docker machine&lt;br&gt;&lt;code&gt;docker-machine ssh default&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;//如果看见如下标志则已经进入docker-machine&lt;br&gt;&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;                       &lt;span class=&quot;comment&quot;&gt;##         .&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  &lt;span class=&quot;comment&quot;&gt;## ## ##        ==&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;comment&quot;&gt;## ## ## ## ##    ===&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           /&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;\___/ ===&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      ~~~ &amp;#123;~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  ===- ~~~&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           \______ o           __/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             \    \         __/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              \____\_______/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; _                 _   ____     _            _&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| |__   ___   ___ | |_|___ \ __| | ___   ___| | _____ _ __&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| &#39;_ \ / _ \ / _ \| __| __) / _` |/ _ \ / __| |/ / _ \ &#39;__|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   &amp;lt;  __/ |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|_.__/ \___/ \___/ \__|_____\__,_|\___/ \___|_|\_\___|_|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Boot2Docker version 1.11.0, build HEAD : 32ee7e9 - Wed Apr 13 20:06:49 UTC 2016&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Docker version 1.11.0, build 4dc5990&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docker@default:~$&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;修改boot2docker配置文件&quot;&gt;&lt;a href=&quot;#修改boot2docker配置文件&quot; class=&quot;headerlink&quot; title=&quot;修改boot2docker配置文件&quot;&gt;&lt;/a&gt;修改boot2docker配置文件&lt;/h2&gt;&lt;p&gt;//用vi修改配置文件&lt;br&gt;&lt;code&gt;sudo vi /var/lib/boot2docker/profile&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;//我们在配置文件最后加入两行http及https代理设置&lt;br&gt;export HTTP_PROXY=&lt;a href=&quot;http://192.168.1.102:8118&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://192.168.1.102:8118&lt;/a&gt;&lt;br&gt;export HTTPS_PROXY=&lt;a href=&quot;http://192.168.1.102:8118&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://192.168.1.102:8118&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;重启docker-machine&quot;&gt;&lt;a href=&quot;#重启docker-machine&quot; class=&quot;headerlink&quot; title=&quot;重启docker-machine&quot;&gt;&lt;/a&gt;重启docker-machine&lt;/h2&gt;&lt;p&gt;//重启docker-machine使其生效&lt;br&gt;&lt;code&gt;docker-machine restart default&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;测试代理下载速度&quot;&gt;&lt;a href=&quot;#测试代理下载速度&quot; class=&quot;headerlink&quot; title=&quot;测试代理下载速度&quot;&gt;&lt;/a&gt;测试代理下载速度&lt;/h2&gt;&lt;p&gt;//重新进入到docker-machine&lt;br&gt;&lt;code&gt;docker-machine ssh default&lt;/code&gt;&lt;br&gt;/我们测试pull一个ghost博客的镜像试试看，速度果然快&lt;br&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker@default&lt;span class=&quot;symbol&quot;&gt;:~&lt;/span&gt;$ docker pull kitematic/ghost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Using default &lt;span class=&quot;symbol&quot;&gt;tag:&lt;/span&gt; latest&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;latest:&lt;/span&gt; Pulling from kitematic/ghost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;a3ed95caeb02:&lt;/span&gt; Pull complete&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;f5424ebd796:&lt;/span&gt; Downloading [=======&amp;gt;                                           ] &lt;span class=&quot;number&quot;&gt;5.275&lt;/span&gt; MB/&lt;span class=&quot;number&quot;&gt;37.22&lt;/span&gt; MB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;fb8f734fb80f:&lt;/span&gt; Downloading [==&amp;gt;                                                ] &lt;span class=&quot;number&quot;&gt;3.735&lt;/span&gt; MB/&lt;span class=&quot;number&quot;&gt;78.27&lt;/span&gt; MB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;e97c18a7d689:&lt;/span&gt; Downloading [===&amp;gt;                                               ] &lt;span class=&quot;number&quot;&gt;3.162&lt;/span&gt; MB/&lt;span class=&quot;number&quot;&gt;44.29&lt;/span&gt; MB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;dcf0f0808fac:&lt;/span&gt; Waiting&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;docker pull命令其实和在kitematic中点击create的效果是一样的&lt;/p&gt;
&lt;p&gt;最后展示下kitura框架吧，服务器端的swift啊。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/9a59727af2ad4ded0843ccb3efb9ca1e.png&quot; alt=&quot;IBm Kitura&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这几天打算折腾下&lt;a href=&quot;https://github.com/IBM-Swift/Kitura&quot;&gt;IBM的Swift Kitura&lt;/a&gt;服务器端框架，按照官方的说明下载kitura-ubuntu docker镜像，结果发现实在是太慢了，于是请教了运维龚总，通过设置公司的docker proxy进行加速，速度果然快，几分钟就下载完了，太给力了。当然也可以用Daocloud的代理啊。下面记录下设置过程。&lt;br&gt;kitematic是docker推出的GUI工具，使操作docker的方式变得更简单直观&lt;br&gt;
    
    </summary>
    
    
      <category term="Mac" scheme="http://offbye.com/tags/Mac/"/>
    
      <category term="Docker" scheme="http://offbye.com/tags/Docker/"/>
    
      <category term="Kitematic" scheme="http://offbye.com/tags/Kitematic/"/>
    
      <category term="proxy" scheme="http://offbye.com/tags/proxy/"/>
    
      <category term="Swift" scheme="http://offbye.com/tags/Swift/"/>
    
      <category term="Kitura" scheme="http://offbye.com/tags/Kitura/"/>
    
  </entry>
  
  <entry>
    <title>初探Swift 3.0的重大变化</title>
    <link href="http://offbye.com/2016/06/18/%E5%88%9D%E6%8E%A2Swift-3-0/"/>
    <id>http://offbye.com/2016/06/18/初探Swift-3-0/</id>
    <published>2016-06-18T14:10:27.000Z</published>
    <updated>2016-06-22T06:56:51.000Z</updated>
    
    <content type="html">&lt;p&gt;这个周末抽空看了WWDC2016关于Swift 3.0的的演讲视频，初步感受了下Swift3.0，Swift3.0相对Swift2.2有很大的变化。&lt;br&gt;比较重要的演讲是Swift API Design Guidelines和What is new in Swift。Swift3.0的Swift的第3个主要版本，目标是安全，快速和有表现力，也是第一个有开源社区参与开发的Swift版本。由于语法和API改动比较多，Xcode 8.0 Beta提供了migrate迁移工具。这样自有的代码升级Swift3.0就比较方便了，但是，关键是要等第三方开源库升级到Swift3.0啊。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/03b109dff53efac1cc108602e1bba9e8.png&quot; alt=&quot;Swift3.0 Preview 1 Released&quot;&gt;&lt;/p&gt;
&lt;p&gt;Swift3.0的路线图主要是下面3点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Swift API Design Guidelines&lt;/li&gt;
&lt;li&gt;The Grand Renaming&lt;/li&gt;
&lt;li&gt;Mapping Objective-C APIs into Swift&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;主要目标是明确语言的设计理念，提出了Swifty的概念。以前提出ABI stability（二进制接口稳定）被推迟实现了。&lt;/p&gt;
&lt;p&gt;以前从Objective-C移植过来的那些繁琐的函数名终于在Swift3.0中被去掉了，这真是一个好消息，早就受不了那种OC风格的繁琐冗余的函数名了。&lt;br&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/00d5f39c6c11a8a04b04092ba5d18a41.png&quot; alt=&quot;old NSURL&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/9b8761c536ad846058d6b42b41bd2a89.png&quot; alt=&quot;swift 3.0 URL&quot;&gt;&lt;br&gt;可以看到Swift3.0不仅简化了方法名，还提供了一个NSURL的替代URL。&lt;/p&gt;
&lt;p&gt;Swift API的设计原则主要有下面三点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Clarityat the Point of use  is your most important goal&lt;br&gt;最重要的目标是清晰明确&lt;/li&gt;
&lt;li&gt;Clarity is more important than brevity&lt;br&gt;明确重于简洁&lt;/li&gt;
&lt;li&gt;Concise Code is consequence of using contextual cues&lt;br&gt;简洁的代码是使用上下文线索的结果&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;总之，Swift3.0的这次升级变化还是挺大的，语法更加明确和简洁，以前Objective-C那些繁琐的方法名也被替代了，在开源社区的帮助下，向着现代化跨平台通用编程语言的目标又近了一大步。&lt;/p&gt;
&lt;p&gt;最后值得一提的是IBM在Swift服务端的工作，发布了IBM Swift Sandbox，就是个基于Swift3.0 linux版本的在线Playground。IBM还发布了一个基于Swift的类似Node.js Express框架的Web开发和服务器框架Kitura。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/5eecc83f841d72a8547ab9f757d3b69a.png&quot; alt=&quot;swift sandbox&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这个周末抽空看了WWDC2016关于Swift 3.0的的演讲视频，初步感受了下Swift3.0，Swift3.0相对Swift2.2有很大的变化。&lt;br&gt;比较重要的演讲是Swift API Design Guidelines和What is new in Swift。Swift3.0的Swift的第3个主要版本，目标是安全，快速和有表现力，也是第一个有开源社区参与开发的Swift版本。由于语法和API改动比较多，Xcode 8.0 Beta提供了migrate迁移工具。这样自有的代码升级Swift3.0就比较方便了，但是，关键是要等第三方开源库升级到Swift3.0啊。&lt;br&gt;
    
    </summary>
    
    
      <category term="Swift 3.0" scheme="http://offbye.com/tags/Swift-3-0/"/>
    
      <category term="API" scheme="http://offbye.com/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>怎样高效统计Android开源库的方法数</title>
    <link href="http://offbye.com/2016/06/13/%E6%80%8E%E6%A0%B7%E9%AB%98%E6%95%88%E7%BB%9F%E8%AE%A1Android%E5%BC%80%E6%BA%90%E5%BA%93%E7%9A%84%E6%96%B9%E6%B3%95%E6%95%B0/"/>
    <id>http://offbye.com/2016/06/13/怎样高效统计Android开源库的方法数/</id>
    <published>2016-06-13T11:36:11.000Z</published>
    <updated>2016-06-13T09:31:48.000Z</updated>
    
    <content type="html">&lt;p&gt;大家都知道， Android App一直有65k方法数的问题，当然我们可以用multidex的各种方法解决，就是比较麻烦。一般方法数超过65K的原因是引入了太多第三方开源库的原因，那么我们怎么才能知道哪些开源库占用了多少方法呢？以便可以有针对性的减少方法数。&lt;/p&gt;
&lt;p&gt;今天发现Android Studio有个插件&lt;a href=&quot;http://plugins.jetbrains.com/plugin/8076?pr=androidstudio&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Methods Count&lt;/a&gt;很好的做了这个事情，赞一个啊。直接在Android Studio搜索插件名字并安装，重启Android Studio后打开build.gradle文件，等待一会就可以看各个第三方库的方法数了。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如下图&lt;br&gt;&lt;img src=&quot;http://www.methodscount.com/images/methods-count-plugin-2.png&quot; alt=&quot;method count&quot;&gt;&lt;/p&gt;
&lt;p&gt;点击页面右边的蓝色圆圈可以跳到网站&lt;a href=&quot;http://www.methodscount.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.methodscount.com/&lt;/a&gt; 查询开源库及其依赖的库的方法数详情。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/5f1cb177b7f2b434bf80f056f526d8d7.png&quot; alt=&quot;methodscountdetail&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果有人已经查过了某个版本的开源库，网站会缓存结果，立即就会给出结果；没有查过则网站会去分析开源库，并算出方法数，这个过程可能需要等待几分钟。网页给出了方法数统计，依赖的库， 还可以以图表形式展示开源库各个版本的方法数和Dex文件Size变化情况。&lt;br&gt;知道了第三方开源库的方法数，就可以有针对性的对方法数进行优化了。&lt;br&gt;￼￼&lt;/p&gt;
&lt;p&gt;[本文独立博客地址](&lt;a href=&quot;http://www.offbye.com）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.offbye.com）&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;大家都知道， Android App一直有65k方法数的问题，当然我们可以用multidex的各种方法解决，就是比较麻烦。一般方法数超过65K的原因是引入了太多第三方开源库的原因，那么我们怎么才能知道哪些开源库占用了多少方法呢？以便可以有针对性的减少方法数。&lt;/p&gt;
&lt;p&gt;今天发现Android Studio有个插件&lt;a href=&quot;http://plugins.jetbrains.com/plugin/8076?pr=androidstudio&quot;&gt;Android Methods Count&lt;/a&gt;很好的做了这个事情，赞一个啊。直接在Android Studio搜索插件名字并安装，重启Android Studio后打开build.gradle文件，等待一会就可以看各个第三方库的方法数了。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://offbye.com/tags/Android/"/>
    
      <category term="方法数" scheme="http://offbye.com/tags/%E6%96%B9%E6%B3%95%E6%95%B0/"/>
    
      <category term="统计" scheme="http://offbye.com/tags/%E7%BB%9F%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>从共享经济的边界看专车市场的未来</title>
    <link href="http://offbye.com/2016/06/10/%E4%BB%8E%E5%85%B1%E4%BA%AB%E7%BB%8F%E6%B5%8E%E7%9A%84%E8%BE%B9%E7%95%8C%E7%9C%8B%E4%B8%93%E8%BD%A6%E5%B8%82%E5%9C%BA%E7%9A%84%E6%9C%AA%E6%9D%A5/"/>
    <id>http://offbye.com/2016/06/10/从共享经济的边界看专车市场的未来/</id>
    <published>2016-06-10T01:57:51.000Z</published>
    <updated>2016-06-13T09:28:47.000Z</updated>
    
    <content type="html">&lt;p&gt;作为一个懒散的业余顺风车司机，最近经常收到专车平台关于突发情况的短信提醒，听说南京出租车司机和专车司机最近有些冲突，原因当然是出租车司机认为专车司机抢了生意，而自己还需要承担每个月七千以上的份子钱，心里当然不爽了。但是，专车不是分享经济吗？只是顺路接单啊，怎么会对出租车的生意造成这么严重的影响呢？原因之一可能是大多数专车司机已经是职业化了，并且感觉司机平台的多单奖励制度也鼓励了专车的职业化行为，需要上班的顺风车肯定不可能在早高峰去接很多单啊，拼车等人，绕路都要花时间，上班迟到是要罚钱的，但职业司机就没有这个问题了。&lt;/p&gt;
&lt;p&gt;专车市场到底会怎样发展呢？我认为后面专车的车辆产权会由租车公司和出行平台共同拥有；专车司机会职业化，和平台签劳动协议，并经过专业化培训；专车会在交通部门的严格监管下运营；做专车司机的门槛将逐步提高，私家车司机将逐步推出专车行列。对于传统出租车行业来说，未来可能在某些城市被出行平台收编，当然中间肯定需要经过各方的利益博弈。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;分享经济的核心是资源的按需分配，既合理调配又极大化利用闲置资源，毫无疑问，只有在移动互联网时代，供需信息借助技术手段实现透明，共享经济的模式才有可能真正运行起来。因此，在租房领域诞生了Airbnb,在出行领域出现了Uber和滴滴这些互联网独角兽公司。 这些平台的出现，确实给人们带来了极大的便利，解决了供需信息的不对称性和闲置资源的分配问题，但同时也带来了一些新问题，对传统行业的冲击，安全问题和监管问题等。&lt;/p&gt;
&lt;p&gt;分享经济的优势是盘活闲置的社会资源，提供给更多需要的人，同时获取一定的报酬。但共享经济显然是存在边界的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;知名 IT 评论人 Keso 在《分享经济的边界》一文中表达了其对分享经济的看法。他认为，“两方面的因素综合作用，将导致分享经济很快就抵达它的边界。其一是受益于分享经济，越来越多的人会更愿意购买资源的使用权，而不是购买资源的所有权，这将导致不再有可供分享的物质资源；其二是人的趋利性导致职业化服务提供将逐渐挤出业余化服务提供，谋生者挤出分享者，在此过程中不断降低成本以最大化收益。”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;分享经济的边界看上去还是很有道理的。由分享经济的边界，我联想到了科斯的企业的边界。经济学家科斯提出了著名的科斯定理，我们也可以试着用它来分析一下拼车这种共享经济。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;科斯定理(Coase theorem)由罗纳德·科斯（Ronald Coase）提出的一种观点，认为在某些条件下，经济的外部性或曰非效率可以通过当事人的谈判而得到纠正，从而达到社会效益最大化。科斯本人从未将定理写成文字，而其他人如果试图将科斯定理写成文字，则无法避免表达偏差。关于科斯定理，比较流行的说法是：只要财产权是明确的，并且交易成本为零或者很小，那么，无论在开始时将财产权赋予谁，市场均衡的最终结果都是有效率的，实现资源配置的帕雷托最优。&lt;br&gt;科斯认为，企业规模的边界就在企业内部组织一项交易费用的成本等于通过市场开展这项交易的成本之处。所以，企业有扩张的倾向，直至达到这个边界。另一方面，科技和管理的的的提升，有助于降低交易费用，也就是扩大企业的边界。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对于没有学习过经济学的人来说，上面这段话可能有些抽象，简单来说只要财产权是明确的，并且交易成本为零或者很小，那么，无论在开始时将财产权赋予谁，市场均衡的最终结果都是有效率的。如果我们从这个角度来看共享经济，如果打车的成本足够低，车辆由谁拥有，并不影响最终的出行效率。但是。实际情况不是这样的，对私家车司机来说，做顺风车交易成本还是比较高的，比较典型的是等待成本和绕路成本，还有可能的安全成本，由于拉客带来的负面情绪成本等。&lt;/p&gt;
&lt;p&gt;先说下等待成本和绕路成本。目前滴滴司机端的推荐算法还只能做到基于附近位置的订单推荐，对于要上班的业余司机来说，这样是远远不够的，首先我不可能掉头去接后面的乘客，也不愿意绕路去接不怎么顺路的乘客，更不可能放着高速公路不走，走城市道路去接中途的乘客，这些事情都会导致上班迟到被罚钱，滴滴并没有给这些业余司机提供激励政策，而是对派单完成率进行考核和惩罚，对于职业专车司机，上面这些问题都不影响，因为他们不用担心上班迟到。并且，滴滴经常有连环奖励活动，早高峰联系完成5单以上，每单都有5元以上的额外奖励，这个奖励估计只有职业专车司机才能拿到。由于企业和个人追逐利润的动机，职业专车司机必然会把业余司机挤出市场，并影响到传统出租车司机的生意。最后留下的业余司机，可能已经不再是为了赚点油费做顺风车的普通司机，而是那些不为赚钱，有其他动机的司机，例如开着保时捷为了搭讪美女而做专车的司机，但各大公司门口拼车挖人的猎头司机等。这就出现了劣币驱逐良币的现象。&lt;/p&gt;
&lt;p&gt;当专车平台上出现了这些有其它动机的司机后，乘客的安全和隐私方面就会出现问题，最近经常爆出的专车司机性骚扰事件也证明了这一点。当然我们可以把责任推给不良司机，毕竟平台只是提供了出行信息，并且对车辆和司机身份进行了还算完善的线上认证，但这个约束是相对于传统出租车行业是非常脆弱的，一些居心不良的司机可以有一万种方法绕过平台的监管。&lt;/p&gt;
&lt;p&gt;从业余司机角度看，自己花钱买车主要是为了使用方便和面子，也就是出行的便利性和私密性。由于大量职业化专车司机的存在，必然会提高乘客对司机服务的期望。人性是自私的，在做过几次顺风车司机后尝鲜后，不太缺钱的业余司机很难再忍受一些挑剔的乘客，于是也就不再做顺风车了。很多人会说做顺风车是为了找人聊天，但拼车聊天实在是个弱需求，特别是在早高峰急着上班赶路的时候，司机在开车的时候聊天也会带来驾驶安全问题。&lt;/p&gt;
&lt;p&gt;上面分析了为什么职业司机会占据打车平台，业余司机会从逐渐从打车平台退出。下面看下专车司机职业化的带来的问题。首先是专车司机的进入门槛太低，导致司机鱼龙混杂，出现各种安全，监管和与传统出租车司机的利益冲突问题。出租车其实是个入门门槛挺低的行业，这年头谁不会开车啊。份子钱就是出租车司机上缴给出租车公司的承包费用，既是前者的主要运营成本，又是后者的主要收入来源。份子钱的存在就是为了提供这个行业的准入门槛，避免非法营运车辆对城市道路的多度占用，同时对出租车司机提供一些服务和管理。由于出租车司机承担了每月6千以上份子钱，而职业化专车司机并不承担份子钱，却同样进行营运，必然严重影响出租车司机的收入，导致出租车司机不满，各地不断出现出租车司机和专车司机的社会冲突。&lt;/p&gt;
&lt;p&gt;现在的问题是专车司机已经在事实上职业化了，但并没有真正职业化管理起来，打车平台对专车司机管理还停留在身份认证和平台规定约束层面，没有劳动协议，保证金，份子钱，准入培训等更加职业化的管理方法，导致很多问题出现。在职业化运营这点上，神州专车的重运营模式做的挺好，这应该是打车平台的未来发展趋势。&lt;/p&gt;
&lt;p&gt;总结一下，由于经济上的原因，专车司机会逐渐职业化，业余司机会逐渐被挤出市场，为了解决专车司机职业化带来的一系列问题，由此发展到职业化管理阶段，也就是类似神州专车的B2C重运营模式。在分享经济层面，出行平台解决的是出行信息的不对称性问题，重点是通过移动互联网更有效率地达成出行交易，而不是对车辆资源的分享。在更远的未来，随着大数据和人工智能的发展，自动驾驶技术发展成熟，专车将不再需要司机，实现智能化共享交通网络。目前特斯拉电动车的Autopilot自动驾驶技术已经初步可用了。&lt;/p&gt;
&lt;p&gt;参考文章&lt;br&gt;&lt;a href=&quot;http://36kr.com/p/5047748.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;如果说“共享经济”是伪命题，那么“专车模式”怎样才靠谱？&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;作为一个懒散的业余顺风车司机，最近经常收到专车平台关于突发情况的短信提醒，听说南京出租车司机和专车司机最近有些冲突，原因当然是出租车司机认为专车司机抢了生意，而自己还需要承担每个月七千以上的份子钱，心里当然不爽了。但是，专车不是分享经济吗？只是顺路接单啊，怎么会对出租车的生意造成这么严重的影响呢？原因之一可能是大多数专车司机已经是职业化了，并且感觉司机平台的多单奖励制度也鼓励了专车的职业化行为，需要上班的顺风车肯定不可能在早高峰去接很多单啊，拼车等人，绕路都要花时间，上班迟到是要罚钱的，但职业司机就没有这个问题了。&lt;/p&gt;
&lt;p&gt;专车市场到底会怎样发展呢？我认为后面专车的车辆产权会由租车公司和出行平台共同拥有；专车司机会职业化，和平台签劳动协议，并经过专业化培训；专车会在交通部门的严格监管下运营；做专车司机的门槛将逐步提高，私家车司机将逐步推出专车行列。对于传统出租车行业来说，未来可能在某些城市被出行平台收编，当然中间肯定需要经过各方的利益博弈。&lt;/p&gt;
    
    </summary>
    
    
      <category term="分享经济" scheme="http://offbye.com/tags/%E5%88%86%E4%BA%AB%E7%BB%8F%E6%B5%8E/"/>
    
      <category term="专车" scheme="http://offbye.com/tags/%E4%B8%93%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>读采铜的精进-如何成为一个很厉害的人有感</title>
    <link href="http://offbye.com/2016/06/09/%E8%AF%BB%E9%87%87%E9%93%9C%E7%9A%84%E7%B2%BE%E8%BF%9B-%E5%A6%82%E4%BD%95%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%BE%88%E5%8E%89%E5%AE%B3%E7%9A%84%E4%BA%BA%E6%9C%89%E6%84%9F/"/>
    <id>http://offbye.com/2016/06/09/读采铜的精进-如何成为一个很厉害的人有感/</id>
    <published>2016-06-09T14:22:49.000Z</published>
    <updated>2016-06-11T03:12:01.000Z</updated>
    
    <content type="html">&lt;p&gt;采铜的《精进-如何成为一个很厉害的人》确实是一本很好的书，我这个一般情况只在kindle上买书看书的人，在简书上看到这本书的介绍后，感觉非常不错，内容和观点比较适合我现在的状态，于是马上在亚马逊上下单买了一本。现在过去快2周了，大概看完一大半了，好书要慢慢读啊，先写篇读后感总结一下吧，免得后面忘记了。看书是一种输入，写出读书笔记是输出，要把时间放在输出型兴趣上，这是书中的一个观点。以后我每读完一本书都会写篇读书笔记，喜欢大家监督啊。&lt;br&gt;写读书笔记时才发现自己看书的一个严重问题，看完后不记得书的目录结构，只记得一些感兴趣的观点，很多没有共鸣的观点，因为没有掌握书的结构，以后肯定也不会有印象。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;在这本书中，作者采铜提出了一种更有效的提升自我的方法：用持续精确的努力，撬动更大的可能，这便是精进。&lt;br&gt;这本书为大家提供了时间、选择、行动、学习、思维、才能、成功七个方面的精进路径，只要依循书中的方法反复磨练，便可以日益精进，成为一个很厉害的人，找到实现自我的那条成功之道。&lt;br&gt;看上去挺美的啊，但是为什么厉害的人还是很少呢？ 其实道理非常简单，知道不等于能够做到。有了方法，真正达成目标还是需要持续地努力和付出。希望这本书能够让我们的努力更有效果。下面书的目录：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;目录  · · · · · ·&lt;br&gt;第一章    时间之尺&lt;br&gt;——我们应该怎样对待时间&lt;br&gt;一、    活在“全部的现在”&lt;br&gt;（从当下出发，联结过去与未来）&lt;br&gt;二、    对五年后的自己提问&lt;br&gt;（如何解决远期与近期未来的冲突？）&lt;br&gt;三、    我们总是在重复地抓起沙子&lt;br&gt;（把时间花在值得做的事情上）&lt;br&gt;四、    “快”与“慢”的自由切换&lt;br&gt;（为什么我们的时间永远不够用？）&lt;br&gt;第二章    寻找心中的“巴拿马”&lt;br&gt;——如何做出比好更好的选择&lt;br&gt;一、    从终极问题出发&lt;br&gt;（以人生终极目标作为首要原则）&lt;br&gt;二、    逃离隐含假设的牢笼&lt;br&gt;（发现人生中的更多可能选项）&lt;br&gt;三、    克服天性中的选择弱势&lt;br&gt;（选择太多怎么办？）&lt;br&gt;四、    人生是持续而反复的构造&lt;br&gt;（校正选择，做出建设性的改变）&lt;br&gt;第三章    即刻行动&lt;br&gt;——改变一切的核心力量&lt;br&gt;一、    “现在”就是恰当的时机&lt;br&gt;（不管怎样，只要开始就好）&lt;br&gt;二、    精益创业的行动启示&lt;br&gt;（把“未完成”变成“已完成” ）&lt;br&gt;三、    像Photoshop一样分解任务&lt;br&gt;（从工作的核心区开始）&lt;br&gt;四 、 三行而后思&lt;br&gt;（在实践中，通过复盘积累智慧）&lt;br&gt;第四章    怎样的学习，才能够直面现实？&lt;br&gt;——如何成为一个高段位的学习者？&lt;br&gt;一、    找到一切学习的向导&lt;br&gt;（好的学习者，首先要向自己提问）&lt;br&gt;二、    不要只做信息的搬运工&lt;br&gt;（通过解码，深入事物的深层）&lt;br&gt;三、    技能，才是学习的终点&lt;br&gt;（你能够调用的知识有多少？）&lt;br&gt;四、    分离的知识，难以解答真正的现实&lt;br&gt;（让不同的知识发生化学作用）&lt;br&gt;第五章    向未知的无限逼近&lt;br&gt;——修炼思维，成为真正的利器&lt;br&gt;一、    大脑需要“断舍离”&lt;br&gt;（ 简化，是清晰思考的前提 ）&lt;br&gt;二、    迎接“灵光乍现”的时刻&lt;br&gt;（让潜意识为你工作）&lt;br&gt;三、    思考可以有自己的形状&lt;br&gt;（将思维转化为图像 ）&lt;br&gt;四、    世界上没有轻而易举的答案&lt;br&gt;（只有极少数的人能做到周密思考）&lt;br&gt;第六章 努力，是一种需要学习的才能&lt;br&gt;——不断优化你的“努力”方式&lt;br&gt;一、    努力本身就是一种才能&lt;br&gt;（努力需要有效的策略）&lt;br&gt;二、    没有突出的长板就是危险&lt;br&gt;（专注发展自己的优势才能）&lt;br&gt;三、    你是“差不多先生”吗？&lt;br&gt;（绝不苟且，才能做到极致 ）&lt;br&gt;四、    挑战是设计出来的&lt;br&gt;（不断为自己设计“必要的难度”挑战 ）&lt;br&gt;五、    不痛苦地坚持到底&lt;br&gt;（只有深入下去，才能培养起真正的兴趣）&lt;br&gt;第七章 每一个成功者，都是唯一的&lt;br&gt;——创造成功，而不是复制成功&lt;br&gt;一、    “学渣”与“学霸”都不是好选择&lt;br&gt;（做一个主动探索的学习者）&lt;br&gt;二、    从“游乐场”到“荒野求生”&lt;br&gt;（怎样从大学走向社会？）&lt;br&gt;三、    独特性，就是你的核心竞争力&lt;br&gt;（ 请坚持你的与众不同！ ）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;第一章是时间之尺-我们应该怎样对待时间&quot;&gt;&lt;a href=&quot;#第一章是时间之尺-我们应该怎样对待时间&quot; class=&quot;headerlink&quot; title=&quot;第一章是时间之尺 我们应该怎样对待时间&quot;&gt;&lt;/a&gt;第一章是时间之尺 我们应该怎样对待时间&lt;/h2&gt;&lt;p&gt;一个人如何对待他的时间，决定了他可以成为什么样的人。首先讲了要活在当下，要专注做好当前的事情，不要过去追悔，为未来焦虑。这是我们应该有的人生态度，用曾国藩的话说就是“当读书，则读书，心无着于见客也；当见客，则见客，心无着于读书也。一有着，则私也。灵明无着，物来顺应，未来不迎，当时不杂，既过不恋。”&lt;/p&gt;
&lt;p&gt;向孩子学习“郑重“的态度，我有一个5岁的女儿，她每天晚上9点左右都画画，其实就是随便涂鸦了，但她真的是很专注，画画的时候从来不三心二意，被打扰了她会不开心，画完后你问她画了什么，她会很认真地讲给你听，尽管画看上去一点都不像。我发现很多大人在专注当下这方面还真的应该想孩子学习，总是自以外高效率，同时做几件事情。记起一个关于活在当下的小故事：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一个小和尚问得道的师傅：“您得道前后有没有什么变化？”老和尚说：“变化很大。”那到底有什么变化呢，老和尚告诉小和尚：“在得道之前，我每天砍柴、挑水、做饭。得道之后，我每天砍柴、挑水、做饭。”小和尚不理解：“师傅，这不是一样吗？”老和尚说：“不一样，在得道之前，我每天砍柴的时候想着挑水，挑水的时候想着做饭，做饭的时候又想着砍柴。得道之后，我每天砍柴的时候只想着砍柴，挑水的时候只想着挑水，做饭的时候只想着做饭。”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;专注当下确实能让我在生活中保持平和的心态，保持客观的态度，不把自己的节奏弄乱。&lt;/p&gt;
&lt;p&gt;然后介绍了时间的视角： 积极过去视角，消极过去视角，享乐主义视角，宿命论视角和未来视角。我用这套方法检讨了一下自己，发现我这几年总是在消极过去视角和未来视角之间切换：有时会后悔自己错失了太多机会，导致情绪很低落；有时又一直想着未来的事情，对未来报太多希望，以至于影响到现在的状态。斯坦福大学心理学家津巴多的建议是不要维持单一的时间视角，我以后要注意采用享乐主义视角和积极过去视角调整状态。&lt;/p&gt;
&lt;p&gt;对五年后的自己提问，如何解决远期未来和近期未来的冲突？&lt;/p&gt;
&lt;p&gt;对于人生计划而言，五年确实是一个合适的时间，读完大学需要四年，多数工作从新手到熟手甚至专家五年时间也够了。在我从事的互联网行业，五年时间足够诞生一个互联网巨头公司了，也足够淘汰或兴起一种编程语言或技术平台。发现五年前的自己，确实没有想清楚五年后要做什么，对未来的期望太高了，这是应该是现在没有达到应有的高度的一个重要原因，所幸随着年龄的增长，对自己的认识越来越清楚了，五年后的人生状态也基本上有头绪了。&lt;br&gt;五年设想可以让我们用情景化，具象化的方式来构想远期未来，使未来鲜活生动起来，这样就有利于去实施。由于五年的时间跨度足够长，我们就不会把可行性，便利性作为主要判断依据，而是从长期价值出发。&lt;br&gt;解决远期未来和近期未来的冲突可以采用两个策略：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使远期未来的目标更加具体化、情境化和可实施&lt;/li&gt;
&lt;li&gt;降低近期未来中的“非期望行为“的便利性，主动增加挑战的难度&lt;br&gt;比如如果总是想玩游戏，就把游戏删除掉，虽然你后面还会下载回来玩，但由于玩游戏的成本提高了，玩的次数是能够显著减少的。我在大学里曾经这样做过，记得当时为了考研，反复删除了很多次魔兽冰封王座游戏，还是很有效果的。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我们总是在重复地抓起沙子，把时间花在值得做的事情上。&lt;br&gt;什么是值得做的事情？作者提供了2个角度：一个是当下给我带来的收益大小，二是收益随时间衰减的程度，作者称为“收益半衰期“。收益半衰期是让我的印象深刻的一个词。要多做收益半衰期长的事情，而不要太在意当前收益的大小。对我来说，写技术博客，写文章，参加开源项目，做技术演讲这些事情的收益半衰期都是比较长的，要坚持去做好。&lt;br&gt;作者给出一个长半衰期事件指南。收益半衰期是一个有效的思维工具，就像一把时间之尺，可以丈量出有长远价值的事物。&lt;br&gt;第一章最后作者提到了为什么要多读经典和互联网时代的信息碎片化问题，用时间之尺的方法，可以有效的过滤掉噪音信息。&lt;/p&gt;
&lt;h2 id=&quot;第二章-寻找心中的“巴拿马“-如何做出比好更好的选择&quot;&gt;&lt;a href=&quot;#第二章-寻找心中的“巴拿马“-如何做出比好更好的选择&quot; class=&quot;headerlink&quot; title=&quot;第二章 寻找心中的“巴拿马“ 如何做出比好更好的选择&quot;&gt;&lt;/a&gt;第二章 寻找心中的“巴拿马“ 如何做出比好更好的选择&lt;/h2&gt;&lt;p&gt;[本文独立博客地址](）&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;采铜的《精进-如何成为一个很厉害的人》确实是一本很好的书，我这个一般情况只在kindle上买书看书的人，在简书上看到这本书的介绍后，感觉非常不错，内容和观点比较适合我现在的状态，于是马上在亚马逊上下单买了一本。现在过去快2周了，大概看完一大半了，好书要慢慢读啊，先写篇读后感总结一下吧，免得后面忘记了。看书是一种输入，写出读书笔记是输出，要把时间放在输出型兴趣上，这是书中的一个观点。以后我每读完一本书都会写篇读书笔记，喜欢大家监督啊。&lt;br&gt;写读书笔记时才发现自己看书的一个严重问题，看完后不记得书的目录结构，只记得一些感兴趣的观点，很多没有共鸣的观点，因为没有掌握书的结构，以后肯定也不会有印象。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Facebook F8App-ReactNative项目源码分析5-iOS篇</title>
    <link href="http://offbye.com/2016/06/08/Facebook-F8App-ReactNative%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%905-iOS%E7%AF%87/"/>
    <id>http://offbye.com/2016/06/08/Facebook-F8App-ReactNative项目源码分析5-iOS篇/</id>
    <published>2016-06-08T13:07:46.000Z</published>
    <updated>2016-06-08T06:56:55.000Z</updated>
    
    <content type="html">&lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;本文分析f8app iOS代码的结构和技术实现，阅读本文的前提是对React Native和iOS开发有一定的了解。&lt;br&gt;f8app ios项目使用了CocosPod管理模块，现在RN的最新版本创建的项目默认已经不再使用CocosPods了,直接通过工程引用。f8app还是用了CocosPod，因此我们首先需要在ios目录下运行&lt;code&gt;pod install&lt;/code&gt;，安装好依赖的项目，然后用Xcode打开F8v2.xcworkspace工作空间，注意不是打开F8v2.xcodeproj工程文件，我经常犯这个错误，实在不喜欢用CocosPods啊。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;iOS-f8app效果展示&quot;&gt;&lt;a href=&quot;#iOS-f8app效果展示&quot; class=&quot;headerlink&quot; title=&quot;iOS f8app效果展示&quot;&gt;&lt;/a&gt;iOS f8app效果展示&lt;/h2&gt;&lt;p&gt;先看下效果吧，在iOS模拟器上动效还是很好的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/f8a.gif&quot; alt=&quot;f8appiOS&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;ios工程结构&quot;&gt;&lt;a href=&quot;#ios工程结构&quot; class=&quot;headerlink&quot; title=&quot;ios工程结构&quot;&gt;&lt;/a&gt;ios工程结构&lt;/h2&gt;&lt;p&gt;首先还是先看下ios工程的结构：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Default-568h@2x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8Scrolling.h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8Scrolling.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8v2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── AppDelegate.h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── AppDelegate.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Base.lproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── LaunchScreen.xib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Images.xcassets&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── AppIcon.appiconset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── AppIcon@2x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── AppIcon@3x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── Contents.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── Contents.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Info.plist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── main.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8v2.xcodeproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8v2.xcworkspace&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8v2Tests&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── Info.plist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── PodFile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Podfile.lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Pods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Bolts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── Bolts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── Common&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── iOS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── LICENSE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── README.md&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── LICENSE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── README.mdown&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── LICENSE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── README.mdown&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── LICENSE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── README.mdown&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Headers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── Private&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── Bolts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── CodePush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── React&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── react-native-fbsdkcore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   ├── react-native-fbsdklogin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── react-native-fbsdkshare&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── Public&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── Bolts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── CodePush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── React&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── react-native-fbsdkcore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       ├── react-native-fbsdklogin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │       └── react-native-fbsdkshare&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Local\ Podspecs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── CodePush.podspec.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── React.podspec.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── react-native-fbsdkcore.podspec.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── react-native-fbsdklogin.podspec.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── react-native-fbsdkshare.podspec.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Manifest.lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Pods.xcodeproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── project.pbxproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── xcshareddata&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   │   └── xcschemes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── Target\ Support\ Files&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── Bolts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Bolts-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Bolts-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── Bolts.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── CodePush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── CodePush-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── CodePush-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── CodePush.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── FBSDKCoreKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKCoreKit-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKCoreKit-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── FBSDKCoreKit.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── FBSDKLoginKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKLoginKit-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKLoginKit-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── FBSDKLoginKit.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── FBSDKShareKit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKShareKit-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── FBSDKShareKit-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── FBSDKShareKit.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── Pods-F8v2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2-acknowledgements.markdown&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2-acknowledgements.plist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2-frameworks.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2-resources.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── Pods-F8v2.debug.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── Pods-F8v2.release.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── React&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── React-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── React-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── React.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── react-native-fbsdkcore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── react-native-fbsdkcore-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── react-native-fbsdkcore-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── react-native-fbsdkcore.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── react-native-fbsdklogin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── react-native-fbsdklogin-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   ├── react-native-fbsdklogin-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       │   └── react-native-fbsdklogin.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       └── react-native-fbsdkshare&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           ├── react-native-fbsdkshare-dummy.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           ├── react-native-fbsdkshare-prefix.pch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           └── react-native-fbsdkshare.xcconfig&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Settings.bundle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── About.plist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Root.plist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── en.lproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       └── Root.strings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Splash@2x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── build&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;PodFile文件分析&quot;&gt;&lt;a href=&quot;#PodFile文件分析&quot; class=&quot;headerlink&quot; title=&quot;PodFile文件分析&quot;&gt;&lt;/a&gt;PodFile文件分析&lt;/h2&gt;&lt;p&gt;PodFile是CocosPod的配置文件，是ruby语言写的，定义了用到的第三方模块，和一些处理过程。&lt;br&gt;&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;source &lt;span class=&quot;string&quot;&gt;&#39;https://github.com/CocoaPods/Specs.git&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;target &lt;span class=&quot;string&quot;&gt;&#39;F8v2&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &lt;span class=&quot;string&quot;&gt;&#39;React&#39;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;:subspecs&lt;/span&gt; =&amp;gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;Core&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTActionSheet&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTImage&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTNetwork&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTText&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTWebSocket&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTPushNotification&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTLinkingIOS&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;RCTVibration&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ], &lt;span class=&quot;symbol&quot;&gt;:path&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &lt;span class=&quot;string&quot;&gt;&#39;react-native-fbsdkcore&#39;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;:path&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-fbsdk/iOS/core&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &lt;span class=&quot;string&quot;&gt;&#39;react-native-fbsdklogin&#39;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;:path&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-fbsdk/iOS/login&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &lt;span class=&quot;string&quot;&gt;&#39;react-native-fbsdkshare&#39;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;:path&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-fbsdk/iOS/share&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pod &lt;span class=&quot;string&quot;&gt;&#39;CodePush&#39;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;:path&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-code-push&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Start the React Native JS packager server when running the project in Xcode.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;start_packager = &lt;span class=&quot;string&quot;&gt;%q(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if nc -w 5 -z localhost 8081 ; then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if ! curl -s &quot;http://localhost:8081/status&quot; | grep -q &quot;packager-status:running&quot; ; then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    echo &quot;Port 8081 already in use, packager is either not running or not running correctly&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    exit 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  open $SRCROOT/../../node_modules/react-native/packager/launchPackager.command || echo &quot;Can&#39;t start packager automatically&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;post_install &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;|installer|&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  target = installer.pods_project.targets.select&amp;#123;&lt;span class=&quot;params&quot;&gt;|t|&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;React&#39;&lt;/span&gt; == t.name&amp;#125;.first&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  phase = target.new_shell_script_build_phase(&lt;span class=&quot;string&quot;&gt;&#39;Run Script&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  phase.shell_script = start_packager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;通过CocosPod引入了React，react-native-fbsdkcore，react-native-fbsdklogin，react-native-fbsdkshare，CodePush这些模块，&lt;br&gt;最后会尝试启动React Native packager。&lt;/p&gt;
&lt;h2 id=&quot;入口类AppDelegate-m代码分析&quot;&gt;&lt;a href=&quot;#入口类AppDelegate-m代码分析&quot; class=&quot;headerlink&quot; title=&quot;入口类AppDelegate.m代码分析&quot;&gt;&lt;/a&gt;入口类AppDelegate.m代码分析&lt;/h2&gt;&lt;p&gt;从项目的入口类AppDelegate.m看起,&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;lt;FBSDKCoreKit/FBSDKCoreKit.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;lt;CodePush/CodePush.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;AppDelegate.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;RCTRootView.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;RCTPushNotificationManager.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation AppDelegate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSURL *jsCodeLocation;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifdef DEBUG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSString *ip = [[NSString stringWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&amp;quot;ip&amp;quot; ofType:@&amp;quot;txt&amp;quot;] encoding:NSUTF8StringEncoding error:nil] stringByTrimmingCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:@&amp;quot;\n&amp;quot;]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (!ip) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ip = @&amp;quot;127.0.0.1&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  jsCodeLocation = [NSURL URLWithString:[NSString stringWithFormat:@&amp;quot;http://%@:8081/index.ios.bundle?platform=ios&amp;amp;dev=true&amp;quot;, ip]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  jsCodeLocation = [CodePush bundleURL];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSLog(jsCodeLocation.absoluteString);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                      moduleName:@&amp;quot;F8v2&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                               initialProperties:nil&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                   launchOptions:launchOptions];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSArray *objects = [[NSBundle mainBundle] loadNibNamed:@&amp;quot;LaunchScreen&amp;quot; owner:self options:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIImageView *loadingView = [[[objects objectAtIndex:0] subviews] objectAtIndex:0];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  loadingView = [[UIImageView alloc] initWithImage:[loadingView image]];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  loadingView.frame = [UIScreen mainScreen].bounds;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  rootView.loadingView = loadingView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIViewController *rootViewController = [[UIViewController alloc] init];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  rootViewController.view = rootView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  self.window.rootViewController = rootViewController;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [[UIApplication sharedApplication] setStatusBarHidden:NO];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [self.window makeKeyAndVisible];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return YES;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)applicationDidBecomeActive:(UIApplication *)application &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [FBSDKAppEvents activateApp];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return [[FBSDKApplicationDelegate sharedInstance] application:application&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                        openURL:url&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                              sourceApplication:sourceApplication&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                     annotation:annotation];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)application:(UIApplication *)application didRegisterUserNotificationSettings:(UIUserNotificationSettings *)notificationSettings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [RCTPushNotificationManager didRegisterUserNotificationSettings:notificationSettings];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [RCTPushNotificationManager didRegisterForRemoteNotificationsWithDeviceToken:deviceToken];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)notification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  [RCTPushNotificationManager didReceiveRemoteNotification:notification];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到主要用了FBSDKCoreKit，CodePush热更新，RCTPushNotificationManager推送。&lt;br&gt;首先创建了RCTRootView &lt;em&gt;rootView，RCTRootView就是RN页面的容器，我们只要在iOS ViewController中添加RCTRootView就可以展示RN的页面了。&lt;br&gt;然后从LaunchScreen.xib中取出一个子View作为rootView的加载页面loadingView，设置view的frame，创建一个rootViewController，并把它的view设置成RCTRootView &lt;/em&gt;rootView，然后把UIWindow的rootViewController设成刚才创建的rootViewController，这些代码还是很简单的。&lt;br&gt;didRegisterUserNotificationSettings，didRegisterForRemoteNotificationsWithDeviceToken，didReceiveRemoteNotification几个方法是对推送通知的处理，也比较简单。&lt;/p&gt;
&lt;h2 id=&quot;F8Scrolling-m滚动UI组件代码分析&quot;&gt;&lt;a href=&quot;#F8Scrolling-m滚动UI组件代码分析&quot; class=&quot;headerlink&quot; title=&quot;F8Scrolling.m滚动UI组件代码分析&quot;&gt;&lt;/a&gt;F8Scrolling.m滚动UI组件代码分析&lt;/h2&gt;&lt;p&gt;然后看下F8Scrolling.m，这个是RN的滚动UI组件，在f8app/js/common/ListContainer.js中用到了这个组件的js代码。我们看看代码里做了哪些事情：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;lt;UIKit/UIKit.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;lt;CoreGraphics/CoreGraphics.h&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;F8Scrolling.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;RCTUIManager.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#import &amp;quot;RCTScrollView.h&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface F8Scrolling () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMapTable *_pinnedViews;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  NSMapTable *_distances;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation F8Scrolling&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@synthesize bridge = _bridge;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_MODULE()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (instancetype)init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (self = [super init]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _pinnedViews = [[NSMapTable alloc] initWithKeyOptions:NSMapTableWeakMemory valueOptions:NSMapTableWeakMemory capacity:20];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    _distances = [[NSMapTable alloc] initWithKeyOptions:NSMapTableWeakMemory valueOptions:NSMapTableStrongMemory capacity:20];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return self;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (dispatch_queue_t)methodQueue&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return dispatch_get_main_queue();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_METHOD(pin:(nonnull NSNumber *)scrollViewReactTag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  toView:(nonnull NSNumber *)pinnedViewReactTag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                  withDistance:(nonnull NSNumber *)distance)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIView *pinnedView = [self.bridge.uiManager viewForReactTag:pinnedViewReactTag];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIView *scrollView = [self.bridge.uiManager viewForReactTag:scrollViewReactTag];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if ([scrollView isKindOfClass:[RCTScrollView class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RCTScrollView *reactScrollView = (RCTScrollView *)scrollView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [_pinnedViews setObject:pinnedView forKey:reactScrollView.scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [_distances setObject:distance forKey:reactScrollView.scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [reactScrollView setNativeScrollDelegate:self];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self scrollViewDidScroll:reactScrollView.scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RCT_EXPORT_METHOD(unpin:(nonnull NSNumber *)scrollViewReactTag)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIView *scrollView = [self.bridge.uiManager viewForReactTag:scrollViewReactTag];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if ([scrollView isKindOfClass:[RCTScrollView class]]) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RCTScrollView *reactScrollView = (RCTScrollView *)scrollView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [_pinnedViews removeObjectForKey:reactScrollView.scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [_distances removeObjectForKey:reactScrollView.scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [reactScrollView setNativeScrollDelegate:nil];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)scrollViewDidScroll:(UIScrollView *)scrollView&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  UIView *pinnedView = [_pinnedViews objectForKey:scrollView];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (!pinnedView) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  CGFloat distance = [[_distances objectForKey:scrollView] doubleValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  CGFloat y = MAX(0, distance - scrollView.contentOffset.y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pinnedView.transform = CGAffineTransformMakeTranslation(0, y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;首先是类定义，oc里面是用@interface定义类的，这个和Java的interface很不一样，protocol对应Java的接口interface。&lt;br&gt;&lt;code&gt;@interface F8Scrolling : NSObject &amp;lt;RCTBridgeModule, UIScrollViewDelegate&amp;gt;&lt;/code&gt;&lt;br&gt;init构造函数初始化了_pinnedViews和_distances2个变量，都是NSMapTable类型，&lt;a href=&quot;http://www.isaced.com/post-235.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSMapTable&lt;/a&gt;（顾名思义）更适合于一般意义的映射。这取决于它是如何构造的，NSMapTable可以处理的“key-to-object”样式映射的NSDictionary，但它也可以处理“object-to-object”的映射 - 也被称为“associative array”或简称为“map”。_pinnedViews的key和value都是weak引用，_distances的key是weak引用，value是强引用。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@synthesize bridge=_bridge;&lt;/code&gt;意思是说，bridge 属性为 _bridge 实例变量合成访问器方法。&lt;br&gt;也就是说，bridge属性生成存取方法是setBridge，这个setWindow方法就是_bridge变量的存取方法，它操作的就是_bridge这个变量。通过这个看似是赋值的这样一个操作，我们可以在@synthesize 中定义与变量名不相同的getter和setter的命名，籍此来保护变量不会被不恰当的访问。&lt;/p&gt;
&lt;p&gt;methodQueue返回了main_queue,规定这个组件运行在UI线程，因为它是UI组件啊&lt;br&gt;然后是几个方法的定义，RCT_EXPORT_METHOD宏提供导出方法到js的能力，可以用RCT_REMAP_METHOD重新定义在js中的函数名，还可以让js方法异步返回Promise，下面是它的定义&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Wrap the parameter line of your method implementation with this macro to&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * expose it to JS. By default the exposed method will match the first part of&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * the Objective-C method selector name (up to the first colon). Use&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * RCT_REMAP_METHOD to specify the JS name of the method.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * For example, in ModuleName.m:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * - (void)doSomething:(NSString *)aString withA:(NSInteger)a andB:(NSInteger)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &amp;#123; ... &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * becomes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * RCT_EXPORT_METHOD(doSomething:(NSString *)aString&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *                   withA:(NSInteger)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *                   andB:(NSInteger)b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &amp;#123; ... &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * and is exposed to JavaScript as `NativeModules.ModuleName.doSomething`.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * ## Promises&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Bridge modules can also define methods that are exported to JavaScript as&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * methods that return a Promise, and are compatible with JS async functions.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Declare the last two parameters of your native method to be a resolver block&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * and a rejecter block. The resolver block must precede the rejecter block.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * For example:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * RCT_EXPORT_METHOD(doSomethingAsync:(NSString *)aString&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *                           resolver:(RCTPromiseResolveBlock)resolve&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *                           rejecter:(RCTPromiseRejectBlock)reject&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * &amp;#123; ... &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Calling `NativeModules.ModuleName.doSomethingAsync(aString)` from&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * JavaScript will return a promise that is resolved or rejected when your&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * native method implementation calls the respective block.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#define RCT_EXPORT_METHOD(method) \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RCT_REMAP_METHOD(, method)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;方法pin从名字就可以知道，功能是固定view的。通过self.bridge.uiManager viewForReactTag方法获取到view。&lt;br&gt;方法scrollViewDidScroll最后定义了pinnedView的transform动画效果,&lt;code&gt;pinnedView.transform = CGAffineTransformMakeTranslation(0, y);&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;F8v2目录下的代码文件基本上就介绍完了，Info.plist文件定义了项目的一些基本属性，包括CodePush key等的自定义属性。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;f8app iOS的代码量还是比较少的，本文主要分析了AppDelegate.m和 F8Scrolling UI组件的代码。项目还用了BVLinearGradient渐变UI组件，通过工程引用的，代码也比较简单。另外还通过CocosPod引入了React，react-native-fbsdkcore，react-native-fbsdklogin，react-native-fbsdkshare，CodePush这些模块，可以参考ios/PodFile。&lt;/p&gt;
&lt;p&gt;[本文独立博客地址](&lt;a href=&quot;http://www.offbye.com）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.offbye.com）&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;本文分析f8app iOS代码的结构和技术实现，阅读本文的前提是对React Native和iOS开发有一定的了解。&lt;br&gt;f8app ios项目使用了CocosPod管理模块，现在RN的最新版本创建的项目默认已经不再使用CocosPods了,直接通过工程引用。f8app还是用了CocosPod，因此我们首先需要在ios目录下运行&lt;code&gt;pod install&lt;/code&gt;，安装好依赖的项目，然后用Xcode打开F8v2.xcworkspace工作空间，注意不是打开F8v2.xcodeproj工程文件，我经常犯这个错误，实在不喜欢用CocosPods啊。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Swift iOS中的Nullability Annotations</title>
    <link href="http://offbye.com/2016/06/02/Swift-iOS%E4%B8%AD%E7%9A%84Nullability-Annotations/"/>
    <id>http://offbye.com/2016/06/02/Swift-iOS中的Nullability-Annotations/</id>
    <published>2016-06-02T06:41:30.000Z</published>
    <updated>2016-06-02T07:49:52.000Z</updated>
    
    <content type="html">&lt;p&gt;今天折腾使用swift开发React Native的插件，遇到一个参数必须标记成nonnull的问题。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;用Swift写了个RN简单的模块，遇到了下面的错误：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[error][tid:com.facebook.react.CalendarManagerQueue][RCTModuleMethod.m:58] Argument 2 (NSNumber) of CalendarManager.addEvent has unspecified nullability but React requires that all NSNumber arguments are explicitly marked as `nonnull` to ensure compatibility with Android.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;解决这个错误，只需要在参数前面加上nonnull就可以了，但是为什么呢？&lt;/p&gt;
&lt;p&gt;于是google了一下，发现这是Xcode 6.3的一个新特性，即nullability annotations。&lt;/p&gt;
&lt;h2 id=&quot;Nullability-Annotations&quot;&gt;&lt;a href=&quot;#Nullability-Annotations&quot; class=&quot;headerlink&quot; title=&quot;Nullability Annotations&quot;&gt;&lt;/a&gt;Nullability Annotations&lt;/h2&gt;&lt;p&gt;我们都知道在swift中，可以使用!和?来表示一个对象是optional的还是non-optional，如view?和view!。而在Objective-C中则没有这一区分，view即可表示这个对象是optional，也可表示是non-optional。这样就会造成一个问题：在Swift与Objective-C混编时，Swift编译器并不知道一个Objective-C对象到底是optional还是non-optional，因此这种情况下编译器会隐式地将Objective-C的对象当成是non-optional。&lt;/p&gt;
&lt;p&gt;为了解决这个问题，苹果在Xcode 6.3引入了一个Objective-C的新特性：nullability annotations。这一新特性的核心是两个新的类型注释：&lt;strong&gt;nullable和&lt;/strong&gt;nonnull。从字面上我们可以猜到，&lt;strong&gt;nullable表示对象可以是NULL或nil，而&lt;/strong&gt;nonnull表示对象不应该为空。当我们不遵循这一规则时，编译器就会给出警告。&lt;/p&gt;
&lt;p&gt;我们来看看以下的实例，&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface TestNullabilityClass ()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (nonatomic, copy) NSArray * items;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (id)itemWithName:(NSString * __nonnull)name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@implementation TestNullabilityClass&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (void)testNullability &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [self itemWithName:nil];    // 编译器警告：Null passed to a callee that requires a non-null argument&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (id)itemWithName:(NSString * __nonnull)name &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return nil;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;不过这只是一个警告，程序还是能编译通过并运行。&lt;/p&gt;
&lt;p&gt;事实上，在任何可以使用const关键字的地方都可以使用&lt;strong&gt;nullable和&lt;/strong&gt;nonnull，不过这两个关键字仅限于使用在指针类型上。而在方法的声明中，我们还可以使用不带下划线的nullable和nonnull，如下所示&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(nullable id)itemWithName:(NSString * nonnull)name&lt;br&gt;在属性声明中，也增加了两个相应的特性，因此上例中的items属性可以如下声明：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;@property (nonatomic, copy, nonnull) NSArray * items;&lt;br&gt;当然也可以用以下这种方式：&lt;/p&gt;
&lt;p&gt;@property (nonatomic, copy) NSArray * __nonnull items;&lt;br&gt;推荐使用nonnull这种方式，这样可以让属性声明看起来更清晰。&lt;/p&gt;
&lt;p&gt;Nonnull区域设置(Audited Regions)&lt;/p&gt;
&lt;p&gt;如果需要每个属性或每个方法都去指定nonnull和nullable，是一件非常繁琐的事。苹果为了减轻我们的工作量，专门提供了两个宏：NS_ASSUME_NONNULL_BEGIN和NS_ASSUME_NONNULL_END。在这两个宏之间的代码，所有简单指针对象都被假定为nonnull，因此我们只需要去指定那些nullable的指针。如下代码所示：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NS_ASSUME_NONNULL_BEGIN&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@interface TestNullabilityClass ()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@property (nonatomic, copy) NSArray * items;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- (id)itemWithName:(nullable NSString *)name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NS_ASSUME_NONNULL_END&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在上面的代码中，items属性默认是nonnull的，itemWithName:方法的返回值也是nonnull，而参数是指定为nullable的。&lt;/p&gt;
&lt;p&gt;不过，为了安全起见，苹果还制定了几条规则：&lt;/p&gt;
&lt;p&gt;typedef定义的类型的nullability特性通常依赖于上下文，即使是在Audited Regions中，也不能假定它为nonnull。&lt;br&gt;复杂的指针类型(如id &lt;em&gt;)必须显示去指定是nonnull还是nullable。例如，指定一个指向nullable对象的nonnull指针，可以使用”__nullable id &lt;/em&gt; __nonnull”。&lt;br&gt;我们经常使用的NSError **通常是被假定为一个指向nullable NSError对象的nullable指针。&lt;br&gt;兼容性&lt;/p&gt;
&lt;p&gt;因为Nullability Annotations是Xcode 6.3新加入的，所以我们需要考虑之前的老代码。实际上，苹果已以帮我们处理好了这种兼容问题，我们可以安全地使用它们：&lt;/p&gt;
&lt;p&gt;老代码仍然能正常工作，即使对nonnull对象使用了nil也没有问题。&lt;br&gt;老代码在需要和swift混编时，在新的swift编译器下会给出一个警告。&lt;br&gt;nonnull不会影响性能。事实上，我们仍然可以在运行时去判断我们的对象是否为nil。&lt;br&gt;事实上，我们可以将nonnull/nullable与我们的断言和异常一起看待，其需要处理的问题都是同一个：违反约定是一个程序员的错误。特别是，返回值是我们可控的东西，如果返回值是nonnull的，则我们不应该返回nil，除非是为了向后兼容。&lt;/p&gt;
&lt;h3 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/swift/blog/?id=25&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nullability and Objective-C&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[本文独立博客地址](）&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天折腾使用swift开发React Native的插件，遇到一个参数必须标记成nonnull的问题。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>React Native Package Manager包管理器介绍</title>
    <link href="http://offbye.com/2016/06/01/React-Native-Package-Manager%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E4%BB%8B%E7%BB%8D/"/>
    <id>http://offbye.com/2016/06/01/React-Native-Package-Manager包管理器介绍/</id>
    <published>2016-06-01T01:59:06.000Z</published>
    <updated>2016-06-01T15:20:22.000Z</updated>
    
    <content type="html">&lt;p&gt;React Native Package Manager是为了简化React Native开发而生的包管理器。这个项目的想法来自CocoaPods, fastlane和react-native link。它的目标是让几乎全部可用的模块不需要额外配置就可以使用。&lt;br&gt;RNPM需要一直在版本控制系统的管理下使用，以便保证一切可以回退。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;相关网站&quot;&gt;&lt;a href=&quot;#相关网站&quot; class=&quot;headerlink&quot; title=&quot;相关网站&quot;&gt;&lt;/a&gt;相关网站&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.reactnative.com/react-native-package-manager/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RNPM官方网站&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/rnpm/rnpm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rnpm github&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://js.coach/react-native&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RN组件&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需要node4.0以上版本，基本安装和使用方法如下：&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Installation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ npm install rnpm -g&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Usage&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ npm install react-native-&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;module&lt;/span&gt; --&lt;span class=&quot;title&quot;&gt;save&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ rnpm link react-native-&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;module&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面我们看看实际如下使用rnpm吧，首先你要一个React Native项目啊，&lt;br&gt;没有就新建一个吧,&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;react-native init zxtRn&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后到&lt;a href=&quot;https://js.coach/react-native/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://js.coach/react-native/&lt;/a&gt; 找需要的模块，以&lt;code&gt;react-native-send-intent&lt;/code&gt; 为例吧。&lt;br&gt;&lt;a href=&quot;https://github.com/lucasferreira/react-native-send-intent&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;react-native-send-intent&lt;/a&gt;模块提供在RN js代码中调用Android Intent发送短信，打电话的能力。&lt;br&gt;有了rnpm我们就不需要通过模块github的说明一步一步配置了，只需要用下面的命令安装就行了。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ rnpm install react-native-send-intent&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;react-native-send-intent@1.0.10 node_modules/react-native-send-intent&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rnpm-link info Linking react-native-send-intent android dependency&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rnpm-link info Android module react-native-send-intent has been successfully linked&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rnpm-install info Module react-native-send-intent has been successfully installed &amp;amp; linked&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ git diff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;diff --git a/android/app/build.gradle b/android/app/build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index 2c01c61..69506c5 100644&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--- a/android/app/build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++ b/android/app/build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -121,6 +121,7 @@ android &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+    compile project(&amp;apos;:react-native-send-intent&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     compile project(&amp;apos;:react-native-code-push&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     compile fileTree(dir: &amp;quot;libs&amp;quot;, include: [&amp;quot;*.jar&amp;quot;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     // From node_modules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;diff --git a/android/app/src/main/java/com/zxtrn/MainActivity.java b/android/app/src/main/java/com/zxtrn/MainActivity.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index b8eecad..7e09daf 100644&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--- a/android/app/src/main/java/com/zxtrn/MainActivity.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++ b/android/app/src/main/java/com/zxtrn/MainActivity.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -1,6 +1,7 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; package com.zxtrn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; import com.facebook.react.ReactActivity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+import com.burnweb.rnsendintent.RNSendIntentPackage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; import com.microsoft.codepush.react.CodePush;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; import com.facebook.react.ReactPackage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; import com.facebook.react.shell.MainReactPackage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -45,6 +46,7 @@ public class MainActivity extends ReactActivity &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         return Arrays.&amp;lt;ReactPackage&amp;gt;asList(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             new MainReactPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+            new RNSendIntentPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             this._codePush&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             //new CodePush(this.getResources().getString(R.strings.reactNativeCodePush_androidDeploymentKey), this, BuildConfig.DEBUG)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;diff --git a/android/app/src/main/res/values/strings.xml b/android/app/src/main/res/values/strings.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index 6252fd9..7b5819b 100644&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--- a/android/app/src/main/res/values/strings.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++ b/android/app/src/main/res/values/strings.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -1,4 +1,5 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;lt;resources&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;string name=&amp;quot;reactNativeCodePush_androidDeploymentKey&amp;quot; moduleConfig=&amp;quot;true&amp;quot;&amp;gt;UAvQtR1CTph9a9b4axtv3rupnJigVklbZAwzW&amp;lt;/string&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;string name=&amp;quot;app_name&amp;quot;&amp;gt;zxtRn&amp;lt;/string&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;string name=&amp;quot;title_activity_my&amp;quot;&amp;gt;MyActivity&amp;lt;/string&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;diff --git a/android/settings.gradle b/android/settings.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index 19d1a10..ec167d0 100644&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--- a/android/settings.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++ b/android/settings.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -1,5 +1,7 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; rootProject.name = &amp;apos;zxtRn&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; include &amp;apos;:app&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+include &amp;apos;:react-native-send-intent&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+project(&amp;apos;:react-native-send-intent&amp;apos;).projectDir = new File(rootProject.projectDir, &amp;apos;../node_modules/react-native-send-intent/android&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; include &amp;apos;:react-native-code-push&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; project(&amp;apos;:react-native-code-push&amp;apos;).projectDir = new File(rootProject.projectDir, &amp;apos;../node_modules/react-native-code-push/android/app&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;diff --git a/package.json b/package.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;index 8fd73cc..f7aa8c5 100644&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;--- a/package.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+++ b/package.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@@ -8,6 +8,7 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;quot;dependencies&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;quot;react&amp;quot;: &amp;quot;^15.0.2&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;quot;react-native&amp;quot;: &amp;quot;^0.26.0&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-    &amp;quot;react-native-code-push&amp;quot;: &amp;quot;^1.11.0-beta&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+    &amp;quot;react-native-code-push&amp;quot;: &amp;quot;^1.11.0-beta&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+    &amp;quot;react-native-send-intent&amp;quot;: &amp;quot;^1.0.10&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(END)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;用git diff可以看到修改的文件，如果熟悉gradle和Android就很容易理解发生了什么，就是增加了一个工程依赖，并增加了插件包RNSendIntentPackage，依赖的工程是../node_modules/react-native-send-intent/android，&lt;br&gt;CodePush也可以用rnpm直接安装啊，我的项目上次已经配置好了CodePush。&lt;/p&gt;
&lt;p&gt;通过rnpm可以方便的管理RN的第三方模块，不需要做那些繁琐的配置了。&lt;br&gt;￼&lt;br&gt;￼￼&lt;br&gt;￼&lt;br&gt;[本文独立博客地址](）&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;React Native Package Manager是为了简化React Native开发而生的包管理器。这个项目的想法来自CocoaPods, fastlane和react-native link。它的目标是让几乎全部可用的模块不需要额外配置就可以使用。&lt;br&gt;RNPM需要一直在版本控制系统的管理下使用，以便保证一切可以回退。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>升级CocoaPods 1.0.0问题解决汇总</title>
    <link href="http://offbye.com/2016/05/29/%E5%8D%87%E7%BA%A7CocoaPods-1-0-0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%B1%87%E6%80%BB/"/>
    <id>http://offbye.com/2016/05/29/升级CocoaPods-1-0-0问题解决汇总/</id>
    <published>2016-05-29T13:51:28.000Z</published>
    <updated>2016-05-30T01:41:56.000Z</updated>
    
    <content type="html">&lt;p&gt;昨天晚上升级了CocosPads1.0, 只是安装成功了，现在项目里面运行pod install又发现了几个问题，昨天折腾的太晚了。今天继续折腾吧。&lt;br&gt;今天终于彻底搞定了CocosPods1.0，包括安装，运行和一个开源项目PodFile的1.0升级。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;运行&lt;code&gt;pod install&lt;/code&gt;时发现CocoaPods 提示有1.0版本了，于是打算升级一下。&lt;br&gt;CocoaPods 1.0.0 is available.&lt;br&gt;To update use: &lt;code&gt;gem install cocoapods&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;结果就出现了下面的错误，分析了下原因是/usr/bin/xcodeproj目录路径错了，网上搜了下解决问题，使用&lt;code&gt;sudo gem install -n /usr/local/bin cocoapods --pre&lt;/code&gt; 命令顺利安装成功。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ sudo gem install cocoapods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR:  While executing gem ... (Errno::EPERM)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Operation not permitted - /usr/bin/xcodeproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ ls -al /usr/bin/xcodeproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ls: cannot access /usr/bin/xcodeproj: No such file or directory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ sudo gem install -n /usr/local/bin cocoapods --pre&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Successfully installed xcodeproj-1.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fetching: molinillo-0.4.5.gem (100%)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Successfully installed molinillo-0.4.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fetching: cocoapods-try-1.0.0.gem (100%)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Successfully installed cocoapods-try-1.0.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在项目下运行&lt;code&gt;pod install&lt;/code&gt; 报错了：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;od install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods/sources_manager.rb:159:in `&amp;lt;module:SourcesManagerMissingConstant&amp;gt;&amp;apos;: uninitialized constant Pod::SourcesManagerMissingConstant::Set (NameError)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods/sources_manager.rb:158:in `&amp;lt;module:Pod&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods/sources_manager.rb:3:in `&amp;lt;top (required)&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods/core_overrides.rb:1:in `&amp;lt;top (required)&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods.rb:71:in `&amp;lt;module:Pod&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods.rb:17:in `&amp;lt;top (required)&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Site/2.0.0/rubygems/core_ext/kernel_require.rb:69:in `require&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/bin/pod:36:in `&amp;lt;top (required)&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /usr/local/bin/pod:23:in `load&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	from /usr/local/bin/pod:23:in `&amp;lt;main&amp;gt;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;网上搜了下，发现这个issue已经close了，但好像没有更新啊，&lt;a href=&quot;https://github.com/CocoaPods/CocoaPods/pull/5288&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CocoaPods/CocoaPods/pull/5288&lt;/a&gt;&lt;br&gt;只好自己看代码修改一下：&lt;br&gt;修改 /Library/Ruby/Gems/2.0.0/gems/cocoapods-1.0.0/lib/cocoapods/sources_manager.rb&lt;br&gt;在第二行增加&lt;br&gt;&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;set&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;保存文件，需要输入密码的。&lt;/p&gt;
&lt;p&gt;继续运行&lt;code&gt;pod install&lt;/code&gt;， 结果又报下面的错误：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;edhita $ pod install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Re-creating CocoaPods due to major version update.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[!] `:head` dependencies have been removed. Please use normal external source dependencies (`:git =&amp;gt; &amp;apos;GIT_REPO_URL&amp;apos;`) instead of `:head` for `EDHFontSelector`.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这个看提示应该是个版本兼容问题了，还是先去仔细看看官方的&lt;a href=&quot;http://blog.cocoapods.org/CocoaPods-1.0/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CocoaPods 1.0的release说明&lt;/a&gt;吧。&lt;br&gt;应该是不支持&lt;code&gt;:head&lt;/code&gt;这个语法了,并且必须有target。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.cocoapods.org/CocoaPods-1.0-Migration-Guide/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里有个官方迁移指南&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000005011497&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;拥抱 CocoaPods 1.0&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下面用正在研究的markdown编辑器Edhita的Podfile做个升级的例子吧，&lt;br&gt;原地址 &lt;a href=&quot;https://github.com/tnantoka/edhita/blob/master/Podfile&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/tnantoka/edhita/blob/master/Podfile&lt;/a&gt;&lt;br&gt;迁移前的代码：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;platform :ios, &amp;quot;8.0&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;source &amp;apos;https://github.com/CocoaPods/Specs.git&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHFinder&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHFontSelector&amp;apos;, :head&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHInputAccessoryView&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Google-Mobile-Ads-SDK&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Colours&amp;apos;, &amp;apos;~&amp;gt; 5.5&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;FXForms&amp;apos;, &amp;apos;~&amp;gt; 1.2&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;GHMarkdownParser&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;VTAcknowledgementsViewController&amp;apos;, &amp;apos;~&amp;gt; 0.12&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Bootstrap&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/Bootstrap/Bootstrap.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Megrim&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/Megrim/Megrim.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;github-markdown-css&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/github-markdown-css/github-markdown-css.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;post_install do |installer|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  require &amp;apos;fileutils&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  FileUtils.cp_r(&amp;apos;Pods/Target Support Files/Pods/Pods-acknowledgements.plist&amp;apos;, &amp;apos;Edhita/Assets/Pods-acknowledgements.plist&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;升级到cocosPods 1.0后的代码&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;platform :ios, &amp;quot;8.0&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;source &amp;apos;https://github.com/CocoaPods/Specs.git&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;target &amp;apos;Edhita&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHFinder&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHFontSelector&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;EDHInputAccessoryView&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Google-Mobile-Ads-SDK&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;Colours&amp;apos;, &amp;apos;~&amp;gt; 5.5&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;FXForms&amp;apos;, &amp;apos;~&amp;gt; 1.2&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;GHMarkdownParser&amp;apos;, &amp;apos;~&amp;gt; 0.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pod &amp;apos;VTAcknowledgementsViewController&amp;apos;, &amp;apos;~&amp;gt; 0.12&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# pod &amp;apos;Bootstrap&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/Bootstrap/Bootstrap.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# pod &amp;apos;Megrim&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/Megrim/Megrim.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# pod &amp;apos;github-markdown-css&amp;apos;, podspec: &amp;apos;https://raw.githubusercontent.com/tnantoka/podspecs/master/Specs/github-markdown-css/github-markdown-css.podspec&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;post_install do |installer|&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  require &amp;apos;fileutils&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  # FileUtils.cp_r(&amp;apos;Pods/Target Support Files/Pods-Edhita/Pods-Edhita-acknowledgements.plist&amp;apos;, &amp;apos;Edhita/Assets/Pods-acknowledgements.plist&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;end&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;我偷懒注释了一些不需要的代码，运行&lt;code&gt;pod install&lt;/code&gt;, Xcode打开Edhita.xcworkspace, 就能编译通过了。效果如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/62edd018f93265892317424aaef3ae86.png&quot; alt=&quot;Edhiha&quot;&gt;&lt;/p&gt;
&lt;p&gt;这次CocoaPods 1.0的升级体验还真是坑啊，经历了4年半的开发才发布1.0版本啊，不知道该说什么好了。&lt;br&gt;珍爱生命，新项目拥抱Carthage吧。但也不能不用CocoaPods啊，那么多开源项目都用了啊，还是暂时先不要升级1.0了。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.offbye.com/2016/05/29/%E5%8D%87%E7%BA%A7CocoaPods-1-0-0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%B1%87%E6%80%BB/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;本文独立博客地址&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;昨天晚上升级了CocosPads1.0, 只是安装成功了，现在项目里面运行pod install又发现了几个问题，昨天折腾的太晚了。今天继续折腾吧。&lt;br&gt;今天终于彻底搞定了CocosPods1.0，包括安装，运行和一个开源项目PodFile的1.0升级。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>jenkins-xcodebuild命令行打包iOS项目问题汇总</title>
    <link href="http://offbye.com/2016/05/28/jenkins-xcodebuild%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%93%E5%8C%85iOS%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>http://offbye.com/2016/05/28/jenkins-xcodebuild命令行打包iOS项目问题汇总/</id>
    <published>2016-05-28T14:17:37.000Z</published>
    <updated>2016-05-28T07:35:13.000Z</updated>
    
    <content type="html">&lt;p&gt;这几天折腾了jenkins对iOS swift项目的持续集成，碰到了很多问题，记录下吧&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;1-缺少scheme&quot;&gt;&lt;a href=&quot;#1-缺少scheme&quot; class=&quot;headerlink&quot; title=&quot;1. 缺少scheme&quot;&gt;&lt;/a&gt;1. 缺少scheme&lt;/h2&gt;&lt;p&gt;xcodebuild: error: The project named “Foo” does not contain a scheme named “Bar”. The “-list” option can be used to find the names of the schemes in the project.&lt;/p&gt;
&lt;p&gt;解决办法：&lt;br&gt;The root cause is that the default behavior of Schemes is to keep schemes ‘private’ until they are specifically marked as shared. In the case of a command-line initiated build, the Xcode UI never runs and the xcoderun tool doesn’t have its own cache of Schemes to work with.&lt;br&gt;To your schema be visible for command-line build you must mark it as a shared scheme.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Choose Scheme &amp;gt; Manage Schemes (from the Product Menu).&lt;br&gt;Ensure the ‘Shared’ box is checked for that scheme&lt;br&gt;A new .xcscheme file has been created in your project at&lt;br&gt;WorkspaceName.xcworkspace/xcshareddata/xcschemes.&lt;br&gt;Commit this file to your repository&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;2-Error-User-interaction-is-not-allowed&quot;&gt;&lt;a href=&quot;#2-Error-User-interaction-is-not-allowed&quot; class=&quot;headerlink&quot; title=&quot;2.  Error:   User interaction is not allowed.&quot;&gt;&lt;/a&gt;2.  Error:   User interaction is not allowed.&lt;/h2&gt;&lt;p&gt;运行下面的命令可解决&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ security unlock-keychain -p  ~/Library/Keychains/login.keychain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ security show-keychain-info ~/Library/Keychains/login.keychain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Keychain &amp;quot;/Users/XXX/Library/Keychains/login.keychain&amp;quot; no-timeout&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;3-Xcode-7后导出IPA命令发生变化&quot;&gt;&lt;a href=&quot;#3-Xcode-7后导出IPA命令发生变化&quot; class=&quot;headerlink&quot; title=&quot;3. Xcode 7后导出IPA命令发生变化&quot;&gt;&lt;/a&gt;3. Xcode 7后导出IPA命令发生变化&lt;/h2&gt;&lt;p&gt;以前我是通过下面的命令打包的，但现在的swift项目这样导出的包在iPhone安装后直接闪退&lt;br&gt;&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;xcodebuild -target $&amp;#123;TARGET_NAME&amp;#125; -configuration $&amp;#123;BUILD_CONFIGURATION&amp;#125; -sdk phones build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xcrun -sdk iphoneos PackageApplication -v $&amp;#123;APP_NAME&amp;#125; -o $&amp;#123;IPA_PATH&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Xcode7之后取消了原来的-exportFormat，而是使用exportOptionsPlist 来取代，具体的使用方法可以在Terminal打xcodebuild –help查看。&lt;br&gt;我们需要自己创建一个plist作为Export Options，只要有这个配置文件，那我们在使用这个命令的时候就能打出跟手动用Xcode Archive之后export出的ipa一样了。&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;plist&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;version&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;1.0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dict&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;teamID&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;string&lt;/span&gt;&amp;gt;&lt;/span&gt;XXXXXXX&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;string&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;method&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;string&lt;/span&gt;&amp;gt;&lt;/span&gt;enterprise&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;string&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;compileBitcode&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;false&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;uploadSymbols&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;false&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dict&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;plist&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;4-最新的xcodebuild-导出ipa命令&quot;&gt;&lt;a href=&quot;#4-最新的xcodebuild-导出ipa命令&quot; class=&quot;headerlink&quot; title=&quot;4. 最新的xcodebuild 导出ipa命令&quot;&gt;&lt;/a&gt;4. 最新的xcodebuild 导出ipa命令&lt;/h2&gt;&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;xcodebuild -target XXXX -configuration Release build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xcodebuild archive -project &amp;#123;xcodeproj&amp;#125; -scheme &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;scheme&amp;#125;&#39;&lt;/span&gt; -sdk iphoneos  -archivePath &amp;#123;archive_path&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xcodebuild -exportArchive -archivePath  &amp;#123;archive_path&amp;#125; -exportPath &amp;#123;export_path&amp;#125;  -exportOptionsPlist &amp;#123;export_plist_path&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;[本文独立博客地址](&lt;a href=&quot;http://www.offbye.com）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.offbye.com）&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这几天折腾了jenkins对iOS swift项目的持续集成，碰到了很多问题，记录下吧&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Python读取iOS安装包IPA中的信息和图片</title>
    <link href="http://offbye.com/2016/05/27/Python%E8%AF%BB%E5%8F%96iOS%E5%AE%89%E8%A3%85%E5%8C%85IPA%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF/"/>
    <id>http://offbye.com/2016/05/27/Python读取iOS安装包IPA中的信息/</id>
    <published>2016-05-27T13:32:36.000Z</published>
    <updated>2016-05-28T13:30:06.000Z</updated>
    
    <content type="html">&lt;p&gt;最近需要对所有的iOS和Android工程通过jenkins持续集成，软件的编译、打包、企业分发版的ipa发布都需要自动化。在做ipa自动化发布时，需要拿到一个app里面相关的信息，比如显示名称、版本号、bundle identifier等等。&lt;br&gt;然后在Jenkins构建任务中通过增加Python脚本针对每个版本生成IPA,plist和包含itms安装链接的网页。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;首先需要对iOS ipa包的结构有些了解。&lt;/p&gt;
&lt;h2 id=&quot;iOS-IPA文件结构&quot;&gt;&lt;a href=&quot;#iOS-IPA文件结构&quot; class=&quot;headerlink&quot; title=&quot;iOS IPA文件结构&quot;&gt;&lt;/a&gt;iOS IPA文件结构&lt;/h2&gt;&lt;p&gt;首先，一个ipa其实就是一个zip文件改了后缀名。如果你把ipa的后缀改回.zip，那么你就能通过各种解压软件直接解压了。&lt;/p&gt;
&lt;p&gt;解压后的目录结构是:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Payload&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    |-- 软件名.app&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        |-- ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        |-- ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        |-- Info.plist&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，Info.plist就是软件信息的所在。&lt;/p&gt;
&lt;p&gt;但是别高兴得太早，这里的Info.plist并不是纯文本文件，而是一种被称为Binary Plist的东西。之前在做iOS开发时，工程里面用的plist几乎都是XML形式的纯文本文件，所以一开始我理所当然地认为这个也是纯文本文件，结果在这里卡了半天。在命令行运行man plist就能看到下面这段话：&lt;/p&gt;
&lt;p&gt;The property list programming interface allows you to convert hierarchically structured combinations of these basic types to and from two formats: standard XML and an optimized, opaque binary format.&lt;br&gt;所以不能看到.plist结尾的文件就当文本文件处理。&lt;/p&gt;
&lt;h2 id=&quot;PYTHON中相应的LIBRARY，biplist和plistlib&quot;&gt;&lt;a href=&quot;#PYTHON中相应的LIBRARY，biplist和plistlib&quot; class=&quot;headerlink&quot; title=&quot;PYTHON中相应的LIBRARY，biplist和plistlib&quot;&gt;&lt;/a&gt;PYTHON中相应的LIBRARY，biplist和plistlib&lt;/h2&gt;&lt;p&gt;在知道ipa的结构之后，就能知道需要用哪些Python library了，第一个是zipfile，这个库能够处理zip类型的文件，并且可以在不解压的情况下读取里面某个文件的内容。另外一个是plistlib。但是需要注意的是，在Python 3.4之前，这个库是不支持 Binary Plist 的解析的。所以如果使用 Python 2.7 的话，需要使用三方库biplist。&lt;/p&gt;
&lt;p&gt;下面使用 Python 3.4 为例进行解析。之所以选择 Python 3.x 是因为 2.x 版本在处理 Unicode 和非 Unicode 混用时非常麻烦。而 Python 3.x 起，所有的 string 都使用 Unicode 编码了，就跟 ObjC 中一样。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; zipfile, plistlib, sys, re&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;analyze_ipa_with_plistlib&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ipa_path)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ipa_file = zipfile.ZipFile(ipa_path)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    plist_path = find_plist_path(ipa_file)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    plist_data = ipa_file.read(plist_path)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    plist_root = plistlib.loads(plist_data)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    print_ipa_info (plist_root)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;find_plist_path&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(zip_file)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    name_list = zip_file.namelist()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pattern = re.compile(&lt;span class=&quot;string&quot;&gt;r&#39;Payload/[^/]*.app/Info.plist&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; path &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; name_list:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        m = pattern.match(path)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; m &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; m.group()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;print_ipa_info&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(plist_root)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Display Name: %s&#39;&lt;/span&gt; % plist_root[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleDisplayName&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Bundle Identifier: %s&#39;&lt;/span&gt; % plist_root[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleIdentifier&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Version: %s&#39;&lt;/span&gt; % plist_root[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleShortVersionString&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&#39;__main__&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    args = sys.argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; len(args) &amp;amp;lt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Usage: python3 ipaanalyze.py /path/to/ipa&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ipa_path = args[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    analyze_ipa_with_plistlib(ipa_path)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;首先使用zipfile将ipa文件打开，zipfile中，namelist()方法能够列出里面包含的所有文件路径，并返回一个list。根据ipa的结构，我们要找的Info.plist是Payload/软件名字.app/Info.plist，所以这里使用一个正则表达式找到这个文件路径。&lt;/p&gt;
&lt;p&gt;ZipFile.read()这个方法，能够在不解压zip文件的情况下读取里面的内容，在Python 3.4中返回的是bytes类型，再使用plistlib.loads()载入。其中，loads()是 Python 3.4 才加入的新API，它接收一个bytes对象，将其解析成相应的Python对象。&lt;/p&gt;
&lt;p&gt;这样，这个plist文件就变成了一个dict，从而可以取到里面的内容。&lt;/p&gt;
&lt;p&gt;如果使用 Python 2.7， 则可以用biplist代替，这个库使用的是跟 Python 2.7 中plistlib相同的API,由于不想改服务器上默认的python2.7，我使用的是biplist。代码如下：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;info_plist = workspace + &lt;span class=&quot;string&quot;&gt;&quot;/build/Release-iphoneos/&quot;&lt;/span&gt; + project + &lt;span class=&quot;string&quot;&gt;&quot;.app/Info.plist&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(info_plist)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    plist = readPlist(info_plist)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; (InvalidPlistException, NotBinaryPlistException), e:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Not a plist:&quot;&lt;/span&gt;, e&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;display_name = plist[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleDisplayName&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;identifier = plist[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleIdentifier&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;short_version = plist[&lt;span class=&quot;string&quot;&gt;&#39;CFBundleShortVersionString&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Display Name: %s&#39;&lt;/span&gt; % display_name)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Bundle Identifier: %s&#39;&lt;/span&gt; % identifier)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; (&lt;span class=&quot;string&quot;&gt;&#39;Version: %s&#39;&lt;/span&gt; % short_version)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;如果不使用 Python，或者不想用这些类库，则可以通过一些外部程序来解决Binary Plist的读取问题。比如使用/usr/libexec/PlistBuddy或者是plutil，这些都是 OS X 自带的工具，通过它们，你可以读取Plist中的指定项，或者直接把plist变成JSON文件。&lt;/p&gt;
&lt;h2 id=&quot;读取ipa-app目录下的图片并还原&quot;&gt;&lt;a href=&quot;#读取ipa-app目录下的图片并还原&quot; class=&quot;headerlink&quot; title=&quot;读取ipa .app目录下的图片并还原&quot;&gt;&lt;/a&gt;读取ipa .app目录下的图片并还原&lt;/h2&gt;&lt;p&gt;由于Xcode工程中图标的文件名和位置都不固定，拿到AppIcon需要分析工程文件和AppIcon.appiconset/Contents.json文件内容，感觉分析过程太复杂了，容易出错误，因此还是想通过分析编译后的build/Release-iphoneos/myproject.app/包目录下找。app中所有的图片都在根目录下，但这些图片文件已经被xcode处理过了，在浏览器中显示为空白，因此需要想办法把图片文件还原。&lt;br&gt;在网上找到了一个python脚本，&lt;a href=&quot;http://www.axelbrz.com.ar/?mod=iphone-png-images-normalizer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iPIn iPhone PNG Images Normalizer&lt;/a&gt;, 感觉这个代码时间太久了，2007年写的，测试了下不能处理正确图片。&lt;br&gt;在这篇文章的评论里面发现一个链接&lt;a href=&quot;https://gist.github.com/urielka/3609051，&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://gist.github.com/urielka/3609051，&lt;/a&gt; 应该是个2012年的改进版本，看下面的评论说是可用，实验了下果然可以。图标问题解决了，处理后的图片可以在浏览器正常显示了。&lt;/p&gt;
&lt;p&gt;[本文独立博客地址](&lt;a href=&quot;http://www.offbye.com/）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.offbye.com/）&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近需要对所有的iOS和Android工程通过jenkins持续集成，软件的编译、打包、企业分发版的ipa发布都需要自动化。在做ipa自动化发布时，需要拿到一个app里面相关的信息，比如显示名称、版本号、bundle identifier等等。&lt;br&gt;然后在Jenkins构建任务中通过增加Python脚本针对每个版本生成IPA,plist和包含itms安装链接的网页。&lt;/p&gt;
    
    </summary>
    
    
      <category term="IPA" scheme="http://offbye.com/tags/IPA/"/>
    
      <category term="python" scheme="http://offbye.com/tags/python/"/>
    
      <category term="biplist" scheme="http://offbye.com/tags/biplist/"/>
    
      <category term="iOS打包" scheme="http://offbye.com/tags/iOS%E6%89%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>F8App-ReactNative项目源码分析4-js篇</title>
    <link href="http://offbye.com/2016/05/23/F8App-ReactNative%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%904-js%E7%AF%87/"/>
    <id>http://offbye.com/2016/05/23/F8App-ReactNative项目源码分析4-js篇/</id>
    <published>2016-05-23T13:42:12.000Z</published>
    <updated>2016-06-06T05:31:39.000Z</updated>
    
    <content type="html">&lt;p&gt;本文开始分析f8app核心js部分的源码，这篇文章将非常难理解，原因了Redux框架引入了很多新概念，使用了大量函数式编程思想，建议先把后面的参考文章仔细过一遍，确保理解后再看本文。React Native的理念是Learn once,write anywhere, Android和iOS App端的js代码是放在一起的，以便最大限度的复用业务逻辑，UI部分的可以根据平台特性各自实现，React native分别渲染成安卓和iOS的原生UI界面，对于两个平台UI组件的细微差异和完全不同的UI组件2种情况，react native提供了不同的处理方式。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;js入口分析&quot;&gt;&lt;a href=&quot;#js入口分析&quot; class=&quot;headerlink&quot; title=&quot;js入口分析&quot;&gt;&lt;/a&gt;js入口分析&lt;/h2&gt;&lt;p&gt;React Native Android App和iOS App的入口jsbundle对应的默认js源文件分别是index.android.js和index.ios.js，在f8app中这2个文件内容一致。代码如下：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123;AppRegistry&amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; setup = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./js/setup&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;AppRegistry.registerComponent(&lt;span class=&quot;string&quot;&gt;&#39;F8v2&#39;&lt;/span&gt;, setup);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;React Native采用了组件化编程的思想，在React Native项目中，所有展示的界面，都可以看做是一个组件（Component）。&lt;br&gt;index.android.js利用Node.js的require机制引入setup包，然后注册到AppRegistry.&lt;/p&gt;
&lt;h2 id=&quot;js目录结构分析&quot;&gt;&lt;a href=&quot;#js目录结构分析&quot; class=&quot;headerlink&quot; title=&quot;js目录结构分析&quot;&gt;&lt;/a&gt;js目录结构分析&lt;/h2&gt;&lt;p&gt;首先还是先看下js目录的结构:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;├── F8App.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── F8Navigator.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── FacebookSDK.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── Playground.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── PushNotificationsController.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── actions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── config.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── filter.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── index.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── installation.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── login.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── navigation.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── notifications.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── parse.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── schedule.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── surveys.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── types.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── common&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── BackButtonIcon.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Carousel.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Button.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Colors.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8DrawerLayout.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Header.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8PageControl.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8SegmentedControl.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8StyleSheet.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Text.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Touchable.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── ItemsWithSeparator.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── ListContainer.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── LoginButton.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── MapView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── ParallaxBackground.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── ProfilePicture.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── PureListView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── ViewPager.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── env.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── filter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FilterScreen.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FriendsList.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Header.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Section.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── TopicItem.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── flow-lib.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── login&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── LoginModal.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── LoginScreen.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── rating&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Header.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── RatingCard.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── RatingQuestion.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── RatingScreen.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── reducers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── __mocks__&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── parse.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── __tests__&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── maps-test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   ├── notifications-test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   │   └── schedule-test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── config.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── createParseReducer.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── filter.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── friendsSchedules.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── index.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── maps.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── navigation.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── notifications.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── schedule.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── sessions.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── surveys.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── topics.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── user.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── setup.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── store&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── analytics.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── array.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── configureStore.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── promise.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── track.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── tabs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── F8TabsView.android.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── F8TabsView.ios.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── MenuItem.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── info&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── CommonQuestions.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── F8InfoView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── LinksList.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── Section.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── ThirdPartyNotices.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── WiFiDetails.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   └── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── maps&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── F8MapView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── ZoomableImage.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   └── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── notifications&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── F8NotificationsView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── NotificationCell.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── PushNUXModal.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── RateSessionsCell.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── allNotifications.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── findSessionByURI.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   ├── img&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    │   └── unseenNotificationsCount.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    └── schedule&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── AddToScheduleButton.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── EmptySchedule.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── F8FriendGoing.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── F8SessionCell.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── F8SessionDetails.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── F8SpeakerProfile.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── FilterHeader.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── FriendCell.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── FriendsListView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── FriendsScheduleView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── FriendsUsingApp.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── GeneralScheduleView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── InviteFriendsButton.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── MyScheduleView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── ProfileButton.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── ScheduleListView.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── SessionsCarousel.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── SessionsSectionHeader.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── SharingSettingsCommon.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── SharingSettingsModal.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── SharingSettingsScreen.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── __tests__&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        │   ├── formatDuration-test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        │   └── formatTime-test.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── filterSessions.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── formatDuration.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── formatTime.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ├── groupSessions.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        └── img&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;js部分的代码理解起来还是比较困难的，首先要熟悉javascript ES6，React Native和Redux的常见语法，还需要弄明白redux-react，redux-promise，redux-thunk等插件的作用和原理，否则直接看代码会很困难，主要涉及的新概念比较多，语法比较奇怪。&lt;/p&gt;
&lt;p&gt;Redux - 架构上深受 flux 启发，实现上却更接近于 elm，或者说更倾向于函数式编程的一个数据层实现。和 flux 架构对数据层的描述最大的区别就在于 Redux 是采用不可变单一状态树来管理应用程序数据的。用 redux 充当数据层也可以完全兼容 flux 架构（但没好处）并且 redux 对视图层也没有倾向性，只是目前用的比较多的还是 react。redux使用了很多函数式编程的概念，例如柯里化等的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;actions目录下的js实现了业务层的逻辑。&lt;/li&gt;
&lt;li&gt;common目录下是抽取的一些UI组件，react是基于组件化编程的。&lt;/li&gt;
&lt;li&gt;filter目录下是一些UI组件页面，暂时没有想明白为什么叫filter&lt;/li&gt;
&lt;li&gt;login目录下是登录页面，提供了通过Facebook帐号登录F8app的功能&lt;/li&gt;
&lt;li&gt;rating目录下是投票和问卷相关的页面&lt;/li&gt;
&lt;li&gt;reduces目录是redux Reducer相关的文件。Redux有且只有一个State状态树，为了避免这个状态树变得越来越复杂，Redux通过 Reducers来负责管理整个应用的State树，而Reducers可以被分成一个个Reducer。&lt;/li&gt;
&lt;li&gt;store目录下是redux store相关的文件&lt;/li&gt;
&lt;li&gt;tabs目录下是App 4个tab页面的源文件&lt;br&gt;整个目录结构划分还是比较合理的。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;理解Redux&quot;&gt;&lt;a href=&quot;#理解Redux&quot; class=&quot;headerlink&quot; title=&quot;理解Redux&quot;&gt;&lt;/a&gt;理解Redux&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/f4f5fcf054e71726639f211aa19daa06.png&quot; alt=&quot;redux&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面是知乎上对Redux的一个比较好的解释,弄明白了Redux我们才有能力分析f8app js的代码。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;理解 React，但不理解 Redux，该如何通俗易懂的理解 Redux？&lt;br&gt;解答这个问题并不困难：唯一的要求是你熟悉React。&lt;br&gt;不要光听别人描述名词，理解起来是很困难的。&lt;br&gt;从需求出发，看看使用React需要什么：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;React有props和state: props意味着父级分发下来的属性，state意味着组件内部可以自行管理的状态，并且整个React没有数据向上回溯的能力，也就是说数据只能单向向下分发，或者自行内部消化。&lt;br&gt;理解这个是理解React和Redux的前提。&lt;/li&gt;
&lt;li&gt;一般构建的React组件内部可能是一个完整的应用，它自己工作良好，你可以通过属性作为API控制它。但是更多的时候发现React根本无法让两个组件互相交流，使用对方的数据。&lt;br&gt;然后这时候不通过DOM沟通（也就是React体制内）解决的唯一办法就是提升state，将state放到共有的父组件中来管理，再作为props分发回子组件。&lt;/li&gt;
&lt;li&gt;子组件改变父组件state的办法只能是通过onClick触发父组件声明好的回调，也就是父组件提前声明好函数或方法作为契约描述自己的state将如何变化，再将它同样作为属性交给子组件使用。&lt;br&gt;这样就出现了一个模式：数据总是单向从顶层向下分发的，但是只有子组件回调在概念上可以回到state顶层影响数据。这样state一定程度上是响应式的。&lt;/li&gt;
&lt;li&gt;为了面临所有可能的扩展问题，最容易想到的办法就是把所有state集中放到所有组件顶层，然后分发给所有组件。&lt;/li&gt;
&lt;li&gt;为了有更好的state管理，就需要一个库来作为更专业的顶层state分发给所有React应用，这就是Redux。让我们回来看看重现上面结构的需求：&lt;br&gt;a. 需要回调通知state (等同于回调参数) -&amp;gt; action&lt;br&gt;b. 需要根据回调处理 (等同于父级方法) -&amp;gt; reducer&lt;br&gt;c. 需要state (等同于总状态) -&amp;gt; store&lt;br&gt;对Redux来说只有这三个要素：&lt;br&gt;a. action是纯声明式的数据结构，只提供事件的所有要素，不提供逻辑。&lt;br&gt;b. reducer是一个匹配函数，action的发送是全局的：所有的reducer都可以捕捉到并匹配与自己相关与否，相关就拿走action中的要素进行逻辑处理，修改store中的状态，不相关就不对state做处理原样返回。&lt;br&gt;c. store负责存储状态并可以被react api回调，发布action.&lt;br&gt;当然一般不会直接把两个库拿来用，还有一个binding叫react-redux, 提供一个Provider和connect。很多人其实看懂了redux卡在这里。&lt;br&gt;a. Provider是一个普通组件，可以作为顶层app的分发点，它只需要store属性就可以了。它会将state分发给所有被connect的组件，不管它在哪里，被嵌套多少层。&lt;br&gt;b. connect是真正的重点，它是一个科里化函数，意思是先接受两个参数（数据绑定mapStateToProps和事件绑定mapDispatchToProps），再接受一个参数（将要绑定的组件本身）：&lt;br&gt;mapStateToProps：构建好Redux系统的时候，它会被自动初始化，但是你的React组件并不知道它的存在，因此你需要分拣出你需要的Redux状态，所以你需要绑定一个函数，它的参数是state，简单返回你关心的几个值。&lt;br&gt;mapDispatchToProps：声明好的action作为回调，也可以被注入到组件里，就是通过这个函数，它的参数是dispatch，通过redux的辅助方法bindActionCreator绑定所有action以及参数的dispatch，就可以作为属性在组件里面作为函数简单使用了，不需要手动dispatch。这个mapDispatchToProps是可选的，如果不传这个参数redux会简单把dispatch作为属性注入给组件，可以手动当做store.dispatch使用。这也是为什么要科里化的原因。&lt;br&gt;做好以上流程Redux和React就可以工作了。简单地说就是：&lt;br&gt;1.顶层分发状态，让React组件被动地渲染。&lt;br&gt;2.监听事件，事件有权利回到所有状态顶层影响状态。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;和 Flux 一样，Redux 让应用的状态变化变得更加可预测。如果你想改变应用的状态，就必须 dispatch 一个 action。你没有办法直接改变应用的状态，因为保存这些状态的东西（称为 store）只有 getter 而没有 setter。对于 Flux 和 Redux 来说，这些概念都是相似的。&lt;/p&gt;
&lt;p&gt;那么为什么要新设计一种架构呢？Redux 的创造者 Dan Abramov 发现了改进 Flux 架构的可能。他想要一个更好的开发者工具来调试 Flux 应用。他发现如果稍微对 Flux 架构进行一些调整，就可以开发出一款更好用的开发者工具，同时依然能享受 Flux 架构带给你的可预测性。&lt;/p&gt;
&lt;p&gt;Redux包含了代码热替换（hot reload）和时间旅行（time travel）功能。&lt;/p&gt;
&lt;h2 id=&quot;智能组件（smart-components）和木偶组件-dumb-components&quot;&gt;&lt;a href=&quot;#智能组件（smart-components）和木偶组件-dumb-components&quot; class=&quot;headerlink&quot; title=&quot;智能组件（smart components）和木偶组件(dumb components)&quot;&gt;&lt;/a&gt;智能组件（smart components）和木偶组件(dumb components)&lt;/h2&gt;&lt;p&gt;Flux 拥有控制型视图（controller views） 和常规型视图（regular views）。控制型视图就像是一个经理一样，管理着 store 和子视图（child views）之间的通信。&lt;/p&gt;
&lt;p&gt;在 Redux 中，也有一个类似的概念：智能组件和木偶组件。（注：在最新的 Redux 文档中，它们分别叫做容器型组件 Container component 和展示型组件 Presentational component）智能组件的职责就像经理一样，但是比起 Flux 中的角色，Redux 对经理的职责有了更多的定义：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;智能组件负责所有的 action 相关的工作。如果智能组件里包含的一个木偶组件需要触发一个 action，智能组件会通过 props 传一个 function 给木偶组件，而木偶组件可以在需要触发 action 时调用这个 function。&lt;/li&gt;
&lt;li&gt;智能组件不定义 CSS 样式。&lt;/li&gt;
&lt;li&gt;智能组件几乎不会产生自己的 DOM 节点，他的工作是组织若干的木偶组件，由木偶组件来生成最终的 DOM 节点。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;redux-thunk-介绍&quot;&gt;&lt;a href=&quot;#redux-thunk-介绍&quot; class=&quot;headerlink&quot; title=&quot;redux-thunk 介绍&quot;&gt;&lt;/a&gt;redux-thunk 介绍&lt;/h2&gt;&lt;p&gt;先贴官网链接：&lt;a href=&quot;https://github.com/gaearon/redux-thunk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/gaearon/redux-thunk&lt;/a&gt;&lt;br&gt;Thunk的做法就是扩展了这个action creator。&lt;br&gt;Redux官网说，action就是Plain JavaScript Object。Thunk允许action creator返回一个函数，而且这个函数第一个参数是dispatch。&lt;br&gt;A &lt;a href=&quot;https://en.wikipedia.org/wiki/Thunk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;thunk&lt;/a&gt; is a function that wraps an expression to delay its evaluation.&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// calculation of 1 + 2 is immediate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// x === 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; x = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// calculation of 1 + 2 is delayed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// foo can be called later to perform the calculation&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// foo is a thunk!&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; foo = () =&amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;setup-js代码分析&quot;&gt;&lt;a href=&quot;#setup-js代码分析&quot; class=&quot;headerlink&quot; title=&quot;setup.js代码分析&quot;&gt;&lt;/a&gt;setup.js代码分析&lt;/h2&gt;&lt;p&gt;熟悉React Native都知道，index.android.js和index.ios.js分别是Android和iOS App的js程序入口，当然实际运行是压缩处理后的jsbundle。这个2个文件都是注册了setup组件，&lt;code&gt;AppRegistry.registerComponent(&amp;#39;F8v2&amp;#39;, setup);&lt;/code&gt;。&lt;br&gt;setup.js负责配置其它的组件,具体代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//js/setup.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; F8App = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;F8App&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; FacebookSDK = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;FacebookSDK&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; Parse = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;parse/react-native&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; React = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;React&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; Relay = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react-relay&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; &amp;#123; Provider &amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react-redux&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; configureStore = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./store/configureStore&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; &amp;#123;serverURL&amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./env&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setup&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;): &lt;span class=&quot;title&quot;&gt;React&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Component&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.disableYellowBox = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Parse.initialize(&lt;span class=&quot;string&quot;&gt;&#39;oss-f8-app-2016&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Parse.serverURL = &lt;span class=&quot;string&quot;&gt;`&lt;span class=&quot;subst&quot;&gt;$&amp;#123;serverURL&amp;#125;&lt;/span&gt;/parse`&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  FacebookSDK.init();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Parse.FacebookUtils.init();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Relay.injectNetworkLayer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Relay.DefaultNetworkLayer(&lt;span class=&quot;string&quot;&gt;`&lt;span class=&quot;subst&quot;&gt;$&amp;#123;serverURL&amp;#125;&lt;/span&gt;/graphql`&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      fetchTimeout: &lt;span class=&quot;number&quot;&gt;30000&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      retryDelays: [&lt;span class=&quot;number&quot;&gt;5000&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Root&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;React&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Component&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;constructor&lt;/span&gt;() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.state = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        isLoading: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        store: configureStore(() =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.setState(&amp;#123;isLoading: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&amp;#125;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    render() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.state.isLoading) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;Provider&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;store&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;#123;this.state.store&amp;#125;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;F8App&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;Provider&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Root;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;global.LOG = (...args) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;/------------------------------\\&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(...args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;\\------------------------------/&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; args[args.length - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = setup;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;setup.js负责对整个app进行配置，首先配置了Parse,FacebookSDK和Relay，这3个组件是服务器端相关的。&lt;br&gt;然后通过react-redux配置了Provider组件，这个组件包裹在整个组件树的最外层。这个组件让根组件的所有子孙组件能够轻松的使用 connect() 方法绑定 store。Provider 本质上创建了一个用于更新视图组件的网络。那些智能组件通过 connect() 方法连入这个网络，以此确保他们能够获取到状态的更新。&lt;br&gt;configureStore提供了对Store的创建和配置，由于Redux只有一个store，如果让store 完全独立处理自己的事，store会变的很复杂。因此，Redux 中的 store 首先会保存整个应用的所有状态，然后将「判断哪一部分状态需要改变」的任务分配下去。而以根 reducer（root reducer）为首的 reducer 们将会承担这个任务。&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ./js/store/configureStore.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; &amp;#123;applyMiddleware, createStore&amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;redux&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; thunk = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;redux-thunk&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; promise = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./promise&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; array = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./array&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; analytics = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./analytics&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; reducers = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;../reducers&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; createLogger = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;redux-logger&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; &amp;#123;persistStore, autoRehydrate&amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;redux-persist&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; &amp;#123;AsyncStorage&amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;react-native&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; isDebuggingInChrome = __DEV__ &amp;amp;&amp;amp; !!&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.navigator.userAgent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; logger = createLogger(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  predicate: (getState, action) =&amp;gt; isDebuggingInChrome,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  collapsed: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  duration: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; createF8Store = applyMiddleware(thunk, promise, array, analytics, logger)(createStore);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;configureStore&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;onComplete: ?(&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;title&quot;&gt;void&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// TODO(frantic): reconsider usage of redux-persist, maybe add cache breaker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; store = autoRehydrate()(createF8Store)(reducers);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  persistStore(store, &amp;#123;storage: AsyncStorage&amp;#125;, onComplete);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isDebuggingInChrome) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.store = store;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; store;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = configureStore;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;createF8Store使用了柯里化方法调用了applyMiddleware，&lt;a href=&quot;http://redux.js.org/docs/advanced/Middleware.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;middleware&lt;/a&gt;我们可以简单的理解成过滤器，作用就是加入一些中间处理过程。最后返回store对象。&lt;/p&gt;
&lt;h2 id=&quot;用户登录流程代码分析&quot;&gt;&lt;a href=&quot;#用户登录流程代码分析&quot; class=&quot;headerlink&quot; title=&quot;用户登录流程代码分析&quot;&gt;&lt;/a&gt;用户登录流程代码分析&lt;/h2&gt;&lt;p&gt;下面分析登录页面的代码，代码在&lt;code&gt;login&lt;/code&gt;目录下，包括LoginModal.js和LoginScreen.js，实现了通过Oauth登录Facebook帐号的功能。&lt;br&gt;登录涉及的代码有actions/types.js(定义了所有的Action事件), actions/login.js（实现登录业务逻辑，与服务器交互），js/reducers/user.js(实现对用户相关状态的计算)。&lt;br&gt;登录的入口是js/tabs/schedule/logIn.js，142行定义了&lt;code&gt;&amp;lt;LoginButton source=&amp;quot;My F8&amp;quot; /&amp;gt;&lt;/code&gt; ,LoginButton组件封装了登录UI相关的逻辑。&lt;br&gt;点击LoginButton后会调用logIn函数，logIn函数会调用logInWithFacebook进行OAuth登录或在等待15s后超时返回，下面是logIn的代码：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; logIn() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123;dispatch, onLoggedIn&amp;#125; = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.setState(&amp;#123;isLoading: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;Promise&lt;/span&gt;.race([&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      dispatch(logInWithFacebook(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.props.source)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      timeout(&lt;span class=&quot;number&quot;&gt;15000&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; message = e.message || e;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (message !== &lt;span class=&quot;string&quot;&gt;&#39;Timed out&#39;&lt;/span&gt; &amp;amp;&amp;amp; message !== &lt;span class=&quot;string&quot;&gt;&#39;Canceled by user&#39;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      alert(message);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.warn(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._isMounted &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.setState(&amp;#123;isLoading: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  onLoggedIn &amp;amp;&amp;amp; onLoggedIn();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;用到了async，Promise.race等ES6的语法。&lt;br&gt;logInWithFacebook的实现在js/actions/login.js中，如果登录成功会通过Promise异步获取好友的日程和调查问卷。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;function logInWithFacebook(source: ?string): ThunkAction &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  return (dispatch) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    const login = _logInWithFacebook(source);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Loading friends schedules shouldn&amp;apos;t block the login process&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    login.then(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      (result) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dispatch(result);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dispatch(loadFriendsSchedules());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dispatch(loadSurveys());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return login;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;登录是调用Facebook SDK进行登录，logInWithFacebook是个异步方法，用到了ES6的async，&lt;br&gt;&lt;code&gt;async function _logInWithFacebook(source: ?string): Promise&amp;lt;Array&amp;lt;Action&amp;gt;&amp;gt; {...}&lt;/code&gt;，&lt;br&gt;返回值是个Promise，在then方面里面异步调用loadFriendsSchedules，loadSurveys。&lt;br&gt;这些方法会继续请求数据，并更新store，从而让页面更新。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;js部分的代码用了很多ES6的新语法和函数式编程思想，特别是使用了Redux框架，代码量也比较大，分析和理解起来比较困难，本文只分析了部分典型模块的代码。特别是在相关的技术和框架了解程度不够深入，缺少实际开发经验的情况下（这说的就是我自己啊）。建议看代码之前先把JavaScript ES6和Redux框架好好学习一下。虽然代码看上去很难，但整个处理流程和模块划分还是很清晰的。&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/camsong/redux-in-chinese&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Redux 中文文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jasonslyvia/a-cartoon-intro-to-redux-cn&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《看漫画，学 Redux》 —— A cartoon intro to Redux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000004391037&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;redux源码详解&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/matthew-sun/blog/issues/18&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;使用Redux管理你的React应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/41312576&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;理解 React，但不理解 Redux，该如何通俗易懂的理解 Redux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://boke.io/xue-xi-redux-liu-shui-zhang/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;学习 redux.js 的 流水账&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;[本文独立博客地址](&lt;a href=&quot;http://www.offbye.com/）&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.offbye.com/）&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本文开始分析f8app核心js部分的源码，这篇文章将非常难理解，原因了Redux框架引入了很多新概念，使用了大量函数式编程思想，建议先把后面的参考文章仔细过一遍，确保理解后再看本文。React Native的理念是Learn once,write anywhere, Android和iOS App端的js代码是放在一起的，以便最大限度的复用业务逻辑，UI部分的可以根据平台特性各自实现，React native分别渲染成安卓和iOS的原生UI界面，对于两个平台UI组件的细微差异和完全不同的UI组件2种情况，react native提供了不同的处理方式。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>F8App-ReactNative项目源码分析3-Android</title>
    <link href="http://offbye.com/2016/05/19/F8App-ReactNative%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%903-Android/"/>
    <id>http://offbye.com/2016/05/19/F8App-ReactNative项目源码分析3-Android/</id>
    <published>2016-05-19T02:16:34.000Z</published>
    <updated>2016-05-20T14:59:26.000Z</updated>
    
    <content type="html">&lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;本文分析f8app android代码的结构和技术实现，阅读本文的前提是熟悉Android开发。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;f8app-android代码结构分析&quot;&gt;&lt;a href=&quot;#f8app-android代码结构分析&quot; class=&quot;headerlink&quot; title=&quot;f8app android代码结构分析&quot;&gt;&lt;/a&gt;f8app android代码结构分析&lt;/h2&gt;&lt;p&gt;ReactNative项目Android相关的代码都在android目录下，可以直接使用Android Studio打开这个目录方便查看和修改。android目录结构如下&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;├── F8v2.iml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── app&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── app.iml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── proguard-rules.pro&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── react.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── src&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       └── main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           ├── AndroidManifest.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           ├── java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           │   └── com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           │       └── facebook&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           │           └── f8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           │               └── MainActivity.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│           └── res&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── mipmap-hdpi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   ├── ic_launcher.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── ic_notification.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── mipmap-mdpi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   ├── ic_launcher.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── ic_notification.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── mipmap-xhdpi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   ├── ic_launcher.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── ic_notification.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── mipmap-xxhdpi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   ├── ic_launcher.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── ic_notification.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── mipmap-xxxhdpi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   ├── ic_launcher.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── ic_notification.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               ├── raw&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               │   └── third_party_notices.html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│               └── values&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│                   ├── strings.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│                   └── styles.xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── wrapper&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       ├── gradle-wrapper.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       └── gradle-wrapper.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── gradle.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── gradlew&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── gradlew.bat&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── local.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── settings.gradle&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在android Studio下显示如下：&lt;br&gt;￼&lt;br&gt;&lt;img src=&quot;http://o79096vir.bkt.clouddn.com/667c005f394c5c8cf85833ca5c5718f3.png&quot; alt=&quot;as文件结构&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;MainActivity-代码分析&quot;&gt;&lt;a href=&quot;#MainActivity-代码分析&quot; class=&quot;headerlink&quot; title=&quot;MainActivity 代码分析&quot;&gt;&lt;/a&gt;MainActivity 代码分析&lt;/h2&gt;&lt;p&gt;通过AndroidManifest.xml可以知道App的页面入口Activity是android/app/src/main/java/com/facebook/f8/MainActivity.java，代码比较简单，继承了ReactActivity,关键的方法是getJSBundleFile，可以看到使用了CodePush推送更新技术，返回了一个bundle文件，分析代码可知默认的bundle文件是index.android.bundle。&lt;br&gt;&lt;a href=&quot;http://microsoft.github.io/code-push//docs/getting-started.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CodePush&lt;/a&gt;是微软提供的一个开发者服务，支持对React Native和Cordova App在不重新安装App的前提下热更新App，是目前很流行的一种App热部署技术。&lt;br&gt;getPackages方法初始化了CodePush，初始了ReactNativePushNotificationPackage推送服务，初始化了用到的一些RN第三方包：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FBSDKPackage是Android Facebook SDK的React Native封装，让React Native App能够使用Facebook的接口，提供了Facebook用户登录token，分享等功能;&lt;/li&gt;
&lt;li&gt;LinearGradientPackage是一个渐变UI控件；&lt;/li&gt;
&lt;li&gt;RNSharePackage是个分享插件，提供了通过Android Intent.ACTION_SEND分享文字和链接的简单分享功能；&lt;/li&gt;
&lt;li&gt;RNSendIntentPackage是一个发送Android Intent的插件，提供了通过Intent拨打电话，发送短信，在系统日历添加事件提醒等功能。&lt;/li&gt;
&lt;li&gt;ReactNativePushNotificationPackage是一个本地和远程通知推送插件，可以接受Google GCM推送的消息，并在状态栏上显示。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReactActivity&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; CodePush _codePush;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; ReactNativePushNotificationPackage _pushNotification;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; CallbackManager mCallbackManager;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getJSBundleFile&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._codePush.getBundleUrl(&lt;span class=&quot;string&quot;&gt;&quot;index.android.bundle&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Returns the name of the main component registered from JavaScript.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * This is used to schedule rendering of the component.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getMainComponentName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;F8v2&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * Returns whether dev mode should be enabled.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     * This enables e.g. the dev menu.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getUseDeveloperSupport&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; BuildConfig.DEBUG;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * A list of packages used by the app. If the app uses additional views&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * or modules besides the default ones, add more packages here.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; List&amp;lt;ReactPackage&amp;gt; &lt;span class=&quot;title&quot;&gt;getPackages&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._codePush = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CodePush(&lt;span class=&quot;string&quot;&gt;&quot;qwfkzzq7Y8cSrkiuU7aRCkIP7XYLEJ6b-AFoe&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, BuildConfig.DEBUG);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._pushNotification = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ReactNativePushNotificationPackage(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      mCallbackManager = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CallbackManager.Factory().create();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Arrays.&amp;lt;ReactPackage&amp;gt;asList(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MainReactPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FBSDKPackage(mCallbackManager),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearGradientPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RNSharePackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RNSendIntentPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._codePush.getReactPackage(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._pushNotification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        FacebookSdk.sdkInitialize(getApplicationContext());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      mCallbackManager.onActivityResult(requestCode, resultCode, data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNewIntent&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(Intent intent)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onNewIntent(intent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     _pushNotification.newIntent(intent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onResume();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AppEventsLogger.activateApp(getApplicationContext());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onPause&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onPause();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AppEventsLogger.deactivateApp(getApplicationContext());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onStop&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onStop();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      AppEventsLogger.onContextStop();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以查看settings.gradle,发现f8app Android引用了5个子工程，子工程源码放在../node_modules目录下。&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rootProject.name = &lt;span class=&quot;string&quot;&gt;&#39;F8v2&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:app&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;:react-native-linear-gradient&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:app&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;:react-native-code-push&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:react-native-push-notification&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:react-native-share&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;:app&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:react-native-fbsdk&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;:react-native-send-intent&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;:app&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-linear-gradient&#39;&lt;/span&gt;).projectDir = new File(rootProject.projectDir, &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-linear-gradient/android&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-code-push&#39;&lt;/span&gt;).projectDir = new File(rootProject.projectDir, &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-code-push/android/app&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-push-notification&#39;&lt;/span&gt;).projectDir = file(&lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-push-notification/RNPushNotificationAndroid&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-share&#39;&lt;/span&gt;).projectDir = new File(rootProject.projectDir, &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-share/android&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-fbsdk&#39;&lt;/span&gt;).projectDir = new File(settingsDir, &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-fbsdk/Android&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;project(&lt;span class=&quot;string&quot;&gt;&#39;:react-native-send-intent&#39;&lt;/span&gt;).projectDir = new File(rootProject.projectDir, &lt;span class=&quot;string&quot;&gt;&#39;../node_modules/react-native-send-intent&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到，可以通在settings.gradle引入工程的方法增加新的自定义RN插件。实际上，这些插件是通过rnpm install命令安装的。&lt;a href=&quot;https://github.com/rnpm/rnpm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;React Native Package Manager (RNPM)&lt;/a&gt; 是一个简化React Native插件安装体验的工具。&lt;br&gt;下面我们分析react-native-linear-gradient插件看看插件是如何实现的。&lt;/p&gt;
&lt;h2 id=&quot;React-Native-android-插件实现分析&quot;&gt;&lt;a href=&quot;#React-Native-android-插件实现分析&quot; class=&quot;headerlink&quot; title=&quot;React Native android 插件实现分析&quot;&gt;&lt;/a&gt;React Native android 插件实现分析&lt;/h2&gt;&lt;p&gt;LinearGradientView是一个典型的原生UI插件，可以先看看官方的文档&lt;a href=&quot;https://github.com/facebook/react-native/blob/master/docs/NativeComponentsAndroid.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NativeComponentsAndroid&lt;/a&gt;， 我感觉这个文档有点过时，没有提到ReactPackage。ReactPackage接口是现在RN插件的主入口。LinearGradientPackage实现了ReactPackage接口&lt;br&gt;ReactPackage接口代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Main interface for providing additional capabilities to the catalyst framework by couple of&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * different means:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * 1) Registering new native modules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * 2) Registering new JS modules that may be accessed from native modules or from other parts of the&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * native code (requiring JS modules from the package doesn&#39;t mean it will automatically be included&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * as a part of the JS bundle, so there should be a corresponding piece of code on JS side that will&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * require implementation of that JS module so that it gets bundled)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * 3) Registering custom native views (view managers) and custom event types&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * 4) Registering natively packaged assets/resources (e.g. images) exposed to JS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * TODO(6788500, 6788507): Implement support for adding custom views, events and resources&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReactPackage&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; reactContext react application context that can be used to create modules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; list of native modules to register with the newly created catalyst instance&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;List&amp;lt;NativeModule&amp;gt; &lt;span class=&quot;title&quot;&gt;createNativeModules&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ReactApplicationContext reactContext)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; list of JS modules to register with the newly created catalyst instance.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * IMPORTANT: Note that only modules that needs to be accessible from the native code should be&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * listed here. Also listing a native module here doesn&#39;t imply that the JS implementation of it&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * will be automatically included in the JS bundle.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  List&amp;lt;Class&amp;lt;? extends JavaScriptModule&amp;gt;&amp;gt; createJSModules();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; a list of view managers that should be registered with &amp;#123;&lt;span class=&quot;doctag&quot;&gt;@link&lt;/span&gt; UIManagerModule&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;List&amp;lt;ViewManager&amp;gt; &lt;span class=&quot;title&quot;&gt;createViewManagers&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ReactApplicationContext reactContext)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;LinearGradientPackage类主要实现了createViewManagers方法，返回了一个LinearGradientManager实例，代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LinearGradientPackage&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReactPackage&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;NativeModule&amp;gt; &lt;span class=&quot;title&quot;&gt;createNativeModules&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ReactApplicationContext reactContext)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Collections.emptyList();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;Class&amp;lt;? extends JavaScriptModule&amp;gt;&amp;gt; createJSModules() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Collections.emptyList();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;ViewManager&amp;gt; &lt;span class=&quot;title&quot;&gt;createViewManagers&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ReactApplicationContext reactContext)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Arrays.&amp;lt;ViewManager&amp;gt;asList(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearGradientManager());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;下面看LinearGradientManager类，包含了一个LinearGradientView实例，LinearGradientView是渐变View的具体实现，通过@ReactProp注解可以在js层设置渐变View的一些属性，例如渐变颜色，渐变开始和结束位置等的。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;LinearGradientManager&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SimpleViewManager&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;LinearGradientView&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String REACT_CLASS = &lt;span class=&quot;string&quot;&gt;&quot;BVLinearGradient&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String PROP_COLORS = &lt;span class=&quot;string&quot;&gt;&quot;colors&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String PROP_LOCATIONS = &lt;span class=&quot;string&quot;&gt;&quot;locations&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String PROP_START_POS = &lt;span class=&quot;string&quot;&gt;&quot;start&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String PROP_END_POS = &lt;span class=&quot;string&quot;&gt;&quot;end&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String PROP_BORDER_RADIUS = &lt;span class=&quot;string&quot;&gt;&quot;borderRadius&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; REACT_CLASS;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; LinearGradientView &lt;span class=&quot;title&quot;&gt;createViewInstance&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ThemedReactContext context)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearGradientView(context);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@ReactProp&lt;/span&gt;(name=PROP_COLORS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setColors&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LinearGradientView gradientView, ReadableArray colors)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gradientView.setColors(colors);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@ReactProp&lt;/span&gt;(name=PROP_LOCATIONS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setLocations&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LinearGradientView gradientView, ReadableArray locations)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gradientView.setLocations(locations);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@ReactProp&lt;/span&gt;(name=PROP_START_POS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setStartPosition&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LinearGradientView gradientView, ReadableArray startPos)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gradientView.setStartPosition(startPos);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@ReactProp&lt;/span&gt;(name=PROP_END_POS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setEndPosition&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LinearGradientView gradientView, ReadableArray endPos)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gradientView.setEndPosition(endPos);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// temporary solution until following issue is resolved:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// https://github.com/facebook/react-native/issues/3198&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@ReactProp&lt;/span&gt;(name=PROP_BORDER_RADIUS, defaultFloat = &lt;span class=&quot;number&quot;&gt;0f&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setBorderRadius&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(LinearGradientView gradientView, &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; borderRadius)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gradientView.setBorderRadius(PixelUtil.toPixelFromDIP(borderRadius));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;CodePush-热更新技术介绍&quot;&gt;&lt;a href=&quot;#CodePush-热更新技术介绍&quot; class=&quot;headerlink&quot; title=&quot;CodePush 热更新技术介绍&quot;&gt;&lt;/a&gt;CodePush 热更新技术介绍&lt;/h2&gt;&lt;p&gt;f8app使用了CodePush技术热更新App，可以先看下微软官方的文档&lt;a href=&quot;http://microsoft.github.io/code-push/docs/react-native.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;React Native Client SDK&lt;/a&gt;。&lt;br&gt;CodePush提供了对React Native App的热更新能力，目前只能对js bundle进行热更新，如果原生代码修改了是不能热更新的，只能通过重新安装App的方式升级。&lt;br&gt;CodePush的一个问题是是对React Native版本的兼容性，由于React Native版本更新很快，CodePush是由微软而不是Facebook维护的，所以对React Native0.18以前的版本支持有各种兼容问题，具体参考&lt;a href=&quot;http://microsoft.github.io/code-push/docs/react-native.html#link-1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;文档&lt;/a&gt;。&lt;br&gt;CodePush的具体配置可以参考&lt;a href=&quot;http://bbs.reactnative.cn/topic/725/code-push-%E7%83%AD%E6%9B%B4%E6%96%B0%E4%BD%BF%E7%94%A8%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E5%92%8C%E6%95%99%E7%A8%8B/2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇文章&lt;/a&gt;,配置需要注意的事项还是挺多的，我参考这篇文章配置成功了，本文不做详细介绍。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;本文分析了f8app android代码结构，以react-native-linear-gradient插件为例子分析了React Native插件的结构，介绍了CodePush热更新技术，通过本文可以对f8app有比较初步的认识。&lt;br&gt;下篇文章将分析React Native js代码，这块是f8app的核心实现，代码量比较大。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;本文分析f8app android代码的结构和技术实现，阅读本文的前提是熟悉Android开发。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>F8App-ReactNative项目源码分析2-服务器端</title>
    <link href="http://offbye.com/2016/05/18/F8App-ReactNative%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%902-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF/"/>
    <id>http://offbye.com/2016/05/18/F8App-ReactNative项目源码分析2-服务器端/</id>
    <published>2016-05-18T13:37:25.000Z</published>
    <updated>2016-05-20T15:06:41.000Z</updated>
    
    <content type="html">&lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;研究了f8app的项目结构后，发现f8app服务器端的代码比较少，并且弄清楚数据模型和接口协议，对于后面理解客户端的实现有帮助，所以先分析服务器端。第二篇文章会详细分析f8app服务端的技术实现，并进行一些修改实验。f8app服务器端是基于Node.js,Express,Parse和GraphQL实现的，数据存储是MongoDB NoSql数据库。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;安装推荐开发工具nuclide&quot;&gt;&lt;a href=&quot;#安装推荐开发工具nuclide&quot; class=&quot;headerlink&quot; title=&quot;安装推荐开发工具nuclide&quot;&gt;&lt;/a&gt;安装推荐开发工具nuclide&lt;/h2&gt;&lt;p&gt;我们一般使用Atom进行js开发，首先安装facebook推荐的开发工具nuclide。Mac和Linux下的安装命令如下，暂不支持windows。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apm install nuclide&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;F8app工程结构&quot;&gt;&lt;a href=&quot;#F8app工程结构&quot; class=&quot;headerlink&quot; title=&quot;F8app工程结构&quot;&gt;&lt;/a&gt;F8app工程结构&lt;/h2&gt;&lt;p&gt;下面先用&lt;code&gt;tree -L 2&lt;/code&gt; 命令看下目录结构,只显示二级目录&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;├── LICENSE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── README.md&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── android  安卓项目目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── app&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── build.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── gradle.properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── gradlew&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── gradlew.bat&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── settings.gradle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── index.android.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── index.ios.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── ios   iOS项目目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Default-568h@2x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Scrolling.h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Scrolling.m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8v2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8v2.xcodeproj&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8v2.xcworkspace&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8v2Tests&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── PodFile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Podfile.lock&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Pods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Settings.bundle&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Splash@2x.png&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── js    React native js源代码目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8App.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── F8Navigator.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── FacebookSDK.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── Playground.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── PushNotificationsController.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── actions&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── common&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── env.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── filter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── flow-lib.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── login&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── rating&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── reducers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── setup.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── store&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── tabs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── logs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── node_modules&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│       下面有900多个js模块&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── npm-shrinkwrap.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── package.json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├── scripts   一些脚本&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── import-data-from-parse.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   ├── optimize-images.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;│   └── store-ip.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└── server  服务器端目录，基于Parse和GraphiQL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── cloud&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── cloud.js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ├── schema&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    └── server.js&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;服务器端技术介绍&quot;&gt;&lt;a href=&quot;#服务器端技术介绍&quot; class=&quot;headerlink&quot; title=&quot;服务器端技术介绍&quot;&gt;&lt;/a&gt;服务器端技术介绍&lt;/h2&gt;&lt;p&gt;f8app的服务器代码都在server目录下，由于使用了Node.js,Express,Parse，GraphQL等先进框架，代码量比较小,一共只有10个js文件，996行js代码。下面先介绍下f8app服务器端使用的技术，Node.js和Express这类常见技术就不介绍了。&lt;br&gt;服务器端是基于Facebook的Parse云平台，Parse服务将于January 28, 2017停止服务，现在官方提供了迁移指南。&lt;br&gt;现在Parse Server已经开源了，git地址是&lt;a href=&quot;https://github.com/ParsePlatform/parse-server&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;parse-server&lt;/a&gt;,开源Parse Server是基于node.js和Express框架的，支持的数据库是MongoDB和MongoRocks。&lt;br&gt;&lt;code&gt;script/import-data-from-parse.js&lt;/code&gt;实现了从&lt;a href=&quot;https://api.parse.com/1/classes/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://api.parse.com/1/classes/&lt;/a&gt; 导入数据到本地MongoDB数据库的功能，通过&lt;code&gt;npm run import-data&lt;/code&gt; 可以导入数据。&lt;/p&gt;
&lt;h2 id=&quot;MongoRocks-What-and-Why&quot;&gt;&lt;a href=&quot;#MongoRocks-What-and-Why&quot; class=&quot;headerlink&quot; title=&quot;MongoRocks: What and Why?&quot;&gt;&lt;/a&gt;MongoRocks: What and Why?&lt;/h2&gt;&lt;p&gt;MongoRocks是Facebook在2015年开发的基于RocksDB的MongoDB存储引擎实现，一般情况下Parse应用都应该用MongoRocks。&lt;br&gt;MongoDB3.0允许用户替换默认的default memory mapped (MMAP) 存储引擎。MongoRocks比MMAP存储引擎在性能方面有很多好处，&lt;br&gt;MongoRocks更多介绍可以参考&lt;a href=&quot;https://github.com/ParsePlatform/parse-server/wiki/MongoRocks&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MongoRocks链接&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Parse-Server简单介绍&quot;&gt;&lt;a href=&quot;#Parse-Server简单介绍&quot; class=&quot;headerlink&quot; title=&quot;Parse Server简单介绍&quot;&gt;&lt;/a&gt;Parse Server简单介绍&lt;/h2&gt;&lt;p&gt;Parse 的愿景是让开发者摆脱服务器，随心所欲地开发各种移动应用程序。对于比较复杂的应用程序，开发者有时需要不在移动设备上运行的逻辑。Cloud Code 正好可以实现这一目标。&lt;br&gt;由于f8app已经带了Parse Server，所以我就不需要用npm安装了，直接在f8app目录下运行npm start，测试下添加数据&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-H &amp;quot;X-Parse-Application-Id: oss-f8-app-2016&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-H &amp;quot;Content-Type: application/json&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-d &amp;apos;&amp;#123;&amp;quot;score&amp;quot;:1337,&amp;quot;playerName&amp;quot;:&amp;quot;Sean Plott&amp;quot;,&amp;quot;cheatMode&amp;quot;:false&amp;#125;&amp;apos; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http://localhost:8080/parse/classes/GameScore&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在终端运行上面的命令后,服务端返回 &lt;code&gt;{&amp;quot;objectId&amp;quot;:&amp;quot;S8mgRPVgwU&amp;quot;,&amp;quot;createdAt&amp;quot;:&amp;quot;2016-05-17T08:31:10.802Z&amp;quot;}&lt;/code&gt; 表示添加成功&lt;br&gt;在浏览器&lt;a href=&quot;http://localhost:8080/dashboard/apps/F8-App-2016/browser/GameScore&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;/a&gt;,可以看到刚才添加了一条Game score数据。&lt;/p&gt;
&lt;p&gt;在终端运行下面命令可以查询新添加的那条数据&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X GET \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; -H &amp;quot;X-Parse-Application-Id: oss-f8-app-2016&amp;quot; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; http://localhost:8080/parse/classes/GameScore/S8mgRPVgwU&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;返回结果 &lt;code&gt;{&amp;quot;objectId&amp;quot;:&amp;quot;S8mgRPVgwU&amp;quot;,&amp;quot;score&amp;quot;:1337,&amp;quot;playerName&amp;quot;:&amp;quot;Sean Plott&amp;quot;,&amp;quot;cheatMode&amp;quot;:false,&amp;quot;updatedAt&amp;quot;:&amp;quot;2016-05-17T08:31:10.802Z&amp;quot;&lt;/code&gt;&lt;br&gt;Parse提供各种语言的SDK，包括Android，iOS，js等，可以很方便的在移动端使用。&lt;/p&gt;
&lt;h2 id=&quot;Relay和GraphQL&quot;&gt;&lt;a href=&quot;#Relay和GraphQL&quot; class=&quot;headerlink&quot; title=&quot;Relay和GraphQL&quot;&gt;&lt;/a&gt;Relay和GraphQL&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://facebook.github.io/relay/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Relay&lt;/a&gt; 是 app 中的一个数据框架，GraphQL 是 Relay 用来做数据表示的查询语言。GraphQL 同时还有一个 npm 包，可在服务器上运行，提供可以和 Relay 交互的数据源.&lt;/p&gt;
&lt;p&gt;Relay 不是从 Flux 架构分化来的，它只和 GraphQL 有关。这也就是说，这和 Redux 的模型有着巨大的区别。&lt;/p&gt;
&lt;p&gt;在 Relay + GraphQL 的模型中，每个组件指定自己需要的数据。Relay 调用数据，数据更新时，提供给组件最新的数据，并在客户端做缓存。app 需要更新数据时，在 Action 中创建一个 GraphQL 变更，这和 Redux 类似。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/graphql&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GraphQL&lt;/a&gt;是Facebook开发的一个针对描述复杂数据模型需求的一个数据查询语言标准，目前是工作草案。可以使用多种语言实现，目前Facebook提供了node.js版本的参考实现&lt;a href=&quot;https://github.com/graphql/graphql-js&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GraphQL.js.&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;服务器端代码分析&quot;&gt;&lt;a href=&quot;#服务器端代码分析&quot; class=&quot;headerlink&quot; title=&quot;服务器端代码分析&quot;&gt;&lt;/a&gt;服务器端代码分析&lt;/h2&gt;&lt;p&gt;server.js是服务器的入口类，基于Express框架默认在8080端口提供了/parse,/dashboard,/graphql三个url入口，根目录默认跳转到/graphql。&lt;br&gt;下面是/parse url入口的代码，很简单，直接new ParseServer，把相关的参数传进去，mongodb数据库地址DATABASE_URI可以取环境变量的值&lt;code&gt;const DATABASE_URI = process.env.DATABASE_URI || &amp;#39;mongodb://localhost:27017/dev&amp;#39;;&lt;/code&gt; ，其它的参数也都可以直接在环境变量里面设置，通过export XXX=”xxx”即可修改。&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server.use(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&#39;/parse&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ParseServer(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    databaseURI: DATABASE_URI,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cloud: path.resolve(__dirname, &lt;span class=&quot;string&quot;&gt;&#39;cloud.js&#39;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    appId: APP_ID,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    masterKey: MASTER_KEY,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    fileKey: &lt;span class=&quot;string&quot;&gt;&#39;f33fc1a9-9ba9-4589-95ca-9976c0d52cd5&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    serverURL: &lt;span class=&quot;string&quot;&gt;`http://&lt;span class=&quot;subst&quot;&gt;$&amp;#123;SERVER_HOST&amp;#125;&lt;/span&gt;:&lt;span class=&quot;subst&quot;&gt;$&amp;#123;SERVER_PORT&amp;#125;&lt;/span&gt;/parse`&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;cloud.js很简单，只是引用了cloud目录下文件，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./cloud/friends&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./cloud/surveys&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;./cloud/tests&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;cloud/friends.js 提供通过OAuth在Facebook登录后，获取好友和日程的功能。&lt;/p&gt;
&lt;p&gt;/dashboard是ParseDashboard的入口，很简单不说了，就是Parse的Web管理控制台，通过&lt;a href=&quot;http://localhost:8080/dashboard&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://localhost:8080/dashboard&lt;/a&gt; 可以访问,对Mongodb中数据进行管理，操作很方便。&lt;/p&gt;
&lt;p&gt;/graphql是通过express-graphql插件实现的一个graphql入口，前端UI是通过graphiql.js插件实现的。graphql这块占代码量比较大，schema目录下的文件都是和graphql相关的。&lt;br&gt;&lt;a href=&quot;https://github.com/graphql/graphql-js&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GraphQL.js.&lt;/a&gt; 提供2个主要能力：构建type schema; 根据type schema类型提供查询能力。&lt;br&gt;schema.js是graphql查询的入口，只支持查询schedule，node（接口类型，只有id），viewer，这点可以从下面的代码看出来，只指定了F8QueryType。我们在浏览器graphql控制台&lt;a href=&quot;http://localhost:8080/graphql&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://localhost:8080/graphql&lt;/a&gt; 里面也只能做schedule的查询，否则会提示错误，这个控制台还是很智能的，支持查询代码提示。&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; Schema = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; GraphQLSchema(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  query: F8QueryType,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  mutation: F8MutationType,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;F8QueryType 定义如下:&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; F8QueryType = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; GraphQLObjectType(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  name: &lt;span class=&quot;string&quot;&gt;&#39;Query&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  fields: () =&amp;gt; (&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    node: nodeField,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    viewer: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      type: F8UserType,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      resolve: (rootValue) =&amp;gt; rootValue, &lt;span class=&quot;comment&quot;&gt;// &lt;span class=&quot;doctag&quot;&gt;TODO:&lt;/span&gt; Authenticate user&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    schedule: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      type: &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; GraphQLList(F8SessionType),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      description: &lt;span class=&quot;string&quot;&gt;&#39;F8 agenda&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      resolve: (user, args) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Parse.Query(Session)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .ascending(&lt;span class=&quot;string&quot;&gt;&#39;startTime&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        .find(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;修改下试试，让它能支持查询演讲者，在schedule:{这行上面加入下面代码：
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;speaker: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  type: &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; GraphQLList(F8SpeakerType),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  resolve: (speaker, args) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Parse.Query(Speaker)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .find(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code&gt;在graphql控制台输入查询条件
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;speaker&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  name&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  title&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;   可以查到所有演讲者的列表。&lt;br&gt;schema.graphql直观的展示了全部的type scheme查询类型，可以看到有interface和type 2种定义方法，interface其实就是类似Java里面的接口，type可以实现interface。Node是interface，包含一个主键id，其它很多类型都实现了Node，例如type Speaker implements Node。通过这个文件我们可以轻松地理解整个服务器的数据结构，还是很清晰的。graphiql.js控制台第一次访问会请求schema.json，用于查询框智能语法提示。&lt;br&gt;updateSchema.js可以重新生成schema.graphql和schema.json。在f8app目录下运行&lt;code&gt;npm run  update-schema&lt;/code&gt; 命令可以重新生成这2个文件。&lt;br&gt;按照上面的做法修改文件后运行命令，可以发现 schema.graphql多了一行 &lt;code&gt;speaker: [Speaker]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;babelRelayPlugin.js代码很少，是提供scheme数据给Relay的。&lt;br&gt;具体可以参考&lt;a href=&quot;https://facebook.github.io/relay/docs/guides-babel-plugin.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;babel-relay-plugin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文介绍了f8app的项目架构，分析了f8app服务器端的技术实现，整个数据流是Parse Cloud 通过脚本导入-&amp;gt; MongoDB -&amp;gt; ParseServer -&amp;gt; GraphQL -&amp;gt; Redux -&amp;gt; ReactNative，用到了Express，Parse Server，Parse dashboard，GraphQL.js，GraphiQL.js， Ralay等js模块，代码量比较小,但技术栈挺复杂的。&lt;/p&gt;
&lt;p&gt;下篇文章分析React Native Android端的技术实现。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;近期开始研究Facebook f8app项目，目标是理解Facebook官方React Native f8app的整体技术架构，给公司目前几个的React Native项目开发提供官方经验借鉴，并对原生开发和React Native开发进行框架层面的融合。&lt;br&gt;研究了f8app的项目结构后，发现f8app服务器端的代码比较少，并且弄清楚数据模型和接口协议，对于后面理解客户端的实现有帮助，所以先分析服务器端。第二篇文章会详细分析f8app服务端的技术实现，并进行一些修改实验。f8app服务器端是基于Node.js,Express,Parse和GraphQL实现的，数据存储是MongoDB NoSql数据库。&lt;/p&gt;
    
    </summary>
    
    
      <category term="ReactNative" scheme="http://offbye.com/tags/ReactNative/"/>
    
      <category term="f8app" scheme="http://offbye.com/tags/f8app/"/>
    
  </entry>
  
</feed>
